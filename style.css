/* ===== 基本スタイルとフォント読み込み ===== */
@import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@500;800&family=Yuji+Syuku&family=Shippori+Mincho:wght@800&family=RocknRoll+One&family=Orbitron:wght@400;700&display=swap');

html {
    height: 100%;
}

body {
    /* 基本フォントを設定 */
    font-family: 'M PLUS Rounded 1c', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #0a0a1a;
    color: #e0e0e0; /* 基本テキストカラー */
    margin: 0;
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
}

/* 強調テキストや見出しに使う可能性のあるフォント */
h1, h2, h3, h4, h5, h6, strong, b {
    /* font-weight: 800; */ /* 必要に応じて太字調整 */
}

/* ===== 背景スタイル ===== */

/* 背景: グラデーションオーバーレイ */
body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    /* サイバーパンク的な青と紫のグラデーションに変更 */
    background: linear-gradient(135deg, rgba(15, 20, 40, 0.9), rgba(30, 25, 60, 0.85), rgba(10, 40, 80, 0.9));
    background-size: 300% 300%;
    animation: gradientBG 20s ease infinite; /* アニメーション速度調整 */
    z-index: -3;
}

/* 背景: 動くグリッド (ネオンシアン) */
.grid-background {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    width: 100%; height: 100%;
    /* ネオンシアンに変更、細かく */
    background-image:
        linear-gradient(rgba(0, 255, 255, 0.08) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 255, 255, 0.08) 1px, transparent 1px);
    background-size: 40px 40px; /* グリッドサイズ調整 */
    animation: moveGrid 25s linear infinite; /* アニメーション速度調整 */
    z-index: -2;
    opacity: 0.4; /* 透明度調整 */
}

/* ===== アニメーション定義 ===== */

@keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes moveGrid {
    0% { background-position: 0 0; }
    100% { background-position: 80px 80px; } /* 移動距離調整 */
}

/* ゲームオーバー時の画面シェイク */
@keyframes screenShakeHard {
    10%, 90% { transform: translate3d(-2px, 0, 0) rotate(-1.5deg); }
    20%, 80% { transform: translate3d(4px, 0, 0) rotate(1.5deg); }
    30%, 50%, 70% { transform: translate3d(-6px, 0, 0) rotate(-2.5deg); }
    40%, 60% { transform: translate3d(6px, 0, 0) rotate(2.5deg); }
}

@keyframes screenFadeIn { /* 画面遷移アニメーション */
    from { opacity: 0; transform: translateY(15px) scale(0.98); } /* 少しズームインする感じに */
    to { opacity: 1; transform: translateY(0) scale(1); }
}

@keyframes contentBoxGlow { /* コンテンツボックスのグロー */
    from { box-shadow: 0 0 8px rgba(0, 255, 255, 0.4); opacity: 0.7; }
    to { box-shadow: 0 0 15px rgba(0, 255, 255, 0.7); opacity: 1; } /* グローを強く */
}

@keyframes titleFlicker { /* タイトルのネオンのちらつき */
    0%, 18%, 22%, 25%, 53%, 57%, 100% { opacity: 1; }
    20%, 24%, 55% { opacity: 0.7; }
}

@keyframes titlePulseNeon { /* タイトルのネオンの脈動 */
    0%, 100% {
        transform: scale(1);
        text-shadow: 0 0 5px rgba(0, 255, 255, 0.8), 0 0 15px rgba(0, 255, 255, 0.7), 0 0 30px rgba(0, 255, 255, 0.5), 0 0 50px rgba(255, 0, 255, 0.4), 0 0 75px rgba(255, 0, 255, 0.3);
    }
    50% {
        transform: scale(1.03); /* 拡大率調整 */
        text-shadow: 0 0 8px rgba(0, 255, 255, 1), 0 0 20px rgba(0, 255, 255, 0.9), 0 0 40px rgba(0, 255, 255, 0.7), 0 0 60px rgba(255, 0, 255, 0.6), 0 0 90px rgba(255, 0, 255, 0.4);
    }
}

@keyframes startButtonPulse { /* 開始ボタンの脈動 */
    0%, 100% { transform: scale(1); box-shadow: 0 6px 25px rgba(255, 0, 255, 0.5); }
    50% { transform: scale(1.05); box-shadow: 0 8px 30px rgba(255, 0, 255, 0.7), 0 0 15px #f0f; }
}

@keyframes coinShineNeon { /* コイン表示の輝き */
    from { opacity: 0.8; text-shadow: 0 0 4px #ffeb3b, 0 0 8px #ffc107, 0 0 15px #fff; }
    to { opacity: 1; text-shadow: 0 0 8px #ffeb3b, 0 0 16px #ffc107, 0 0 25px #fff; }
}

@keyframes pulseYellowStrong { /* 連勝表示の脈動 (黄) */
    0%, 100% { opacity: 1; text-shadow: 0 0 6px #ffeb3b; transform: scale(1); }
    50% { opacity: 0.7; text-shadow: none; transform: scale(1.1); }
}

@keyframes pulseGrayDim { /* 連勝表示の脈動 (灰) */
    0%, 100% { opacity: 0.9; text-shadow: 0 0 4px #aaa; }
    50% { opacity: 0.5; text-shadow: none; }
}

@keyframes neonPulseCyanStrong { /* 賭け金情報の脈動 */
    0%, 100% { border-color: #0ff; box-shadow: 0 0 10px rgba(0, 255, 255, 0.5), inset 0 0 8px rgba(0, 255, 255, 0.25); text-shadow: 0 0 6px #0ff, 0 0 12px #fff; }
    50% { border-color: #6fffff; box-shadow: 0 0 18px rgba(0, 255, 255, 0.8), inset 0 0 12px rgba(0, 255, 255, 0.4); text-shadow: 0 0 10px #0ff, 0 0 20px #fff; }
}

@keyframes neonPulseMagentaStrong { /* メッセージエリアの脈動 */
    0%, 100% { border-color: #f0f; box-shadow: 0 0 10px rgba(255, 0, 255, 0.5), inset 0 0 8px rgba(255, 0, 255, 0.25); }
    50% { border-color: #ff66ff; box-shadow: 0 0 18px rgba(255, 0, 255, 0.8), inset 0 0 12px rgba(255, 0, 255, 0.4); }
}

@keyframes handHighlightPulse { /* 手札ハイライト */
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.4); color: #ffeb3b; text-shadow: 0 0 8px #ffc107; }
}

@keyframes handHighlightHifumiWobble { /* 手札ハイライト (ヒフミ) */
    0% { transform: scale(1) rotate(0deg); color: #ffcc70; filter: grayscale(0) brightness(1); }
    30% { transform: scale(1.1) rotate(5deg); color: #add8e6; filter: grayscale(0.5) brightness(0.9); }
    70% { transform: scale(1.05) rotate(-5deg); }
    100% { transform: scale(1) rotate(0deg); color: #ffcc70; filter: grayscale(0) brightness(1); }
}

@keyframes handHighlightStrongGlow { /* 手札ハイライト (強役) */
    0% { transform: scale(1) rotate(0deg); text-shadow: 1px 1px 4px rgba(0,0,0,0.6); filter: brightness(1); }
    50% { transform: scale(1.6) rotate(0deg); color: #ffeb3b; text-shadow: 0 0 15px #ffc107, 0 0 25px #fff; filter: brightness(1.5); }
    100% { transform: scale(1) rotate(0deg); text-shadow: 1px 1px 4px rgba(0,0,0,0.6); filter: brightness(1); }
}

@keyframes handHighlightLegendaryShine { /* 手札ハイライト (レジェンダリ) */
    0% { transform: scale(1); filter: brightness(1) drop-shadow(0 0 0px gold); }
    15% { transform: scale(1.9) rotate(-5deg); filter: brightness(3) drop-shadow(0 0 30px gold); color: gold; }
    30% { transform: scale(1.8) rotate(5deg); filter: brightness(2.5) drop-shadow(0 0 40px gold); }
    45% { transform: scale(1.85) rotate(-3deg); filter: brightness(2.8) drop-shadow(0 0 35px gold); }
    60% { transform: scale(1.8) rotate(3deg); filter: brightness(2.6) drop-shadow(0 0 32px gold); }
    100% { transform: scale(1); filter: brightness(1) drop-shadow(0 0 0px gold); }
}

@keyframes innerGlowStrong { /* ダイスエリアの内部グロー */
    from { box-shadow: 0 0 10px rgba(0, 255, 255, 0.4); opacity: 0.8; }
    to { box-shadow: 0 0 18px rgba(0, 255, 255, 0.7); opacity: 1; }
}

@keyframes win-appear-glow { /* WINインジケーター */
    0% { transform: translate(-50%, -50%) scale(0.4) rotate(-20deg); opacity: 0; filter: blur(5px); }
    60% { transform: translate(-50%, -50%) scale(1.15) rotate(8deg); opacity: 1; filter: blur(0); }
    100% { transform: translate(-50%, -50%) scale(1) rotate(0); opacity: 1; filter: blur(0); }
}

@keyframes lose-appear-shake { /* LOSEインジケーター */
    0% { transform: translate(-50%, -80%) scale(1.3); opacity: 0; }
    50% { transform: translate(-50%, -45%) scale(0.9); opacity: 1; }
    70% { transform: translate(-50%, -52%) scale(1.05) rotate(3deg); }
    85% { transform: translate(-50%, -48%) scale(0.98) rotate(-3deg); }
    100% { transform: translate(-50%, -50%) scale(1) rotate(0); opacity: 1; }
}

@keyframes shake-happy { /* キャラクター喜び */
    0%, 100% { transform: translate(0, 0) rotate(0); }
    25% { transform: translate(-6px, -10px) rotate(-4deg) scale(1.05); }
    50% { transform: translate(0, 0) rotate(0) scale(1); }
    75% { transform: translate(6px, -10px) rotate(4deg) scale(1.05); }
}

@keyframes shake-damage { /* キャラクターダメージ */
    0%, 100% { transform: translateX(0); box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-6px); }
    20%, 40%, 60%, 80% { transform: translateX(6px); }
    5%, 15%, 25%, 35%, 45%, 55%, 65%, 75%, 85%, 95% { box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5), 0 0 20px 8px rgba(255, 0, 0, 0.8); } /* 赤いエフェクト強化 */
}

@keyframes stepSlideIn { /* スコア計算ステップ */
    from { opacity: 0; transform: translateX(-15px); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes finalResultAppear { /* スコア計算最終結果 */
    from { opacity: 0; transform: scale(0.7) rotate(-5deg); }
    to { opacity: 1; transform: scale(1) rotate(0deg); }
}

@keyframes stepFadeOut { /* スコア計算ステップフェードアウト */
    from { opacity: 1; }
    to { opacity: 0; }
}

@keyframes rollButtonPulseStrong { /* ロールボタン脈動 */
    0%, 100% { transform: scale(1); box-shadow: 0 0 15px 3px gold, 0 4px 8px rgba(0,0,0,0.4); }
    50% { transform: scale(1.08); box-shadow: 0 0 25px 6px gold, 0 4px 8px rgba(0,0,0,0.4); }
}

@keyframes cardButtonPulseStrong { /* カードボタン脈動 */
    0%, 100% { transform: scale(1); box-shadow: 0 0 18px 4px #00ffff, 0 4px 8px rgba(0,0,0,0.4); }
    50% { transform: scale(1.08); box-shadow: 0 0 30px 8px #00ffff, 0 4px 8px rgba(0,0,0,0.4); }
}

@keyframes cardButtonShineFast { /* カードボタン輝き */
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

@keyframes nextWavePulseStrong { /* 次へボタン脈動 */
    0%, 100% { transform: scale(1); box-shadow: 0 0 18px 4px gold, 0 4px 8px rgba(0,0,0,0.4); }
    50% { transform: scale(1.05); box-shadow: 0 0 28px 7px gold, 0 4px 8px rgba(0,0,0,0.4); }
}

@keyframes scorePopup { /* スコア変動ポップアップ */
    0% { transform: translate(-50%, 0) scale(0.8); opacity: 1; }
    80% { transform: translate(-50%, -45px) scale(1.2); opacity: 1; } /* 移動距離とスケール変更 */
    100% { transform: translate(-50%, -60px) scale(1); opacity: 0; }
}

@keyframes modalFadeInStrong { /* モーダルフェードイン */
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}

@keyframes slideDownSmooth { /* モーダルコンテンツスライドダウン */
    from { transform: translateY(-60px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

@keyframes particles { /* ショップ背景パーティクル */
    to { background-position: -1000px 500px, -1125px 625px; }
}

@keyframes fadeInParticles { /* ショップ背景パーティクルフェードイン */
    to { opacity: 0.2; }
}

@keyframes shopContainerPulse { /* ショップコンテナ脈動 */
    from { box-shadow: 0 8px 40px rgba(0, 0, 0, 0.7), inset 0 0 20px rgba(15, 20, 40, 0.7), 0 0 25px rgba(120, 100, 255, 0.4); border-color: rgba(120, 100, 255, 0.4); }
    to { box-shadow: 0 8px 50px rgba(0, 0, 0, 0.8), inset 0 0 25px rgba(15, 20, 40, 0.8), 0 0 35px rgba(120, 100, 255, 0.6); border-color: rgba(150, 130, 255, 0.6); }
}

@keyframes signSway { /* ショップ看板揺れ */
    0%, 100% { transform: rotate(-0.8deg); }
    50% { transform: rotate(0.8deg); }
}

@keyframes textNeonFlicker { /* ショップ看板テキストちらつき (青) */
    0%, 18%, 22%, 25%, 53%, 57%, 100% { text-shadow: 0 0 4px #fff, 0 0 10px #0ff, 0 0 20px #0ff; opacity: 1; }
    20%, 24%, 55% { text-shadow: none; opacity: 0.6; }
}

@keyframes textNeonFlickerYellow { /* ショップ看板テキストちらつき (黄) */
    0%, 15%, 20%, 28%, 60%, 68%, 100% { text-shadow: 0 0 4px #fff, 0 0 10px #ff0, 0 0 20px #ff0; opacity: 0.95; }
    17%, 25%, 65% { text-shadow: none; opacity: 0.5; }
}

@keyframes textNeonFlickerPink { /* ショップ看板テキストちらつき (ピンク) */
    0%, 16%, 23%, 29%, 51%, 59%, 100% { text-shadow: 0 0 5px #fff, 0 0 12px #f0f, 0 0 22px #f0f; opacity: 1; }
    19%, 26%, 55% { text-shadow: none; opacity: 0.5; }
}

@keyframes signBorderFlicker { /* ショップ看板ボーダーちらつき */
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; border-color: #ffdd55; }
}

@keyframes titleGlowYellow { /* ショップセクションタイトルグロー */
    from { text-shadow: 1px 1px 3px rgba(0,0,0,0.5), 0 0 8px #ffcc70; border-left-color: #ffcc70; }
    to { text-shadow: 1px 1px 3px rgba(0,0,0,0.5), 0 0 15px #ffdd88; border-left-color: #ffdd88; }
}

@keyframes shining { /* カード輝きエフェクト */
    0% { left: -100%; }
    40%, 100% { left: 120%; }
}

@keyframes sparkleEpic { /* エピックカードキラキラ */
    0%, 100% { opacity: 0; }
    50% { opacity: 0.6; }
    /* 必要なら transform: rotate など追加 */
}

@keyframes upgradePulse { /* 強化可能カード脈動 */
    0%, 100% { transform: scale(1); border-width: 1px; box-shadow: 0 0 12px rgba(255, 235, 59, 0.4), inset 0 0 6px rgba(255, 235, 59, 0.15), 3px 3px 8px rgba(0, 0, 0, 0.4); }
    50% { transform: scale(1.025); border-width: 2px; box-shadow: 0 0 20px rgba(255, 235, 59, 0.7), inset 0 0 10px rgba(255, 235, 59, 0.3), 4px 6px 12px rgba(0, 0, 0, 0.45); }
}

@keyframes upgradePulseLv3 { /* Lv3強化可能カード脈動 */
    0%, 100% { transform: scale(1) rotate(0deg); border-width: 2px; box-shadow: 0 0 15px rgba(255, 140, 0, 0.5), inset 0 0 8px rgba(255, 140, 0, 0.2), 3px 3px 8px rgba(0, 0, 0, 0.4); }
    50% { transform: scale(1.04) rotate(2deg); border-width: 3px; box-shadow: 0 0 25px rgba(255, 140, 0, 0.8), inset 0 0 12px rgba(255, 140, 0, 0.4), 5px 8px 15px rgba(0, 0, 0, 0.5); }
}

@keyframes modalFadeIn { /* ダイス選択オーバーレイフェードイン */
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes rollModalAppearPop { /* ロールモーダル出現 */
    from { transform: scale(0.5) rotateY(-90deg); opacity: 0; }
    to { transform: scale(1) rotateY(0deg); opacity: 1; }
}

@keyframes itemRevealAppearPop { /* アイテム獲得モーダル出現 */
    from { transform: scale(0.6) rotate(-10deg); opacity: 0; filter: blur(4px); }
    to { transform: scale(1) rotate(0deg); opacity: 1; filter: blur(0); }
}

@keyframes legendaryShineStrong { /* レジェンダリカード獲得モーダル輝き */
    0%, 100% { box-shadow: 0 0 45px rgba(255, 183, 77, 0.9), 0 12px 45px rgba(0, 0, 0, 0.75); }
    50% { box-shadow: 0 0 65px rgba(255, 183, 77, 1.0), 0 12px 45px rgba(0, 0, 0, 0.75); }
}

@keyframes roleRevealAppear { /* 役結果表示: 基本出現 */
    0% { transform: scale(0.7) rotate(-8deg); opacity: 0; }
    100% { transform: scale(1) rotate(0deg); opacity: 1; }
}

@keyframes roleRevealFadeOut { /* 役結果表示: フェードアウト */
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(0.8); opacity: 0; }
}

@keyframes pinzoroTextPop { /* ピンゾロテキストポップ */
    0% { transform: scale(0.5) rotateY(90deg); opacity: 0; }
    100% { transform: scale(1) rotateY(0deg); opacity: 1; }
}

@keyframes arashiTextSpin { /* アラシテキストスピン */
    0% { transform: scale(0) rotate(720deg); opacity: 0; filter: blur(8px); }
    100% { transform: scale(1) rotate(0deg); opacity: 1; filter: blur(0px); }
}

@keyframes shigoroTextAppear { /* シゴロテキスト出現 */
    0% { letter-spacing: -0.5em; opacity: 0; }
    40% { letter-spacing: 0.1em; }
    100% { letter-spacing: 0; opacity: 1; }
}

@keyframes hifumiTextDrop { /* ヒフミテキストドロップ */
    0% { transform: translateY(-30px) rotate(5deg); opacity: 0; }
    60% { transform: translateY(5px) rotate(-2deg); opacity: 1; }
    100% { transform: translateY(0) rotate(0deg); opacity: 1; }
}

@keyframes shonbenTextFlicker { /* ションベンテキストちらつき */
    0%, 100% { opacity: 0.7; }
    50% { opacity: 0.4; }
}

@keyframes waveClearBodyPop { /* WAVEクリアボディポップ */
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

@keyframes move-twink-back { /* WAVEクリア背景 */
    from {background-position:0 0;}
    to {background-position:-10000px 5000px;}
}

@keyframes rainbowText { /* WAVEクリアテキスト */
    0%{background-position:0% 82%}
    50%{background-position:100% 19%}
    100%{background-position:0% 82%}
}

@keyframes screenShake { /* ゲームオーバーシェイク (弱め) */
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
    20%, 40%, 60%, 80% { transform: translateX(5px); }
}

@keyframes gameOverFlicker { /* ゲームオーバーテキストちらつき */
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; transform: skewX(-2deg); }
}

@keyframes coinFlySparkle { /* コイン獲得アニメーション */
    0% { transform: scale(0.8) translate(0, 0); opacity: 1; filter: brightness(1.2); }
    30% { transform: scale(1.3) translate(var(--tx, 0px), -60px); opacity: 1; filter: brightness(1.5); }
    100% { transform: scale(0.4) translate(var(--tx, 0px), var(--ty, 0px)); opacity: 0; filter: brightness(1); }
}

@keyframes roleRevealAppearGeneral { /* 役結果モーダル出現 (汎用) */
    from { transform: scale(0.7) rotate(-8deg); opacity: 0; }
    to { transform: scale(1) rotate(0deg); opacity: 1; }
}

@keyframes pinzoroTextPopGlow { /* ピンゾロテキストポップ (グロー付き) */
    from { transform: scale(0.3) rotateY(180deg) rotateZ(-45deg); opacity: 0; filter: blur(10px) brightness(3); }
    to { transform: scale(1) rotateY(0deg) rotateZ(0deg); opacity: 1; filter: blur(0) brightness(1); }
}

@keyframes arashiBgRotateFast { /* アラシ背景回転 (高速) */
    from { transform: rotate(0deg); } to { transform: rotate(360deg); }
}

@keyframes arashiTextWobbleStrong { /* アラシテキスト揺れ (強) */
    from { transform: scale(0) rotate(480deg) skewX(-10deg); opacity: 0; filter: blur(8px); }
    50% { transform: scale(1.2) rotate(-15deg) skewX(-10deg); opacity: 1; filter: blur(0); }
    100% { transform: scale(1) rotate(0deg) skewX(-10deg); opacity: 1; filter: blur(0); }
}

@keyframes shigoroTextRevealDrop { /* シゴロテキストドロップ */
    from { opacity: 0; transform: translateY(-30px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes hifumiTextShiverStrong { /* ヒフミテキスト震え (強) */
    0% { transform: translateY(0) rotate(0); opacity: 0; filter: blur(2px); }
    30% { transform: translateY(-8px) rotate(-4deg); opacity: 1; filter: blur(0); }
    50% { transform: translateY(0) rotate(4deg); }
    70% { transform: translateY(-5px) rotate(-2deg); }
    100% { transform: translateY(0) rotate(0); opacity: 1; filter: blur(0); }
}

@keyframes shonbenTextCrumbleFast { /* ションベンテキスト崩壊 (高速) */
    0% { transform: scale(1) rotate(0); opacity: 1; filter: grayscale(90%) blur(1.5px); }
    100% { transform: scale(0.7) rotate(15deg) translateY(30px); opacity: 0; filter: grayscale(100%) blur(8px); }
}

/* 画面遷移アニメーション */
@keyframes fadeInScreen {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes fadeOutScreen {
    from { opacity: 1; }
    to { opacity: 0; }
}

/* ===== 画面共通スタイル ===== */

.screen {
    display: none;
    width: 100%;
    min-height: 100vh;
    box-sizing: border-box;
    position: relative;
    overflow: hidden;
    flex-grow: 1;
}

.screen.active {
    display: flex; /* または display: block; は JS で制御 */
    flex-direction: column;
}

/* フェードイン/アウト用のクラス */
.screen-fade-in {
    animation: fadeInScreen 0.4s ease-out forwards; /* 速度調整 */
}

.screen-fade-out {
    animation: fadeOutScreen 0.4s ease-out forwards; /* 速度調整 */
    pointer-events: none; /* アニメーション中は操作不可に */
}

/* コンテンツボックス共通スタイル */
.screen-content-box {
    background: rgba(25, 30, 55, 0.92); /* ベース色調整、透明度少し上げる */
    backdrop-filter: blur(6px); /* ブラーを少し強く */
    padding: 30px 40px;
    border-radius: 12px; /* 角丸を少し大きく */
    /* ネオンシアンのボーダーと強い影 */
    box-shadow: 0 10px 35px rgba(0, 0, 0, 0.6), inset 0 0 20px rgba(15, 20, 40, 0.7), 0 0 15px rgba(0, 255, 255, 0.2);
    border: 1px solid rgba(0, 255, 255, 0.4); /* ボーダー色を濃く */
    position: relative;
    z-index: 2;
    width: 90%;
    max-width: 850px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: auto; /* 画面中央寄せ */
}

/* コンテンツボックスの内側の光るボーダー */
.screen-content-box::before {
    content: '';
    position: absolute;
    top: 4px; left: 4px; right: 4px; bottom: 4px; /* 少し内側に */
    border: 1px solid rgba(0, 255, 255, 0.5); /* 線の透明度上げる */
    border-radius: 8px; /* 内側の角丸調整 */
    pointer-events: none;
    opacity: 0.8;
    box-shadow: 0 0 8px rgba(0, 255, 255, 0.4); /* グロー効果追加 */
    animation: contentBoxGlow 3.5s infinite alternate; /* アニメーション速度調整 */
}

/* ===== ボタン共通スタイル ===== */
button {
    padding: 10px 20px; /* デフォルトパディング調整 */
    font-size: 1em;
    cursor: pointer;
    border: none;
    border-radius: 5px; /* 角丸統一 */
    color: #fff; /* 基本文字色を白に */
    font-weight: bold;
    transition: all 0.25s ease; /* トランジション時間調整 */
    text-shadow: 0 0 3px rgba(0, 0, 0, 0.5); /* テキストシャドウ追加 */
    position: relative; /* 疑似要素用 */
    overflow: hidden; /* はみ出し防止 */
    background: linear-gradient(180deg, rgba(108, 117, 125, 0.8), rgba(76, 85, 93, 0.9)); /* デフォルト背景色 (グレー系) */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4), inset 0 1px 1px rgba(255, 255, 255, 0.1);
}

/* ボタンホバー効果 (光沢と浮き上がり) */
button:not(:disabled):hover {
    transform: translateY(-3px) scale(1.03); /* 浮き上がり強調 */
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.5), inset 0 1px 1px rgba(255, 255, 255, 0.2), 0 0 10px rgba(255, 255, 255, 0.3); /* 影と光を追加 */
}

/* ボタンクリック効果 (沈み込み) */
button:not(:disabled):active {
    transform: translateY(0px) scale(0.97);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3), inset 0 2px 3px rgba(0, 0, 0, 0.3);
}

/* ポップなボタン (例: 主要アクション) */
.button-pop {
    /* ネオンイエロー系に変更 */
    background: linear-gradient(180deg, #ffdd57, #ffc107);
    color: #333; /* 文字色を濃く */
    text-shadow: 0 1px 1px rgba(255, 255, 255, 0.4);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4), inset 0 1px 1px rgba(255, 235, 150, 0.5);
}
.button-pop:not(:disabled):hover {
    background: linear-gradient(180deg, #ffeb84, #ffd24d);
    box-shadow: 0 8px 15px rgba(255, 200, 0, 0.5), inset 0 1px 1px rgba(255, 235, 150, 0.6), 0 0 12px #ffeb3b; /* ネオンイエローのグロー */
}

/* 控えめなボタン (例: サブアクション、キャンセル) */
.button-subtle {
    background: linear-gradient(180deg, rgba(70, 80, 110, 0.9), rgba(50, 60, 90, 0.95)); /* 少し青紫系に */
    border: 1px solid rgba(0, 255, 255, 0.15); /* 細いシアンボーダー */
    color: #ccc;
    text-shadow: 0 0 2px rgba(0, 0, 0, 0.6);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4), inset 0 1px 1px rgba(255, 255, 255, 0.05);
}
.button-subtle:not(:disabled):hover {
    background: linear-gradient(180deg, rgba(85, 95, 125, 0.9), rgba(60, 70, 100, 0.95));
    border-color: rgba(0, 255, 255, 0.3);
    color: #fff;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.45), inset 0 1px 1px rgba(255, 255, 255, 0.1), 0 0 8px rgba(0, 255, 255, 0.2); /* シアンの弱いグロー */
}
/* .button-subtle のスタイルを、いくつかのボタンにも直接適用 (統合済み箇所) */
#back-to-title-from-result-button,
#settings-button,
#back-to-title-button,
#confirm-character-no,
#cancel-discard-button,
#history-button, /* 統合 */
.card-detail-button, /* 統合 */
.history-detail-toggle /* 統合 */
{
    background: linear-gradient(180deg, rgba(70, 80, 110, 0.9), rgba(50, 60, 90, 0.95));
    border: 1px solid rgba(0, 255, 255, 0.15);
    color: #ccc;
    text-shadow: 0 0 2px rgba(0, 0, 0, 0.6);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4), inset 0 1px 1px rgba(255, 255, 255, 0.05);
}
#back-to-title-from-result-button:hover:not(:disabled),
#settings-button:hover:not(:disabled),
#back-to-title-button:hover:not(:disabled),
#confirm-character-no:hover:not(:disabled),
#cancel-discard-button:hover:not(:disabled),
#history-button:hover:not(:disabled), /* 統合 */
.card-detail-button:hover:not(:disabled), /* 統合 */
.history-detail-toggle:hover:not(:disabled) /* 統合 */
{
    background: linear-gradient(180deg, rgba(85, 95, 125, 0.9), rgba(60, 70, 100, 0.95));
    border-color: rgba(0, 255, 255, 0.3);
    color: #fff;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.45), inset 0 1px 1px rgba(255, 255, 255, 0.1), 0 0 8px rgba(0, 255, 255, 0.2);
    transform: translateY(-2px); /* ホバー時の共通エフェクト */
}

/* 無効化ボタン */
button:disabled {
    background: #444 !important; /* 最優先 */
    background-image: none !important; /* 最優先 */
    color: #888 !important; /* 最優先 */
    cursor: not-allowed;
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
    text-shadow: none;
    transform: none !important;
    animation: none !important;
    border: none !important;
    opacity: 0.6;
}
/* 特定のボタンの無効化スタイルを共通化 */
.buy-button:disabled,
.upgrade-button:disabled,
.sell-card-button:disabled {
    background-color: #555 !important; /* #444より少し明るい */
    color: #999 !important;
    cursor: not-allowed;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.4);
    text-shadow: none;
    transform: none !important;
    background-image: none !important; /* 必須 */
    border: none !important; /* 必須 */
}

/* ===== タイトル画面 ===== */
#title-screen {
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    z-index: 1;
    flex-grow: 1;
    overflow-y: auto;
}

.title-content { /* screen-content-boxへ統合済み */
    max-width: 700px;
}

.game-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 5em; /* サイズアップ */
    font-weight: 700; /* 少し細くしてネオン感UP */
    margin-bottom: 40px;
    color: #0ff; /* 基本色をシアンに */
    text-shadow: /* ネオンシャドウ強化 */
        0 0 5px rgba(0, 255, 255, 0.8),
        0 0 15px rgba(0, 255, 255, 0.7),
        0 0 30px rgba(0, 255, 255, 0.5),
        0 0 50px rgba(255, 0, 255, 0.4),
        0 0 75px rgba(255, 0, 255, 0.3);
    animation: titleFlicker 5s infinite linear alternate, titlePulseNeon 2.5s infinite ease-in-out;
    background: none;
    -webkit-background-clip: unset;
    background-clip: unset;
    /* color: #0ff; */ /* 重複削除 */
}

.mode-selector {
    margin-bottom: 35px;
}
.mode-selector p {
    margin-bottom: 18px;
    font-size: 1.3em;
    color: #c0d0ff; /* 少し青みのある白 */
    text-shadow: 0 0 5px rgba(0, 200, 255, 0.6);
}
.mode-button {
    padding: 12px 25px; /* サイズ調整 */
    font-size: 1.15em;
    margin: 0 10px;
    border: 1px solid rgba(0, 255, 255, 0.4); /* ネオンシアンボーダー */
    border-radius: 8px; /* 角丸調整 */
    background-color: rgba(0, 150, 200, 0.3); /* 背景色調整 */
    font-family: 'M PLUS Rounded 1c', sans-serif;
    color: #0ff; /* テキスト色 */
    box-shadow: 0 3px 10px rgba(0, 255, 255, 0.25), inset 0 0 5px rgba(0,0,0,0.4); /* シャドウ調整 */
}
.mode-button:not(:disabled):hover {
    background-color: rgba(0, 200, 255, 0.5); /* ホバー背景 */
    border-color: rgba(0, 255, 255, 0.8);
    color: #fff;
    box-shadow: 0 5px 15px rgba(0, 255, 255, 0.4), inset 0 0 8px rgba(0,0,0,0.3), 0 0 10px #0ff; /* ホバーシャドウ強化 */
}
.mode-button.selected {
    background: linear-gradient(45deg, #0ff, #0af); /* 選択中グラデーション */
    border-color: #0ff;
    color: #1a1a2e; /* 選択中文字色 */
    font-weight: bold;
    box-shadow: 0 6px 20px rgba(0, 255, 255, 0.6); /* 選択中シャドウ強化 */
}
/* 準備中ボタンのスタイル */
.mode-button[data-mode="pvp"]:not(.selected) {
    background-color: rgba(100, 100, 120, 0.2);
    border-color: rgba(150, 150, 180, 0.3);
    color: #6a7a9a;
    cursor: not-allowed;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    opacity: 0.7;
}
.mode-button[data-mode="pvp"]:hover:not(.selected) { /* ホバー効果なくす */
    transform: none;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}

#start-game-button {
    padding: 16px 40px; /* サイズ調整 */
    font-size: 1.5em;
    border: 1px solid #f0f;
    border-radius: 8px;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    color: #fff;
    text-shadow: 0 0 8px #f0f; /* ネオンマゼンタシャドウ */
    background: linear-gradient(45deg, #f0f, #af00af);
    box-shadow: 0 6px 25px rgba(255, 0, 255, 0.5); /* シャドウ強化 */
    animation: startButtonPulse 2s infinite ease-in-out; /* アニメーション追加 */
}
#start-game-button:not(:disabled):hover {
    background: linear-gradient(45deg, #ff33ff, #cf33cf);
    border-color: #ff33ff;
    box-shadow: 0 10px 30px rgba(255, 0, 255, 0.7), 0 0 20px #f0f; /* ホバーシャドウ強化 */
}

#select-character-button {
    padding: 12px 30px;
    font-size: 1.15em;
    margin-top: 20px;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    /* .button-subtle スタイルを継承 */
}

.player-name-input-container {
    margin-top: 25px;
}
.player-name-input-container label {
    margin-right: 10px;
    color: #b0c4de;
}
#player-name-input {
    padding: 10px 15px; /* サイズ調整 */
    border-radius: 5px;
    border: 1px solid rgba(0, 255, 255, 0.5); /* ネオンシアンボーダー */
    background-color: rgba(15, 20, 40, 0.9); /* 背景色調整 */
    color: #fff;
    min-width: 220px;
    font-family: 'Orbitron', sans-serif; /* フォント変更 */
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.5);
}
#player-name-input:focus {
    outline: none;
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.5), 0 0 10px rgba(0, 255, 255, 0.6); /* フォーカス時グロー */
    border-color: #0ff;
}

.title-extra-buttons {
    margin-top: 30px;
}

/* ===== リザルト画面 ===== */
#result-screen {
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    z-index: 1;
    flex-grow: 1;
    overflow-y: auto;
}

.result-content { /* screen-content-boxへ統合済み */
    max-width: 700px;
}
#result-title {
    font-size: 3em;
    margin-bottom: 25px;
    font-family: 'Shippori Mincho', serif;
}
#result-title.clear {
    color: #ffeb3b;
    text-shadow: 0 0 10px #ffeb3b, 0 0 20px #fff, 2px 2px 5px rgba(0,0,0,0.5);
}
#result-title.over {
    color: #ff7b7b;
    text-shadow: 0 0 10px #ff7b7b, 0 0 20px #fff, 2px 2px 5px rgba(0,0,0,0.5);
}
#result-message {
    font-size: 1.2em;
    margin-bottom: 20px;
    color: #eee;
}
#final-score {
    font-size: 1.5em;
    margin-bottom: 30px;
    color: #0ff;
    font-weight: bold;
    text-shadow: 0 0 8px #0ff;
    font-family: 'Orbitron', sans-serif;
}
.result-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
}
#restart-same-mode-button {
    background: linear-gradient(180deg, #ffeb3b, #ffc107);
    padding: 12px 25px;
    font-size: 1.1em;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    /* .button-pop スタイルを継承 */
}
#restart-same-mode-button:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 5px 10px rgba(255, 200, 0, 0.4);
}
#back-to-title-from-result-button {
    padding: 12px 25px;
    font-size: 1.1em;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    /* .button-subtle スタイルを継承 */
}

/* ===== キャラクター選択画面 ===== */
#character-select-screen {
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    z-index: 1;
    flex-grow: 1;
    overflow-y: auto;
}

.character-select-content { /* screen-content-boxへ統合済み */
    max-width: 700px;
}
#character-select-screen h2 {
    color: #ffcc70;
    margin-bottom: 25px;
    font-size: 2.5em;
    font-family: 'Yuji Syuku', serif;
    margin-top: 0;
}
.character-select-body {
    display: flex;
    width: 100%;
    gap: 20px;
    margin-bottom: 25px;
    min-height: 400px;
}
#character-list {
    flex: 1;
    background: rgba(0,0,0,0.2);
    padding: 15px;
    border-radius: 8px;
    max-height: 60vh; /* スクロール用 */
    overflow-y: auto; /* スクロール用 */
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    flex-direction: column;
    gap: 8px;
    /* スクロールバーのスタイル */
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 255, 255, 0.5) rgba(15, 20, 40, 0.8);
}
#character-list::-webkit-scrollbar { width: 8px; }
#character-list::-webkit-scrollbar-track { background: rgba(15, 20, 40, 0.8); border-radius: 4px;}
#character-list::-webkit-scrollbar-thumb { background-color: rgba(0, 255, 255, 0.5); border-radius: 4px; border: 1px solid rgba(0, 255, 255, 0.7);}
#character-list::-webkit-scrollbar-thumb:hover { background-color: rgba(0, 255, 255, 0.8); }

#character-list p {
    color: #aaa;
    text-align: center;
    margin-top: 10px;
    font-style: italic;
}
#character-list button {
    width: 100%;
    padding: 10px; /* 調整 */
    font-size: 1.1em;
    background-color: rgba(255, 255, 255, 0.08);
    font-family: 'M PLUS Rounded 1c', sans-serif;
    color: #eee;
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 5px;
    text-align: left;
    cursor: pointer;
    transition: background-color 0.2s ease, border-color 0.2s ease;
    box-shadow: none;
    text-shadow: none;
    font-weight: normal;
    white-space: nowrap; /* はみ出し防止 */
    overflow: hidden; /* はみ出し防止 */
    text-overflow: ellipsis; /* はみ出し防止 */
    box-sizing: border-box; /* はみ出し防止 */
}
#character-list button:hover {
    background-color: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.3);
}
#character-list button.selected {
    background-color: rgba(255, 235, 59, 0.3);
    border-color: #ffeb3b;
    color: #fff;
    font-weight: bold;
}

#character-preview {
    flex: 1.5;
    background: rgba(0,0,0,0.2);
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    min-height: 300px;
}
#character-preview-placeholder {
    color: #aaa;
    font-size: 1.2em;
    font-style: italic;
}
#character-preview-image {
    max-width: 100%;
    max-height: 350px;
    object-fit: contain;
    margin-bottom: 20px;
    display: none;
    border-radius: 5px;
    background-color: rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.1);
}
#character-preview-card { /* 既存スタイル */
    margin-top: 15px; color: #ffcc70; font-weight: bold; font-size: 1.1em; display: none; font-family: 'M PLUS Rounded 1c', sans-serif;
}
#character-confirm-area {
    display: none;
    margin-top: 15px;
}
#character-confirm-message {
    color: #eee;
    margin-bottom: 15px;
    font-size: 1.1em;
}
#character-confirm-area button {
    margin: 0 10px;
    padding: 10px 25px;
}
#confirm-character-yes {
    background: linear-gradient(180deg, #ffeb3b, #ffc107);
    font-family: 'M PLUS Rounded 1c', sans-serif;
    /* .button-pop スタイルを継承 */
}
#confirm-character-yes:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 5px 10px rgba(255, 200, 0, 0.4);
}
#back-to-title-button {
    margin-top: 20px;
    padding: 10px 30px;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    /* .button-subtle スタイルを継承 */
}

/* ===== ゲーム画面 ===== */
#game-screen {
    height: 100vh; /* 画面高さいっぱい維持 */
    overflow: hidden; /* スクロールは内部で */
}

/* ダイスロールモーダル表示時の背景暗転効果 */
#game-screen.dimmed > *:not(#dice-roll-modal):not(#role-result-modal) { /* 役結果モーダルも除外 */
    filter: blur(4px) brightness(0.5); /* ブラーと明るさ調整 */
    pointer-events: none;
    transition: filter 0.4s ease-out;
}

#game-header {
    width: 100%;
    background-color: rgba(15, 20, 40, 0.97);
    padding: 8px 20px;
    display: flex;
    justify-content: space-between; /* 両端揃え */
    align-items: center; /* 垂直中央揃え */
    box-sizing: border-box;
    z-index: 200;
    border-bottom: 1px solid rgba(0, 255, 255, 0.5);
    box-shadow: 0 4px 15px rgba(0, 255, 255, 0.25);
    flex-shrink: 0;
    position: relative; /* タイトルの絶対配置基準のため残す */
}

#game-main-area {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    padding-top: 0;
}

/* スクロール可能エリア */
#game-scrollable-area {
    overflow-y: auto; /* 縦スクロールのみ */
    flex-grow: 1;
    padding: 15px;
    /* スクロールバーのスタイル (ネオン風) - 統一 */
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 255, 255, 0.5) rgba(15, 20, 40, 0.8);
}
#game-scrollable-area::-webkit-scrollbar { width: 8px; }
#game-scrollable-area::-webkit-scrollbar-track { background: rgba(15, 20, 40, 0.8); border-radius: 4px;}
#game-scrollable-area::-webkit-scrollbar-thumb { background-color: rgba(0, 255, 255, 0.5); border-radius: 4px; border: 1px solid rgba(0, 255, 255, 0.7);}
#game-scrollable-area::-webkit-scrollbar-thumb:hover { background-color: rgba(0, 255, 255, 0.8); }

/* ゲームコンテナ */
#game-container.screen-content-box {
    background: rgba(20, 25, 45, 0.9);
    backdrop-filter: blur(3px);
    padding: 15px 20px; /* 変更 */
    border-radius: 10px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6), inset 0 0 15px rgba(15, 20, 40, 0.6), 0 0 12px rgba(0, 255, 255, 0.2); /* 変更 */
    width: 100%; /* 変更 */
    max-width: 90%;
    margin: 0 auto;
    border: 1px solid rgba(0, 255, 255, 0.4); /* 変更 */
    /* .screen-content-box スタイルを部分的に上書き */
}

/* ゲーム内情報表示 */
#game-coin-info {
    /* position: static; background: none; border: none; box-shadow: none; padding: 0; text-align: left; z-index: auto; */ /* 不要な重複削除 */
}
#game-coin-info h3 {
    display: none;
}
#game-coin-display {
    font-size: 1.5em;
    font-weight: bold;
    color: #ffeb3b;
    font-family: 'Orbitron', sans-serif;
    text-shadow:
        0 0 4px #ffeb3b,
        0 0 8px #ffc107,
        0 0 15px #fff;
    animation: coinShineNeon 2s infinite linear alternate;
    margin: 0;
}

#settings-button-container {
    /* 位置調整などは header の flexbox に任せる */
}
#settings-button {
    padding: 5px 10px;
    font-size: 1.5em;
    line-height: 1;
    background: rgba(0, 200, 255, 0.25);
    border: 1px solid rgba(0, 255, 255, 0.5);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: 'M PLUS Rounded 1c', sans-serif; /* アイコンだが念のため */
    /* .button-subtle スタイルを部分的に適用 */
}
#settings-button:hover:not(:disabled) {
    background: rgba(0, 255, 255, 0.4);
    color: #fff;
    transform: translateY(-2px) rotate(90deg); /* 回転追加 */
    box-shadow: 0 4px 12px rgba(0, 255, 255, 0.4);
}

#wave-info {
    font-size: 1.2em;
    color: #c0d8ff;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    text-shadow: 0 0 4px rgba(0, 200, 255, 0.6);
    margin-bottom: 12px; /* 調整 */
}
.wave-highlight { /* WAVE番号 */
    color: #f0f;
    text-shadow: 0 0 6px #f0f, 0 0 12px #fff;
}
.round-normal { /* ROUND番号 */
    color: #c0d8ff;
}
.mode-display { /* モード表示 */
    color: #87CEFA; /* ライトブルー */
}

#consecutive-wins-display {
    font-weight: bold;
    margin-left: 12px;
    font-size: 0.9em;
}
#consecutive-wins-display:not(.npc-losing-streak) { /* プレイヤー連勝 */
    color: #ffeb3b;
    animation: pulseYellowStrong 1.5s infinite ease-in-out;
    text-shadow: 0 0 6px #ffeb3b;
}
#consecutive-wins-display.npc-losing-streak { /* NPC連勝 */
    color: #8a9aba;
    animation: pulseGrayDim 2s infinite ease-in-out;
}

#current-bet-info {
    background-color: rgba(15, 20, 40, 0.5);
    padding: 8px 15px; /* ★ パディング調整 */
    border-radius: 3px;
    font-size: clamp(1.2em, 3.2vw, 1.4em); /* ★ 可変フォントサイズ */
    line-height: 1.2; /* ★ 行間調整 */
    border: 1px solid #0ff;
    position: relative;
    overflow: hidden;
    min-height: 1.5em;
    margin-bottom: 15px;
    font-weight: bold;
    color: #0ff;
    font-family: 'Orbitron', sans-serif; 
    text-shadow: 0 0 6px #0ff, 0 0 12px #fff; /* ★ 影調整 */
    animation: neonPulseCyanStrong 1.8s infinite ease-in-out;
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.5), inset 0 0 8px rgba(0, 255, 255, 0.25); /* ★ 影調整 */
    width: 100%;
    box-sizing: border-box;
    display: flex; /* ★ Flexbox追加 */
    align-items: center; /* ★ 垂直中央揃え */
    justify-content: center; /* ★ 水平中央揃え */
    text-align: center; /* ★ テキスト中央揃え */
}
#current-bet-info .parent-name {
    font-size: 0.8em; /* 親の名前は少し小さく */
    margin-left: 8px; /* 間隔 */
    color: #ffcc70; /* 親の名前の色 */
    font-family: 'M PLUS Rounded 1c', sans-serif;
    font-weight: normal; /* 親の名前は通常 */
}

#message-area {
    background-color: rgba(15, 20, 40, 0.8);
    padding: 5px 5px;
    margin-top: 10px;
    margin-bottom: 0;
    border-radius: 3px;
    min-height: 2.5em;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    border: 1px solid #f0f;
    text-align: center;
    position: relative;
    overflow: hidden;
    animation: neonPulseMagentaStrong 2s infinite ease-in-out 0.2s;
    box-shadow: 0 0 10px rgba(255, 0, 255, 0.5), inset 0 0 8px rgba(255, 0, 255, 0.25);
    width: 100%;
    box-sizing: border-box;
}
#message {
    margin: 0;
    font-style: italic;
    font-size: clamp(1.2em, 3.5vw, 1.5em); /* 可変フォントサイズ */
    line-height: 1.2;
    max-width: 95%;
    font-weight: 500;
    margin-bottom: 5px;
    color: #00ff99;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    text-shadow:
        0 0 5px rgba(0, 255, 153, 0.9), /* 内側グリーン強調 */
        0 0 12px rgba(0, 255, 153, 0.7),
        0 0 40px rgba(255, 0, 255, 0.6), /* 外側マゼンタ強調 */
        0 0 30px rgba(255, 255, 255, 0.4); /* 白追加 */
}
#message-button-container {
    display: flex;
    gap: 10px;
    margin-top: 8px;
}
.temp-choice-button { /* YES/NOボタン */
    margin: 0 5px;
    padding: 8px 16px;
    font-size: 0.95em;
}
.skip-button { /* スキップボタン */
    background: linear-gradient(180deg, #f0ad4e, #ec971f);
    color: white;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
}
.skip-button:hover:not(:disabled) {
    background: linear-gradient(180deg, #f3bc70, #f0a540);
    transform: translateY(-2px);
    box-shadow: 0 5px 10px rgba(236, 151, 31, 0.4);
}

/* ゲームエリアレイアウト (PC版) */
#game-area {
    display: flex;
    justify-content: space-between;
    align-items: stretch; /* 高さを揃える */
    margin-bottom: 0; /* メッセージエリアとの間隔 */
    gap: 10px; /* 各要素間のギャップ */
    flex-grow: 1; /* 高さを親要素に合わせる */
}

/* プレイヤー情報ボックス */
.player-box {
    background-color: rgba(25, 30, 55, 0.95);
    padding: 15px;
    border-radius: 8px;
    flex: 1 1 28%; /* 基礎幅、伸縮率、最大幅 */
    max-width: 280px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: center; /* 内容を中央揃え（垂直） */
    border: 1px solid rgba(0, 255, 255, 0.3);
    box-shadow: inset 0 0 10px rgba(15, 20, 40, 0.6);
    position: relative;
}
.player-box h2 {
    margin-top: 0;
    margin-bottom: 10px;
    color: #0ff;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    font-size: 1.4em;
    border-bottom: 1px solid rgba(0, 255, 255, 0.4);
    padding-bottom: 6px;
    font-weight: 500;
    text-shadow: 0 0 6px rgba(0, 255, 255, 0.6);
}
.parent-marker {
    color: #ffeb3b;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    font-size: 0.8em;
    margin-left: 5px;
    vertical-align: middle;
    font-weight: bold;
    display: none; /* JSで制御 */
    text-shadow: 0 0 6px #ffc107;
}
.player-box p {
    margin: 8px 0;
    font-size: 0.95em;
    color: #c0d0e0;
    font-family: 'M PLUS Rounded 1c', sans-serif;
}
.player-box span { /* スコアや役のテキスト */
    font-weight: bold;
}
.score-container {
    position: relative; /* ポップアップ基準 */
}
.score {
    color: #ffeb3b;
    font-size: 1.2em;
    font-family: 'Orbitron', sans-serif;
}
#player-dice, #npc-dice {
    font-family: 'Orbitron', monospace;
    font-size: 1.15em;
    color: #fff;
    letter-spacing: 1.5px;
    text-shadow: 0 0 3px #fff;
}
.hand-display {
    color: #f0f;
    font-weight: 800;
    text-shadow: 0 0 6px #f0f, 0 0 12px #fff;
    font-family: 'Yuji Syuku', serif;
    font-size: 1.4em;
}
.hand-display.highlight { animation: handHighlightPulse 0.8s ease-out forwards; }
.hand-display.highlight.hifumi { animation: handHighlightHifumiWobble 1s ease-in-out forwards; }
.hand-display.highlight.strong { animation: handHighlightStrongGlow 1.2s ease-out forwards; }
.hand-display.highlight.legendary { animation: handHighlightLegendaryShine 1.5s ease-out forwards; }

/* ダイスエリア */
#dice-area {
    flex-grow: 1;
    text-align: center;
    padding: 20px;
    background-color: rgba(10, 15, 30, 0.9);
    background-image: linear-gradient(rgba(0, 255, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 255, 0.05) 1px, transparent 1px);
    background-size: 25px 25px;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    border: 2px solid #0ff;
    overflow: hidden;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.4), inset 0 0 20px rgba(15, 20, 40, 0.7);
    position: relative;
    width: auto; /* 変更 */
    max-width: 35%; /* 追加 */
    margin: 0; /* 追加 */
    transition: background-color 0.3s ease;
}
#dice-area::before { /* 内部グロー用 */
    content: '';
    position: absolute;
    top: 2px; left: 2px; right: 2px; bottom: 2px; /* 調整 */
    border: 1px solid rgba(0, 255, 255, 0.7);
    border-radius: 6px; /* 調整 */
    pointer-events: none;
    opacity: 0.8;
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
    animation: innerGlowStrong 3s infinite alternate;
}
#dice-display {
    font-size: 6em;
    font-weight: 700;
    margin: 15px 0;
    color: #0ff;
    min-height: 1.2em;
    letter-spacing: 0.1em;
    font-family: 'Orbitron', sans-serif;
    text-shadow: 0 0 8px rgba(0, 255, 255, 0.9), 0 0 15px rgba(0, 255, 255, 0.8), 0 0 25px rgba(0, 255, 255, 0.6), 0 0 35px rgba(255, 255, 255, 0.7);
    white-space: nowrap;
    transition: opacity 0.2s ease-out, visibility 0s linear 0.2s;
    opacity: 1;
    visibility: visible;
    z-index: 1;
    position: relative;
}
.roll-counter-top-right { /* 右上に変更 */
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 1em;
    color: rgba(255, 255, 255, 0.6);
    background-color: rgba(0, 0, 0, 0.3);
    padding: 2px 6px;
    border-radius: 4px;
    z-index: 5;
    transition: opacity 0.2s ease-out, visibility 0s linear 0.2s;
    opacity: 1;
    visibility: visible;
    font-family: 'Orbitron', sans-serif;
}
#center-role-announcement { /* 既存 */
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2em; font-weight: bold; color: gold; background-color: rgba(0, 0, 0, 0.7); padding: 10px 20px; border-radius: 5px; display: none; z-index: 10; }

/* キャラクター画像エリア */
.character-image-area {
    width: auto; /* 可変幅 */
    flex: 0 0 20%; /* 基礎幅20% */
    aspect-ratio: 4 / 5; /* アスペクト比固定 */
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #6a7a9a;
    font-size: 0.9em;
    text-align: center;
    align-self: stretch; /* 高さを親に合わせる */
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.6);
    background: rgba(15, 20, 40, 0.8);
    border: 1px solid rgba(0, 255, 255, 0.1);
}
.character-image-area::before { /* グロー要素削除 */
    display: none;
}
.character-image-area.player {
    box-shadow: inset 0 0 12px rgba(0, 0, 0, 0.7), 0 0 15px rgba(0, 170, 255, 0.6);
    border: 1px solid rgba(0, 170, 255, 0.5);
}
.character-image-area.npc {
    box-shadow: inset 0 0 12px rgba(0, 0, 0, 0.7), 0 0 15px rgba(255, 68, 68, 0.6);
    border: 1px solid rgba(255, 68, 68, 0.5);
}
.character-image-area img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    border-radius: 6px; /* 少し内側に */
    display: block; /* 初期表示 */
    position: relative;
    z-index: 1;
}
.character-image-area.npc img {
    transform: scaleX(-1); /* NPC画像反転 */
}

/* WIN/LOSE インジケーター */
.win-lose-indicator {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.8);
    font-size: 4em; /* ベースサイズ */
    font-weight: 800;
    font-family: 'RocknRoll One', sans-serif;
    padding: 5px 10px;
    border-radius: 10px;
    opacity: 0;
    pointer-events: none;
    z-index: 100;
    text-align: center;
    white-space: nowrap;
    visibility: hidden;
}
.win-lose-indicator.indicator-win {
    color: #fff;
    background-color: rgba(81, 255, 0, 0.85);
    text-shadow: 0 0 8px #fff, 0 0 15px #72ff3b, 2px 2px 4px rgba(0,0,0,0.6);
    border: 2px solid #ffeb3b;
    box-shadow: 0 0 20px rgba(81, 255, 0, 0.85);
    animation: win-appear-glow 0.9s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}
.win-lose-indicator.indicator-lose {
    color: #eee;
    background-color: rgba(180, 0, 30, 0.85);
    text-shadow: 0 0 5px #000, 0 0 10px #ff0000, 2px 2px 4px rgba(0,0,0,0.6);
    border: 2px solid #ff4444;
    box-shadow: 0 0 15px rgba(255, 0, 0, 0.7);
    animation: lose-appear-shake 0.7s ease-out forwards;
}
/* キャラクターシェイクアニメーション */
.character-image-area.shake-happy { animation: shake-happy 1.5s cubic-bezier(.36,.07,.19,.97) both; }
.character-image-area.shake-damage { animation: shake-damage 1s linear both; }

/* スコア計算アニメーション表示領域 */
#score-calculation-animation {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    transform: none;
    background-color: rgba(20, 20, 30, 0.95);
    border-radius: 12px; /* ダイスエリアに合わせる */
    padding: 20px;
    border: 2px solid rgba(255, 215, 0, 0.5);
    visibility: hidden;
    opacity: 0;
    transition: opacity 0.3s ease-out, visibility 0s linear 0.3s;
    box-shadow: 0 0 25px rgba(255, 215, 0, 0.4), inset 0 0 20px rgba(0,0,0,0.6);
    z-index: 15;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-sizing: border-box;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, 0.2) rgba(0, 0, 0, 0.1);
}
#score-calculation-animation::-webkit-scrollbar { width: 6px; }
#score-calculation-animation::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); border-radius: 3px; }
#score-calculation-animation::-webkit-scrollbar-thumb { background-color: rgba(255, 255, 255, 0.2); border-radius: 3px; }
#score-calculation-animation::-webkit-scrollbar-thumb:hover { background-color: rgba(255, 255, 255, 0.3); }
#score-calculation-animation.visible {
    visibility: visible;
    opacity: 1;
    transition: opacity 0.3s ease-out, visibility 0s linear 0s;
}
.score-calc-inner {
    width: 100%;
    max-width: 320px; /* 最大幅 */
    display: flex;
    flex-direction: column;
    gap: 2px;
}
.score-calc-step {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    padding: 2px 0;
    font-size: 1em; /* ベースフォントサイズ */
    border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
    opacity: 0;
    transform: translateX(-15px);
    animation: stepSlideIn 0.4s ease-out forwards;
    min-height: 1.2em; /* 最低限の高さを確保 */
}
.score-calc-step:last-child {
    border-bottom: none;
}
.score-calc-label {
    color: #bbb;
    font-size: 0.8em;
    margin-right: 8px;
    white-space: nowrap;
    flex-shrink: 0; /* ラベルが縮まないように */
    font-family: 'M PLUS Rounded 1c', sans-serif;
}
.score-calc-value {
    font-weight: bold;
    text-align: right;
    white-space: nowrap;
    font-size: 1.0em; /* 値のフォントサイズ */
    flex-shrink: 0; /* 値も縮まないように */
    font-family: 'Orbitron', sans-serif;
}
.score-calc-value-multi { /* カード効果など複数行になる場合 */
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 1px;
}
.score-calc-value-multi div { width: 100%; text-align: right; }
.score-calc-value-multi .score-calc-label { font-size: 0.75em; color: #aaa; }
.score-calc-value-multi .score-calc-value { font-size: 0.9em; }
.score-calc-value.positive { color: #90ee90; }
.score-calc-value.negative { color: #ff7b7b; }
.score-calc-value.neutral { color: #eee; }
.score-calc-value.multiplier { color: #ffeb3b; }
.score-calc-value.bonus { color: #ffcc70; }
.score-calc-value.info { color: #87CEFA; font-family: 'M PLUS Rounded 1c', sans-serif; }
.score-calc-value.special { color: #ba68c8; font-style: italic; font-family: 'M PLUS Rounded 1c', sans-serif; }
.score-calc-final {
    font-size: 2.6em; /* 最終結果サイズ */
    font-weight: 800;
    text-align: center;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    opacity: 0;
    transform: scale(0.7);
    animation: finalResultAppear 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    width: 100%;
    font-family: 'Orbitron', sans-serif;
}
.score-calc-final.positive {
    color: #90ee90;
    text-shadow: 0 0 8px #90ee90, 0 0 15px #fff, 2px 2px 4px rgba(0,0,0,0.5);
}
.score-calc-final.negative {
    color: #ff7b7b;
    text-shadow: 0 0 8px #ff7b7b, 0 0 15px #fff, 2px 2px 4px rgba(0,0,0,0.5);
}
.score-calc-final.neutral {
    color: #eee;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}
.score-calc-step.step-fade-out { /* ステップのフェードアウト */
    animation: stepFadeOut 0.3s ease-out forwards;
}

/* ボトムコントロールバー */
#bottom-spacer { /* スマホ用スペース */
    display: none;
}
#bottom-control-bar {
    width: 100%;
    background-color: rgba(15, 20, 40, 0.98);
    padding: 5px 10px 5px 10px;
    border-top: 1px solid rgba(0, 255, 255, 0.4);
    box-shadow: 0 -5px 15px rgba(0, 255, 255, 0.15);
    z-index: 100;
    box-sizing: border-box;
    flex-shrink: 0;
}
#control-area {
    display: flex;
    flex-direction: column; /* 基本は縦積み */
    align-items: stretch; /* 幅を親に合わせる */
    gap: 10px;
    margin-top: 0;
    max-width: 65%; /* PCでの最大幅 */
    margin: 0 auto; /* 中央寄せ */
}

/* 賭け金関連コントロール */
.bet-main-controls {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    width: auto; /* 幅自動調整 */
    background: none;
    padding: 0;
    border-radius: 0;
    box-sizing: border-box;
    transition: opacity 0.3s ease;
    order: 1; /* 表示順 */
}
.bet-input-container {
    display: flex;
    flex-direction: column; /* 縦積み（ラベルと入力欄） */
    align-items: center;
    gap: 2px;
    min-width: 120px; /* 最低幅確保 */
}
.bet-input-container label {
    font-size: 0.9em;
    color: #ffcc70;
    text-shadow: 0 0 3px #ffcc70;
    white-space: nowrap;
    font-family: 'Orbitron', monospace;
}
#bet-input {
    padding: 5px;
    font-size: 1.4em;
    width: 120px;
    border: 1px solid rgba(0, 255, 255, 0.6);
    border-radius: 5px;
    background-color: rgba(15, 20, 40, 0.9);
    color: #0ff;
    box-shadow: inset 0 1px 4px rgba(0,0,0,0.6), 0 0 5px rgba(0, 255, 255, 0.3);
    font-family: 'Orbitron', monospace;
    text-align: center; /* 中央揃え追加 */
}
#bet-input:focus {
    background-color: rgba(30, 40, 70, 0.9);
    outline: none;
    box-shadow: inset 0 1px 4px rgba(0,0,0,0.6), 0 0 12px rgba(0, 255, 255, 0.7);
    border-color: #0ff;
}
#min-bet-display {
    color: #ffcc70;
    font-size: 0.95em;
    text-shadow: 0 0 3px #ffcc70;
    font-family: 'Orbitron', monospace;
}
.bet-adjust-container { /* 調整ボタンコンテナ */
    display: flex;
    gap: 6px; /* ボタン間の隙間 */
}
.bet-adjust-button {
    border-radius: 50%; /* 丸ボタン */
    width: 60px; /* サイズ調整 */
    height: 50px; /* サイズ調整 */
    font-size: 1.2em; /* 文字サイズ調整 */
    padding: 0;
    line-height: 48px; /* 垂直中央揃え */
    box-shadow: 0 3px 8px rgba(0,0,0,0.5);
    flex-shrink: 0; /* 縮まないように */
    font-family: 'Orbitron', monospace;
}
.bet-adjust-button.plus { background: linear-gradient(145deg, #50fa7b, #28a745); }
.bet-adjust-button.plus:hover:not(:disabled) { background: linear-gradient(145deg, #60ff8b, #30c050); }
.bet-adjust-button.minus { background: linear-gradient(145deg, #ff7b7b, #c9302c); }
.bet-adjust-button.minus:hover:not(:disabled) { background: linear-gradient(145deg, #ff8b8b, #d6403b); }

/* MIN/MAX/決定ボタン */
.bet-action-container {
    display: flex;
    gap: 10px;
    align-items: stretch; /* 高さを揃える */
    justify-content: center;
    background: none;
    padding: 0;
    border-radius: 0;
    transition: opacity 0.3s ease, display 0.3s ease;
    order: 2; /* 表示順 */
}
.bet-action-container button {
    flex-grow: 1; /* 幅を均等に */
    padding: 8px 5px; /* パディング調整 */
    font-size: 0.9em; /* フォントサイズ調整 */
    font-family: 'M PLUS Rounded 1c', sans-serif;
}
#min-bet-button {
    background: linear-gradient(180deg, #ffcc80, #f0ad4e);
    color: white;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
}
#min-bet-button:hover:not(:disabled) {
    background: linear-gradient(180deg, #f3bc70, #f0a540);
    transform: translateY(-2px);
    box-shadow: 0 5px 10px rgba(236, 151, 31, 0.4);
}
#set-bet-button { /* 賭け金決定ボタン */
    background: linear-gradient(180deg, #ffeb3b, #ffc107);
    color: #fff; /* 文字色変更 */
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
}
#set-bet-button:hover:not(:disabled) {
    background: linear-gradient(180deg, #fff06b, #ffd24d);
    transform: translateY(-2px);
    box-shadow: 0 5px 10px rgba(255, 200, 0, 0.4);
}
#max-bet-button {
    background: linear-gradient(180deg, #a0ffaf, #50fa7b);
    color: #ffffff;
    text-shadow: 0px 1px 1px rgba(0,0,0,0.4);
}
#max-bet-button:hover:not(:disabled) {
    background: linear-gradient(180deg, #a0f0a0, #30c050);
    transform: translateY(-2px);
    box-shadow: 0 5px 10px rgba(40, 167, 69, 0.4);
}

/* アクションボタン (ロール/カード/履歴) */
#action-controls {
    display: flex;
    justify-content: center;
    gap: 6px;
    align-items: stretch; /* 高さを揃える */
    margin-top: 0; /* 上マージン削除 */
    order: 3; /* 表示順 */
}
#action-controls button {
    flex-grow: 1; /* 幅を均等に */
    padding: 5px 10px; /* パディング調整 */
    font-size: 1em; /* フォントサイズ調整 */
    font-family: 'M PLUS Rounded 1c', sans-serif;
}
#roll-button {
    background: linear-gradient(180deg, #ffeb3b, #ffc107);
    color: #fff; /* 文字色変更 */
    text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
}
#roll-button:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 5px 10px rgba(255, 200, 0, 0.4);
}
#roll-button:not(:disabled) { /* 有効時のアニメーション */
    animation: rollButtonPulseStrong 1.5s infinite ease-in-out;
    box-shadow: 0 0 15px 3px gold, 0 4px 8px rgba(0,0,0,0.4);
    border: 1px solid gold;
}
#card-action-button,
#post-roll-card-button /* メッセージエリアのカードボタン */
{
    background: linear-gradient(180deg, #4cbce0, #31b0d5);
    color: white;
    text-shadow: 0 -1px 1px rgba(0, 0, 0, 0.4);
    position: relative; /* 輝きエフェクト用 */
    overflow: hidden; /* 輝きエフェクト用 */
}
#card-action-button:hover:not(:disabled),
#post-roll-card-button:hover:not(:disabled) {
    background: linear-gradient(180deg, #70cce6, #4ac0e0);
    transform: translateY(-2px);
    box-shadow: 0 5px 10px rgba(49, 176, 213, 0.4);
}
#card-action-button.highlight-card-button,
#post-roll-card-button.highlight-card-button { /* 使用可能時のハイライト */
    animation: cardButtonPulseStrong 1.5s infinite ease-in-out;
    box-shadow: 0 0 18px 4px #00ffff, 0 4px 8px rgba(0,0,0,0.4);
    border: 1px solid #00ffff;
}
#card-action-button.highlight-card-button::before,
#post-roll-card-button.highlight-card-button::before { /* 輝きエフェクト */
    content: '';
    position: absolute;
    top: -50%; left: -50%;
    width: 200%; height: 200%;
    background: radial-gradient(circle, rgba(0, 255, 255, 0.4) 0%, rgba(0, 255, 255, 0) 60%);
    animation: cardButtonShineFast 2.5s infinite linear;
}

#history-button {
    /* .button-subtle スタイルを継承 */
}

/* 次へボタン */
#next-wave-area {
    display: none; /* JSで制御 */
    justify-content: center;
    margin-top: 0; /* 上マージン削除 */
    order: 4; /* 表示順 */
}
#next-wave-button {
    background: linear-gradient(180deg, #ffeb3b, #ffc107);
    padding: 12px 30px;
    font-size: 1.3em;
    color: #fff; /* 文字色変更 */
    font-weight: bold;
    box-shadow: 0 0 18px 4px gold, 0 4px 8px rgba(0,0,0,0.4);
    border: 1px solid gold;
    box-shadow: 0 0 12px 2px gold, 0 3px 5px rgba(0,0,0,0.3); /* 重複削除 */
    animation: nextWavePulseStrong 1.5s infinite ease-in-out;
    font-family: 'M PLUS Rounded 1c', sans-serif;
}
#next-wave-button:hover:not(:disabled) {
    transform: translateY(-3px) scale(1.03);
    box-shadow: 0 0 25px 6px gold, 0 6px 12px rgba(255, 200, 0, 0.5);
}

/* スコア変動ポップアップ */
.score-change-popup {
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 1.3em;
    font-weight: bold;
    padding: 2px 8px;
    border-radius: 5px;
    z-index: 10;
    pointer-events: none;
    opacity: 0;
    white-space: nowrap;
    animation: scorePopup 1.5s ease-out forwards;
    font-family: 'Orbitron', sans-serif;
}
.score-change-popup.gain {
    color: #fff;
    background-color: rgba(80, 250, 123, 0.9); /* ネオングリーン */
    text-shadow: 0 0 5px #50fa7b;
    box-shadow: 0 0 8px rgba(80, 250, 123, 0.7);
}
.score-change-popup.loss {
    color: #fff;
    background-color: rgba(255, 121, 198, 0.9); /* ネオンピンク */
    text-shadow: 0 0 5px #ff79c6;
    box-shadow: 0 0 8px rgba(255, 121, 198, 0.7);
}

/* ゲーム画面: NPCが親の場合のスタイル */
#game-screen.npc-parent .bet-main-controls {
    opacity: 0.5;
    pointer-events: none;
}
#game-screen.npc-parent .bet-action-container {
    display: none;
}
#game-screen.npc-parent .bet-input-container label,
#game-screen.npc-parent .bet-input-container span {
    opacity: 0.7;
}
#game-screen.npc-parent #bet-input {
    background-color: rgba(50, 50, 70, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.1);
    pointer-events: none;
}

/* ===== モーダル共通スタイル ===== */
.modal {
    display: none; /* JSで制御 */
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(10, 10, 20, 0.9);
    backdrop-filter: blur(8px);
    justify-content: center;
    align-items: center;
    animation: modalFadeInStrong 0.4s ease-out;
}

.modal-content {
    background-color: #1a1f35;
    margin: auto;
    padding: 30px;
    border: 1px solid rgba(0, 255, 255, 0.4);
    width: 85%;
    max-width: 650px; /* デフォルト最大幅 */
    border-radius: 12px;
    position: relative;
    box-shadow: 0 10px 40px rgba(0,0,0,0.7), 0 0 20px rgba(0, 255, 255, 0.3);
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='52' height='52' viewBox='0 0 52 52'%3E%3Cpath fill='%23333' fill-opacity='0.08' d='M0 17.83V0h17.83a3 3 0 0 1-5.66 2H5.9A5 5 0 0 1 0 5.9v6.27a3 3 0 0 1 2-5.66V17.83zm0 16.34v-8.5a3 3 0 0 1 2 5.66v2.84h11.93a5 5 0 0 1 5.9 5.9v6.27a3 3 0 0 1-5.66 2H0v-17.83zm52 0V0h-17.83a3 3 0 0 0 5.66 2h6.27A5 5 0 0 0 52 5.9v6.27a3 3 0 0 0-2-5.66V17.83zm0 16.34v-8.5a3 3 0 0 0-2 5.66v2.84H38.07a5 5 0 0 0-5.9 5.9v6.27a3 3 0 0 0 5.66 2H52v-17.83zM17.83 52H0v-17.83a3 3 0 0 1 5.66-2h6.27A5 5 0 0 1 17.83 38v8.5a3 3 0 0 1-2 5.66V52zm16.34 0H17.83v-2.84a5 5 0 0 1-5.9-5.9V38.07a3 3 0 0 1 2-5.66h8.5v11.93a5 5 0 0 1 5.9 5.9V52zm0-52H17.83v2.84a5 5 0 0 0 5.9 5.9v6.27a3 3 0 0 0-2 5.66h8.5V5.9a5 5 0 0 0-5.9-5.9V0zm16.34 0H52v17.83a3 3 0 0 0-5.66-2h-6.27A5 5 0 0 0 34.17 12v-8.5a3 3 0 0 0 2-5.66V0z'/%3E%3C/svg%3E");
    animation: slideDownSmooth 0.5s ease-out;
}

.close-button {
    color: #aaa;
    position: absolute;
    top: 15px;
    right: 25px;
    font-size: 32px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.2s ease, transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    z-index: 1;
}
.close-button:hover {
    color: #0ff;
    transform: rotate(180deg) scale(1.1);
}

.modal h2 {
    margin-top: 0;
    color: #ffcc70;
    text-align: center;
    border-bottom: 1px solid rgba(0, 255, 255, 0.3);
    padding-bottom: 10px;
    font-weight: 500;
    text-shadow: 0 0 6px #ffcc70, 1px 1px 4px rgba(0,0,0,0.6);
    font-family: 'Yuji Syuku', serif;
}
.modal h3 { /* 破棄モーダル用など */
    margin-top: 0;
    color: #ffcc70;
    font-size: 1.5em;
    margin-bottom: 15px;
    font-family: 'Yuji Syuku', serif;
}
.modal p { /* 破棄モーダル用など */
    color: #ccc;
    margin-bottom: 20px;
    font-family: 'M PLUS Rounded 1c', sans-serif;
}

/* ===== 履歴モーダル ===== */
#history-modal .modal-content { /* サイズなど調整 */
    max-width: 700px; /* 少し広げる */
}
#history-log {
    list-style: none;
    padding: 0;
    max-height: 65vh; /* 高さを確保 */
    overflow-y: auto;
    margin-top: 20px;
    /* スクロールバー統一 */
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 255, 255, 0.5) rgba(15, 20, 40, 0.8);
    font-family: 'M PLUS Rounded 1c', sans-serif;
}
#history-log::-webkit-scrollbar { width: 8px; }
#history-log::-webkit-scrollbar-track { background: rgba(15, 20, 40, 0.8); border-radius: 4px;}
#history-log::-webkit-scrollbar-thumb { background-color: rgba(0, 255, 255, 0.5); border-radius: 4px; border: 1px solid rgba(0, 255, 255, 0.7);}
#history-log::-webkit-scrollbar-thumb:hover { background-color: rgba(0, 255, 255, 0.8); }

#history-log li {
    background-color: rgba(30, 35, 60, 0.8);
    margin-bottom: 10px;
    padding: 12px 18px;
    border-radius: 8px;
    border-left: 5px solid #888; /* デフォルト色 */
    font-size: 0.95em;
    transition: background-color 0.25s ease, transform 0.2s ease;
    backdrop-filter: blur(3px);
}
#history-log li:hover {
    background-color: rgba(45, 50, 80, 0.9);
}
/* 勝敗に応じた左ボーダー色 */
#history-log li.win { border-left-color: #90ee90; } /* グリーン */
#history-log li.lose { border-left-color: #ff7b7b; } /* レッド */
#history-log li.draw { border-left-color: #aaa; } /* グレー */
#history-log li.clear { border-left-color: #ffeb3b; background-color: rgba(80, 70, 30, 0.8); } /* クリア時 ゴールド */

/* 履歴メタ情報 (WAVE/親) */
.history-meta {
    border-bottom: 1px dashed rgba(0, 255, 255, 0.2);
    padding-bottom: 6px; /* 下パディング追加 */
    margin-bottom: 6px; /* 下マージン追加 */
    color: #a0c0ff;
    font-size: 0.9em; /* 少し小さく */
    display: flex; /* 横並び */
    justify-content: space-between; /* 両端揃え */
    align-items: baseline;
}
.history-meta .wave-highlight { /* WAVE番号 */
    color: #c0d8ff;
    text-shadow: 0 0 5px #f0f;
    font-weight: bold; /* 強調 */
}
.history-meta .round-normal { /* ROUND番号 */
    color: #c0d8ff;
}
.history-meta .parent-info {
    color: #ffcc70;
}

/* 対戦結果表示 */
.history-matchup {
    font-size: 1em;
    margin-bottom: 4px; /* 下マージン調整 */
    display: flex; /* Flexboxで横並び */
    align-items: center; /* 垂直中央揃え */
    flex-wrap: wrap; /* 折り返し */
    gap: 5px 10px; /* 隙間調整 */
}
.history-matchup .history-result {
    font-size: 0.9em;
    padding: 3px 8px;
    border-radius: 5px;
    font-weight: bold; /* 強調 */
    margin-right: auto; /* 結果ラベルを左に寄せる */
}
.history-matchup .history-win { background-color: #90ee90; color: #fff; box-shadow: inset 0 0 4px rgba(0,0,0,0.4); text-shadow: 0 -1px 1px rgba(0,0,0,0.5); }
.history-matchup .history-lose { background-color: #ff7b7b; color: #fff; box-shadow: inset 0 0 4px rgba(0,0,0,0.5); text-shadow: 0 -1px 1px rgba(0,0,0,0.5); }
.history-matchup .history-draw { background-color: #aaa; color: #fff; box-shadow: inset 0 0 4px rgba(0,0,0,0.3); text-shadow: 0 -1px 1px rgba(0,0,0,0.5); }
.history-matchup .player-name,
.history-matchup .npc-name {
    color: #eee;
    font-weight: 500; /* 少し太く */
}
.history-matchup .dice-roll {
    font-family: 'Orbitron', monospace;
    color: #0ff;
    background-color: rgba(0, 0, 0, 0.3);
    padding: 2px 5px;
    border-radius: 4px;
    font-size: 0.98em;
    border: 1px solid rgba(0, 255, 255, 0.2);
}
.history-matchup .hand-name {
    color: #f0f;
    text-shadow: 0 0 5px #f0f;
    font-weight: bold; /* 強調 */
    font-family: 'Yuji Syuku', serif;
    font-size: 1.1em;
}
.history-matchup .hand-name:is(:contains('ピンゾロ')) { color: #ffeb3b; text-shadow: 0 0 6px #ffc107; font-family: 'Shippori Mincho', serif; }
.history-matchup .hand-name:is(:contains('ションベン')) { color: #ff7b7b; text-shadow: 0 0 5px #ff5555; font-family: 'M PLUS Rounded 1c', sans-serif; }
.history-matchup .vs { color: #aaa; font-size: 0.9em; }

/* 履歴サマリー */
.history-summary {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 4px;
    font-size: 0.9em;
    gap: 10px;
    flex-wrap: wrap;
}
.history-summary .bet-amount { color: #ddd; }
.history-summary .score-change-history span { font-family: 'Orbitron', sans-serif; }
.history-summary .score-change-history .gain { color: #90ee90; font-weight: bold; }
.history-summary .score-change-history .loss { color: #ff7b7b; font-weight: bold; }
.history-summary .coin-bonus-history { color: #ffeb3b; font-size: 1em; font-weight: bold; color: #ffeb3b; font-family: 'Orbitron', sans-serif; }
.history-summary .streak-info span { font-family: 'Yuji Syuku', serif; }
.history-summary .streak-info { font-size: 1.0em; }
.history-summary .win-streak { color: #ffeb3b; animation: pulseYellowStrong 1.5s infinite ease-in-out; font-weight: bold; }
.history-summary .npc-losing-streak { color: #8a9aba; animation: pulseGrayDim 1.8s infinite ease-in-out; font-weight: bold; }
.history-summary .history-detail-toggle {
    /* .button-subtle スタイルを継承 */
    font-size: 0.85em; /* 微調整 */
    padding: 4px 10px; /* 微調整 */
    margin-left: auto; /* 右寄せ維持 */
    border-radius: 10px; /* 丸み調整 */
}

/* 履歴詳細 */
.history-details-content {
    background-color: rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(0, 255, 255, 0.15);
    border-radius: 4px;
    padding: 8px 12px;
    margin-top: 8px;
    font-size: 0.85em;
    line-height: 1.5;
    color: #bbb;
    overflow: hidden;
    max-height: 0;
    transition: max-height 0.3s ease-out, padding 0.3s ease-out, margin-top 0.3s ease-out;
    font-family: 'M PLUS Rounded 1c', sans-serif;
}
.history-details-content.details-visible {
    /* max-height は JS で設定 */
    padding: 8px 12px;
    margin-top: 8px;
}
.history-details-content h5 {
    color: #aaa;
    font-size: 1.1em;
    margin: 8px 0 4px 0;
    padding-bottom: 2px;
    border-bottom: 1px dotted rgba(255, 255, 255, 0.15);
}
.history-details-content ul {
    list-style: none;
    padding-left: 10px;
    margin: 5px 0;
}
.history-details-content li {
    margin-bottom: 3px;
}
.history-details-content ul ul { /* カード効果リストなど */
    padding-left: 15px;
    margin-top: 2px;
}
.history-details-content ul ul li {
    font-style: italic;
    color: #a0a0a0;
}
.wave-clear-info { /* WAVEクリア時の履歴表示 */
    display: block;
    margin-bottom: 5px;
    font-size: 1.0em;
    color: #a0ffa0;
    font-weight: bold;
    text-align: center;
    padding: 5px 10px;
    border-radius: 4px;
    font-family: 'Orbitron', sans-serif;
}

/* ===== 設定モーダル ===== */
.settings-modal-content {
    max-width: 700px; /* 幅維持 */
    max-height: 80vh; /* 高さを制限 */
    display: flex; /* Flexboxレイアウトに変更 */
    flex-direction: column; /* 縦積み */
    overflow: hidden; /* 全体はスクロールしない */
}
.settings-navigation {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 20px; /* マージン調整 */
    padding-bottom: 15px; /* パディング調整 */
    border-bottom: 1px solid rgba(0, 255, 255, 0.25);
    flex-wrap: wrap;
    flex-shrink: 0; /* ヘッダーは縮まない */
}
.settings-nav-button {
    padding: 9px 20px;
    font-size: 1.05em;
    background-color: rgba(0, 255, 255, 0.1);
    color: #a0e0ff;
    border: 1px solid rgba(0, 255, 255, 0.3);
    border-radius: 18px;
    /* 共通ボタンスタイルを一部継承 */
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
}
.settings-nav-button:hover {
    background-color: rgba(0, 255, 255, 0.2);
    color: #fff;
    border-color: rgba(0, 255, 255, 0.5);
    box-shadow: 0 0 8px rgba(0, 255, 255, 0.3);
    transform: translateY(-1px); /* 少し浮かせる */
}
.settings-nav-button.active {
    background: linear-gradient(180deg, #ffdd57, #ffc107);
    color: #333;
    font-weight: bold;
    border-color: #ffc107;
    box-shadow: 0 0 12px rgba(255, 235, 59, 0.6);
}
#settings-content {
    overflow-y: auto; /* ここでスクロールさせる */
    text-align: left;
    padding-right: 15px; /* スクロールバー用 */
    flex-grow: 1; /* 残りの高さを埋める */
    /* スクロールバー統一 */
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 255, 255, 0.5) rgba(15, 20, 40, 0.8);
}
#settings-content::-webkit-scrollbar { width: 8px; }
#settings-content::-webkit-scrollbar-track { background: rgba(15, 20, 40, 0.8); border-radius: 4px;}
#settings-content::-webkit-scrollbar-thumb { background-color: rgba(0, 255, 255, 0.5); border-radius: 4px; border: 1px solid rgba(0, 255, 255, 0.7);}
#settings-content::-webkit-scrollbar-thumb:hover { background-color: rgba(0, 255, 255, 0.8); }

#settings-content h3 {
    color: #ffcc70;
    margin-top: 0;
    margin-bottom: 15px;
    border-bottom: 1px dashed rgba(255, 204, 112, 0.4);
    padding-bottom: 8px;
}
#settings-content ul, #settings-content dl {
    font-size: 0.95em;
    line-height: 1.7;
    color: #ddd;
}
#settings-content ul {
    padding-left: 20px;
    list-style: disc; /* ルール説明用 */
}
#settings-rules-content ul { list-style-type: '🎲 '; } /* ルール用絵文字 */
#settings-content li {
    margin-bottom: 8px;
}
#settings-content dt {
    font-weight: bold;
    color: #ffeb3b;
    margin-top: 15px;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
}
#settings-content dd {
    margin-left: 15px;
    margin-bottom: 8px;
    line-height: 1.5;
    color: #d0d8e8;
}
#settings-content strong {
    font-weight: bold;
}
.settings-tab-content {
    display: none;
    animation: fadeIn 0.3s ease-out;
}
.settings-tab-content.active {
    display: block;
}
/* 支払い倍率の色調整 */
#settings-content .payout-win { color: #ffb74d; } /* オレンジ系 */
#settings-content .payout-win-normal { color: #ffeb3b; } /* イエロー系 */
#settings-content .payout-lose { color: #ff7b7b; } /* レッド系 */
#settings-content .payout-neutral { color: #ccc; }
/* スコア計算説明 */
.score-calculation-info {
    background-color: rgba(0, 0, 0, 0.2);
    padding: 15px 20px;
    border-radius: 8px;
    margin-bottom: 25px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}
.score-calculation-info h4 {
    margin-top: 0;
    margin-bottom: 10px;
    color: #eee;
    font-size: 1.1em;
    text-align: center;
    border-bottom: none;
}
.score-calculation-info p {
    margin-bottom: 8px;
    font-size: 0.9em;
    line-height: 1.6;
    color: #ccc;
}
.calculation-formula {
    font-family: monospace;
    font-size: 1em;
    background-color: rgba(0, 0, 0, 0.3);
    padding: 10px;
    border-radius: 4px;
    text-align: center;
    word-wrap: break-word;
}
.calculation-formula strong { color: #ffeb3b; }
.calculation-formula .formula-part { color: #aaa; }
.score-calculation-info small {
    font-size: 0.8em;
    color: #aaa;
    display: block;
    text-align: center;
    margin-top: 5px;
}
.tooltip {
    position: relative;
    border-bottom: 1px dotted #aaa;
    cursor: help;
    color: #87CEFA;
}
.tooltip:hover::after {
    content: attr(title);
    position: absolute;
    bottom: 120%;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(50, 50, 70, 0.95);
    color: #eee;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 0.8em;
    white-space: nowrap;
    z-index: 10;
    box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    border: 1px solid rgba(255, 255, 255, 0.1);
    font-family: 'M PLUS Rounded 1c', sans-serif;
    font-weight: normal;
    font-style: normal;
}
.card-effect-rate { /* 役ごとの現在倍率表示 */
    font-size: 0.85em;
    color: #aaa;
    margin-left: 15px;
    margin-top: -5px;
    margin-bottom: 10px;
    font-style: italic;
}
.card-effect-rate span {
    font-weight: bold;
    color: #87CEFA;
    font-style: normal;
}
/* ルール説明の強調 */
#settings-rules-content h4 {
    font-size: 1.1em;
    color: #87CEFA;
    margin-top: 20px;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px dotted rgba(135, 206, 250, 0.6);
    font-weight: bold;
}
#settings-rules-content h4:first-of-type {
    margin-top: 0;
}
#settings-rules-content li {
    margin-bottom: 10px;
    line-height: 1.8;
    color: #d8d8d8;
}
#settings-rules-content strong {
    color: #ffeb3b;
    font-weight: bold;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.4);
}

/* ===== カード一覧モーダル(設定内) ===== */
.card-list-filter-tabs {
    display: flex;
    justify-content: flex-start;
    gap: 5px;
    margin-bottom: 15px;
    padding-left: 5px;
    border-bottom: 2px solid rgba(0, 255, 255, 0.3);
}
.filter-tab {
    padding: 8px 15px;
    font-size: 0.9em;
    background-color: transparent;
    color: #aaa;
    border: none;
    border-top-left-radius: 6px;
    border-top-right-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    bottom: -2px;
    border-bottom: 2px solid transparent;
    font-weight: 500;
    box-shadow: none;
}
.filter-tab:hover { color: #0ff; }
.filter-tab.active {
    color: #ffeb3b;
    border-bottom: 2px solid #ffeb3b;
    font-weight: bold;
}
/* フィルタリング用クラス */
#settings-card-list-content.filter-active .card-type-passive { display: none; }
#settings-card-list-content.filter-passive .card-type-active { display: none; }

#settings-card-list-inner {
    margin-top: 10px;
    /* スクロールは親(#settings-content)に任せる */
}
/* #settings-card-list-content {
    max-height: 60vh;
    overflow-y: auto;
    text-align: left;
    padding-right: 10px;
} */ /* スクロール削除 */

.card-list-item {
    background-color: rgba(40, 45, 65, 0.6);
    margin-bottom: 12px;
    padding: 15px 20px;
    border-radius: 8px;
    border-left: 6px solid #888; /* タイプ別色は h3 内で */
    transition: opacity 0.3s ease, max-height 0.3s ease;
    overflow: hidden;
    position: relative;
}
.card-list-item h3 {
    margin: 0 0 8px 0;
    color: #ffeb3b;
    font-size: 1.2em;
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    flex-wrap: wrap;
    gap: 5px 15px;
}
.card-list-item h3 .card-meta {
    font-size: 0.8em;
    color: #ccc;
    font-weight: normal;
}
.card-list-item h3 .card-meta span {
    margin-left: 10px;
    font-weight: normal;
}
/* タイプ・レアリティ表示スタイル */
.card-list-item h3 .card-meta .type-support,
.card-list-item h3 .card-meta .type-dice,
.card-list-item h3 .card-meta .type-score { font-weight: 500; }
.card-list-item h3 .card-meta .rarity-normal,
.card-list-item h3 .card-meta .rarity-rare,
.card-list-item h3 .card-meta .rarity-epic,
.card-list-item h3 .card-meta .rarity-legendary { font-weight: bold; }
/* レアリティ・タイプ色 */
.card-list-item h3 .rarity-normal { color: #bdbdbd; }
.card-list-item h3 .rarity-rare { color: #64b5f6; }
.card-list-item h3 .rarity-epic { color: #ba68c8; }
.card-list-item h3 .rarity-legendary { color: #ffb74d; }
.card-list-item h3 .type-support { color: #81b7f3; }
.card-list-item h3 .type-dice { color: #f18a8a; }
.card-list-item h3 .type-score { color: #77cc87; }
/* カードタイプに応じた左ボーダー */
.card-list-item.card-type-active { border-left-color: #f18a8a; } /* ダイス色 */
.card-list-item.card-type-passive { border-left-color: #81b7f3; } /* サポート色 */
/* 必要ならスコアタイプも */
/* .card-list-item.type-score { border-left-color: #77cc87; } */

.card-list-item p {
    margin: 5px 0;
    line-height: 1.5;
    font-size: 0.95em;
}
.card-list-item .flavor-text {
    font-style: italic;
    color: #bbb;
    font-size: 0.9em;
    margin-bottom: 8px;
}
.card-list-item .effect-details {
    display: block; /* 常に表示 */
    font-size: 0.9em;
    color: #e0e0e0;
    background-color: rgba(0,0,0,0.2);
    padding: 8px;
    border-radius: 4px;
    margin-top: 8px;
}
.effect-details .effect-level-title {
    margin-top: 8px;
    margin-bottom: 2px;
    color: #ffcc70;
}
.effect-details .effect-level-description {
    padding-left: 10px;
    border-left: 2px solid rgba(255, 255, 255, 0.1);
    margin-bottom: 8px;
    font-size: 0.9em;
    line-height: 1.5;
    overflow-wrap: break-word;
    word-break: break-word;
}
.effect-details .effect-level-title:first-of-type {
    margin-top: 0;
}

/* ===== 設定モーダル - オプションタブ ===== */
#settings-options-content {
    padding: 15px;
}
.settings-option-group {
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px dashed rgba(255, 255, 255, 0.15);
}
.settings-option-group:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
}
.settings-option-group h4 {
    font-size: 1.1em;
    color: #c0d8ff;
    margin-top: 0;
    margin-bottom: 15px;
    font-weight: 500;
}
.volume-slider-container {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    gap: 10px;
}
.volume-slider-container label {
    width: 120px; /* 固定幅 */
    text-align: right;
    font-size: 0.9em;
    color: #ccc;
}
.volume-slider-container input[type="range"] {
    flex-grow: 1;
    cursor: pointer;
    height: 8px;
    background: linear-gradient(to right, #0ff 0%, #0ff var(--value-percent, 50%), #3a3f50 var(--value-percent, 50%), #3a3f50 100%);
    border-radius: 4px;
    outline: none;
    appearance: none;
    -webkit-appearance: none;
    transition: background 0.1s ease-in-out;
}
/* スライダーのつまみ (Webkit) */
.volume-slider-container input[type="range"]::-webkit-slider-thumb {
    appearance: none;
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    background: #ffeb3b;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid #a08d2a;
    box-shadow: 0 0 6px rgba(255, 235, 59, 0.8);
}
/* スライダーのつまみ (Firefox) */
.volume-slider-container input[type="range"]::-moz-range-thumb {
    width: 16px; /* Firefoxはborder含めたサイズで指定 */
    height: 16px;
    background: #ffeb3b;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid #a08d2a;
    box-shadow: 0 0 6px rgba(255, 235, 59, 0.8);
}
/* スライダーの値表示 */
.volume-slider-container span {
    min-width: 45px;
    text-align: right;
    font-size: 0.9em;
    color: #ffeb3b;
    font-weight: bold;
    font-family: 'Orbitron', sans-serif;
}
.settings-option-group button {
    display: block;
    width: 80%;
    max-width: 250px;
    margin: 15px auto 5px auto;
    padding: 10px 20px;
    font-size: 1em;
    /* .button-subtle スタイルを継承 */
}
.settings-note {
    font-size: 0.8em;
    color: #aaa;
    text-align: center;
    margin-top: 0;
    margin-bottom: 15px;
}

/* ===== ショップ画面レイアウト ===== */
#shop-screen {
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 1vh 1vw;
    box-sizing: border-box;
    z-index: 1;
    overflow: hidden;
    position: relative;
}
#shop-screen::before { /* 背景パーティクル */
    content: "";
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background-image: radial-gradient(rgba(0, 255, 255, 0.15) 1px, transparent 1px),
                      radial-gradient(rgba(255, 0, 255, 0.1) 1px, transparent 1px);
    background-size: 100px 100px, 150px 150px;
    background-position: 0 0, 25px 25px;
    animation: particles 40s linear infinite;
    opacity: 0;
    animation: fadeInParticles 2s 0.5s forwards;
    z-index: 1;
    pointer-events: none;
}

.shop-outer-container {
    width: 98%;
    max-width: 1300px;
    max-height: 95vh;
    background-color: rgba(35, 35, 55, 0.9);
    border-radius: 15px;
    border: 1px solid rgba(120, 100, 255, 0.4);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
    z-index: 2;
    margin: 1vh auto;
    box-shadow: 0 8px 40px rgba(0, 0, 0, 0.7),
        inset 0 0 20px rgba(15, 20, 40, 0.7),
        0 0 25px rgba(120, 100, 255, 0.4);
    animation: shopContainerPulse 6s infinite alternate;
}

.shop-header {
    width: 100%;
    box-sizing: border-box;
    background-color: rgba(40, 40, 60, 0.95);
    padding: 8px 20px 5px 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.15);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
    flex-shrink: 0;
    z-index: 3;
    text-align: center;
}
#shop-scrollable-offers {
    flex-grow: 1;
    overflow-y: auto;
    padding: 10px 15px;
    background-color: rgba(30, 30, 50, 0.9);
    z-index: 1;
    /* スクロールバー統一 */
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 255, 255, 0.5) rgba(15, 20, 40, 0.8);
}
#shop-scrollable-offers::-webkit-scrollbar { width: 8px; }
#shop-scrollable-offers::-webkit-scrollbar-track { background: rgba(15, 20, 40, 0.8); border-radius: 4px;}
#shop-scrollable-offers::-webkit-scrollbar-thumb { background-color: rgba(0, 255, 255, 0.5); border-radius: 4px; border: 1px solid rgba(0, 255, 255, 0.7);}
#shop-scrollable-offers::-webkit-scrollbar-thumb:hover { background-color: rgba(0, 255, 255, 0.8); }

.shop-footer {
    width: 100%;
    box-sizing: border-box;
    background-color: rgba(40, 40, 60, 0.95);
    padding: 10px 20px 10px 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.15);
    box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.4);
    flex-shrink: 0;
    z-index: 3;
}

/* ショップタイトル (看板風) */
.shop-title-container {
    position: relative;
    display: inline-block;
    margin-bottom: 8px;
    filter: drop-shadow(0 0 8px rgba(0, 255, 255, 0.6));
    animation: signSway 8s infinite ease-in-out;
    transform-origin: top center;
}
.shop-title {
    font-size: 2.5em;
    font-family: 'Yuji Syuku', serif;
    color: #0ff;
    margin: 0;
    padding: 5px 20px;
    display: inline-block;
    position: relative;
    z-index: 1;
    background: rgba(10, 10, 20, 0.7);
    border-radius: 5px;
    border: 2px solid rgba(0, 255, 255, 0.5);
    box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.3);
}
.shop-title-text {
    position: relative;
    z-index: 2;
    display: inline-block;
    animation: textNeonFlicker 4s infinite alternate;
}
.shop-title .neon-yellow { color: #ff0; animation: textNeonFlickerYellow 3.5s infinite alternate; }
.shop-title .neon-pink { color: #f0f; animation: textNeonFlickerPink 4.5s infinite alternate; }
.shop-title-container::before, .shop-title-container::after {
    content: '';
    position: absolute;
    border-radius: 8px;
    z-index: 0;
    pointer-events: none;
}
.shop-title-container::before {
    inset: -6px;
    border: 3px solid #ffcc00;
    box-shadow: 0 0 10px #ffcc00, inset 0 0 5px rgba(255, 204, 0, 0.5);
    animation: signBorderFlicker 2s infinite linear;
}
.shop-title-container::after {
    inset: -2px;
    border: 1px dashed rgba(255, 0, 255, 0.7);
    opacity: 0.8;
}

/* プレイヤー状況 */
#player-status {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 5px;
    background-color: rgba(0,0,0,0.2);
    padding: 4px 8px;
    border-radius: 4px;
    flex-wrap: wrap;
    gap: 5px 15px;
}
#coin-display {
    font-size: 1em;
    color: #ffeb3b;
    font-weight: bold;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
    text-align: left;
    flex-basis: auto; /* 自動幅 */
    font-family: 'Orbitron', sans-serif;
}
#coin-display #player-coins {
    font-size: 1.4em; /* Gと同じサイズに */
}
#shop-player-score {
    font-size: 1.1em;
    color: #eee;
    font-weight: bold;
    text-align: center;
    flex-basis: auto; /* 自動幅 */
    font-family: 'Orbitron', sans-serif;
}
#shop-player-score-value { color: #ffeb3b; font-family: 'Orbitron', sans-serif; }
#shop-player-hand {
    font-size: 0.8em;
    color: #ccc;
    text-align: right;
    flex-basis: 100%; /* 幅100% */
    max-width: none; /* 最大幅解除 */
    font-family: 'M PLUS Rounded 1c', sans-serif;
}
#hand-cards {
    list-style: none;
    padding: 0;
    margin: 3px 0 0 0;
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-end; /* 右寄せ */
    gap: 4px 6px;
    max-height: 40px; /* 高さを制限 */
    overflow-y: auto; /* スクロール可能に */
    /* スクロールバー統一 */
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, 0.1) rgba(0,0,0,0.1);
}
#hand-cards::-webkit-scrollbar { height: 4px; width: 4px; }
#hand-cards::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
#hand-cards::-webkit-scrollbar-thumb { background-color: rgba(255, 255, 255, 0.2); border-radius: 2px;}
.hand-card-item {
    background-color: rgba(255, 255, 255, 0.1);
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 0.9em;
    white-space: nowrap;
    cursor: default;
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: 'M PLUS Rounded 1c', sans-serif;
}
.sell-card-button { /* 売却ボタン */
    background-color: rgba(220, 53, 69, 0.7); /* 赤系 */
    color: #eee;
    border: none;
    border-radius: 10px;
    padding: 2px 6px;
    font-size: 0.8em;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s ease;
    font-family: 'M PLUS Rounded 1c', sans-serif;
}
.sell-card-button:hover {
    background-color: rgba(220, 53, 69, 0.9);
}
.shop-message {
    font-size: 0.9em;
    color: #ffcc70;
    text-shadow: 0 0 3px #ffcc70;
    margin-bottom: 5px;
    min-height: 1em;
    font-family: 'M PLUS Rounded 1c', sans-serif;
}

/* オファーコンテナとセクション */
.shop-offers-container {
    width: 100%;
    margin-bottom: 0; /* 下マージン削除 */
}
.shop-section {
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px dashed rgba(255, 255, 255, 0.15);
}
.shop-section:last-child {
    margin-bottom: 0;
    border-bottom: none;
    padding-bottom: 0;
}
.shop-section-title {
    font-size: 1.4em;
    color: #ffcc70;
    text-align: left;
    margin-top: 0;
    margin-bottom: 15px;
    padding-left: 15px;
    font-weight: 500;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.5), 0 0 8px #ffcc70;
    position: relative;
    border-left: 4px solid #ffcc70;
    animation: titleGlowYellow 3s infinite alternate;
    font-family: 'M PLUS Rounded 1c', sans-serif;
}
.shop-item-row {
    display: flex;
    flex-wrap: nowrap; /* 横スクロール */
    gap: 15px;
    justify-content: flex-start;
    padding: 8px 12px;
    background-color: rgba(0, 0, 0, 0.15);
    border-radius: 8px;
    min-height: 150px; /* 高さを確保 */
    align-items: stretch; /* 高さを揃える */
    overflow-x: auto; /* 横スクロール */
    /* スクロールバー統一 */
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 255, 255, 0.5) rgba(15, 20, 40, 0.8);
}
.shop-item-row::-webkit-scrollbar { height: 8px; }
.shop-item-row::-webkit-scrollbar-track { background: rgba(15, 20, 40, 0.8); border-radius: 4px;}
.shop-item-row::-webkit-scrollbar-thumb { background-color: rgba(0, 255, 255, 0.5); border-radius: 4px; border: 1px solid rgba(0, 255, 255, 0.7);}
.shop-item-row::-webkit-scrollbar-thumb:hover { background-color: rgba(0, 255, 255, 0.8); }

.shop-empty-message {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    color: #888;
    font-style: italic;
    min-height: 100px;
    font-family: 'M PLUS Rounded 1c', sans-serif;
}

/* ショップアクションエリア */
#shop-actions, #shop-confirmation-buttons {
    display: flex;
    justify-content: space-between; /* 基本は両端揃え */
    align-items: center;
    margin-top: 0; /* 上マージン削除 */
    padding-top: 0; /* 上パディング削除 */
    border-top: none; /* 上ボーダー削除 */
}
#shop-confirmation-buttons {
    justify-content: center; /* 確認ボタンは中央揃え */
    gap: 15px;
}
#reroll-button {
    padding: 5px 15px;
    font-size: 1.2em;
    background: linear-gradient(180deg, #5bc0de, #31b0d5);
    color: white;
    font-family: 'Orbitron', sans-serif;
    /* .button-pop ベース */
}
#reroll-button:hover:not(:disabled) {
    background: linear-gradient(180deg, #70cce6, #4ac0e0);
    transform: translateY(-1px);
    box-shadow: 0 3px 6px rgba(0,0,0,0.3);
}
.reroll-icon {
    font-size: 1.4em;
    margin-right: 5px;
    vertical-align: middle;
    display: inline-block;
    transition: transform 0.5s ease;
}
#reroll-button:hover:not(:disabled) .reroll-icon {
    transform: rotate(180deg);
}
#close-shop-button {
    padding: 10px 25px;
    font-size: 1.4em;
    cursor: pointer;
    border: none;
    border-radius: 20px;
    color: white;
    font-weight: bold;
    transition: all 0.2s ease;
    text-shadow: 0px -1px 1px rgba(0,0,0,0.4);
    box-shadow: 0 3px 5px rgba(0,0,0,0.3);
    background: linear-gradient(180deg, #f0ad4e, #ec971f);
    margin-top: 0;
    font-family: 'M PLUS Rounded 1c', sans-serif;
}
#close-shop-button:hover {
    background: linear-gradient(180deg, #f3bc70, #f0a540);
    transform: translateY(-2px);
    box-shadow: 0 5px 10px rgba(236, 151, 31, 0.4);
}
#shop-confirmation-buttons button {
    padding: 10px 25px;
    font-size: 1.1em;
    font-family: 'M PLUS Rounded 1c', sans-serif;
}

/* ショップカード/パック/ブースト要素 */
.card, .pack, .boost-item {
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 10px;
    padding: 15px 15px 50px 15px; /* フッター分の下パディング */
    width: 200px;
    height: 280px;
    flex-shrink: 0; /* 縮まない */
    box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4), inset 0 0 5px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    position: relative;
    overflow: hidden;
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    text-align: center;
}
.card { background-color: rgba(60, 60, 90, 0.8); }
.pack { background-color: rgba(80, 60, 100, 0.8); }
.boost-item { background-color: rgba(100, 80, 60, 0.8); }

.card:not(.sold-out):hover {
    transform: translateY(-8px) scale(1.05);
    box-shadow: 8px 12px 25px rgba(0, 0, 0, 0.6),
                inset 0 0 10px rgba(0,0,0,0.4),
                0 0 20px var(--rarity-glow-color, rgba(255, 255, 255, 0.3));
}
.pack:not(.sold-out):hover, .boost-item:not(.sold-out):hover {
    transform: translateY(-8px) scale(1.05);
    box-shadow: 8px 12px 25px rgba(0, 0, 0, 0.6), inset 0 0 10px rgba(0,0,0,0.4), 0 0 15px rgba(111, 168, 220, 0.5);
}
.card.rarity-rare:hover { --rarity-glow-color: rgba(74, 144, 226, 0.6); }
.card.rarity-epic:hover { --rarity-glow-color: rgba(156, 39, 176, 0.7); }
.card.rarity-legendary:hover { --rarity-glow-color: rgba(255, 152, 0, 0.8); }

.card::before { /* シャイニングエフェクト */
    content: "";
    position: absolute;
    top: 0; left: -85%;
    z-index: 2;
    display: block;
    width: 50%; height: 100%;
    background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,.3) 50%, rgba(255,255,255,0) 100%);
    transform: skewX(-25deg);
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
}
.card.rarity-rare::before,
.card.rarity-epic::before,
.card.rarity-legendary::before {
    animation: shining 3s infinite linear;
    opacity: 1;
}
.card.rarity-rare::before { animation-duration: 3.5s; }
.card.rarity-epic::before { animation-duration: 2.8s; }
.card.rarity-legendary::before { width: 70%; animation-duration: 2.2s; animation-delay: .2s; }

.card.rarity-epic::after { /* エピックカードキラキラ */
    content: '';
    position: absolute;
    inset: -2px;
    background-image: radial-gradient(circle, rgba(255,255,255,0.7) 0.5px, transparent 0.5px),
                      radial-gradient(circle, rgba(255,255,255,0.5) 0.5px, transparent 0.5px);
    background-size: 10px 10px, 20px 20px;
    background-position: 0 0, 5px 5px;
    opacity: 0;
    animation: sparkleEpic 3s infinite linear;
    pointer-events: none;
    z-index: 1;
    border-radius: inherit;
}

.card-type-badge, .card-rarity-badge {
    position: absolute;
    top: 0;
    padding: 3px 10px;
    font-size: 0.8em;
    font-weight: bold;
    color: #fff;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    z-index: 1;
}
.card-type-badge { left: 0; border-radius: 10px 0 10px 0; }
.card-rarity-badge { right: 0; border-radius: 0 10px 0 10px; }
/* レアリティ・タイプ色定義 */
.card.rarity-normal .card-rarity-badge, .rarity-normal { background-color: #9e9e9e; }
.card.rarity-rare .card-rarity-badge, .rarity-rare { background-color: #4a90e2; }
.card.rarity-epic .card-rarity-badge, .rarity-epic { background-color: #9c27b0; }
.card.rarity-legendary .card-rarity-badge, .rarity-legendary { background-color: #ff9800; }
.card.type-support .card-type-badge, .type-support { background-color: #4a90e2; }
.card.type-dice .card-type-badge, .type-dice { background-color: #e65252; }
.card.type-score .card-type-badge, .type-score { background-color: #28a745; }
/* パックとブーストアイテムのタイプ */
.pack .card-type-badge, .boost-item .card-type-badge { display: none; } /* タイプ表示不要 */
.pack .card-rarity-badge, .boost-item .card-rarity-badge { /* レアリティは表示するかも */
    /* 必要ならスタイル定義 */
}

.card-name {
    font-size: 1.2em;
    color: #ffcc70;
    margin-top: 15px; /* バッジと重ならないように */
    margin-bottom: 8px;
    font-weight: 800;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
    background-color: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 5px 10px;
    border-radius: 8px;
    display: inline-block;
    line-height: 1.3;
    text-align: center;
    font-family: 'Yuji Syuku', serif;
}
.pack .card-name, .boost-item .card-name { /* パックとブーストの名前 */
    font-size: 1.1em;
    color: #ffcc70;
    margin-top: 25px; /* 画像がない分上に */
    margin-bottom: 10px;
    font-weight: bold;
    font-family: 'Yuji Syuku', serif;
}
.card-name .card-level {
    display: block;
    font-size: 0.8em;
    color: #ffcc70;
    font-weight: normal;
    font-family: 'M PLUS Rounded 1c', sans-serif;
}
.card-level-value-2 { color: #90ee90; text-shadow: 0 0 3px #28a745; font-weight: bold;}
.card-level-value-3 { color: #ff8c00; text-shadow: 0 0 5px #ffeb3b; font-weight: bold;}
.card-description { display: none; } /* ショップでは詳細モーダルで表示 */

.card-footer {
    position: absolute;
    bottom: 10px;
    left: 5px;
    right: 5px;
    display: flex;
    justify-content: center; /* 中央揃え */
    align-items: center;
    padding-top: 0;
    border-top: none;
    gap: 10px;
}
.card-detail-button { /* 詳細ボタンは .button-subtle を継承 */
    padding: 5px 10px;
    font-size: 0.8em;
    border-radius: 12px;
    flex-shrink: 0;
    font-family: 'M PLUS Rounded 1c', sans-serif;
}
.card-cost {
    font-size: 1.1em;
    font-weight: bold;
    color: #ffeb3b;
    background-color: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 5px 10px;
    border-radius: 15px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    margin-left: 0;
    margin-right: 0;
    flex-shrink: 0; /* 縮まない */
    font-family: 'Orbitron', sans-serif;
}
.pack .card-cost, .boost-item .card-cost {
    margin-right: auto; /* ボタンが右にある場合、コストを左に寄せる */
}
.card.upgradeable.max-level .card-cost,
.boost-item.sold-out .card-cost /* 購入済みブースト */
{
    color: #aaa;
    font-style: italic;
    font-weight: normal;
    background-color: rgba(50, 50, 50, 0.4);
    border-color: rgba(150, 150, 150, 0.4);
    font-family: 'Orbitron', sans-serif;
}
.buy-button { /* 購入ボタン */
    padding: 5px 15px;
    font-size: 0.9em;
    cursor: pointer;
    border: none;
    border-radius: 15px;
    color: white;
    font-weight: bold;
    transition: all 0.2s ease;
    text-shadow: 0 -1px 1px rgba(0,0,0,0.5);
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    background: linear-gradient(180deg, #ffeb3b, #ffc107);
    flex-shrink: 0;
    font-family: 'M PLUS Rounded 1c', sans-serif;
}
.buy-button:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(255, 200, 0, 0.4);
}
.upgrade-button { /* 強化ボタン */
    background: linear-gradient(180deg, #90ee90, #28a745);
    color: white;
    padding: 5px 15px; /* buy-buttonと合わせる */
    font-size: 0.9em; /* buy-buttonと合わせる */
    border-radius: 15px; /* buy-buttonと合わせる */
    font-family: 'M PLUS Rounded 1c', sans-serif;
    text-shadow: 0 -1px 1px rgba(0,0,0,0.5);
}
.upgrade-button:hover:not(:disabled) {
    background: linear-gradient(180deg, #a0f0a0, #30c050);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(40, 167, 69, 0.4);
}
.pack .buy-button, .boost-item .buy-button { /* パック・ブーストの購入ボタン */
    background: linear-gradient(180deg, #6fa8dc, #4a90e2);
    color: white;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    text-shadow: 0 -1px 1px rgba(0,0,0,0.5);
}
.pack .buy-button:hover:not(:disabled), .boost-item .buy-button:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(74, 144, 226, 0.4);
    background: linear-gradient(180deg, #81b7f3, #5aa1e9);
}

/* 状態別スタイル */
.card.upgradeable { /* 強化可能 */
    border-color: #ffeb3b;
    position: relative;
    animation: upgradePulse 1.8s infinite ease-in-out;
}
.card.upgradeable:not(.sold-out):hover {
    box-shadow: 0 0 25px rgba(255, 235, 59, 0.6), inset 0 0 12px rgba(255, 235, 59, 0.25), 5px 10px 15px rgba(0, 0, 0, 0.5);
}
.card.upgradeable-lv3 { /* Lv3強化可能 */
    border-color: #ff8c00; /* オレンジ色 */
    animation: upgradePulseLv3 1.8s infinite ease-in-out; /* 別のパルス */
}
.card.upgradeable-lv3:not(.sold-out):hover {
    box-shadow: 0 0 30px rgba(255, 140, 0, 0.7), inset 0 0 15px rgba(255, 140, 0, 0.3), 5px 10px 15px rgba(0, 0, 0, 0.5);
}
.card.upgradeable.max-level { /* 最大レベル */
    filter: grayscale(50%);
    border-color: #aaa;
    box-shadow: inset 0 0 10px rgba(0,0,0,0.4), 3px 3px 8px rgba(0, 0, 0, 0.4);
    animation: none;
}
.card.upgradeable.max-level .upgrade-button { display: none; }

.card.sold-out, .pack.sold-out, .boost-item.sold-out { /* 売却済み */
    opacity: 0.55;
    pointer-events: none;
    position: relative;
    box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4), inset 0 0 5px rgba(0,0,0,0.2);
    animation: none;
    border-color: rgba(255, 255, 255, 0.15);
}
.card.sold-out::after, .pack.sold-out::after, .boost-item.sold-out::after {
    content: "SOLD OUT";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(-15deg) scale(1.1);
    background-color: rgba(220, 53, 69, 0.9);
    color: white;
    padding: 10px 18px;
    font-size: 1.3em;
    font-weight: bold;
    border-radius: 8px;
    z-index: 10;
    text-shadow: 2px 2px 3px rgba(0,0,0,0.6);
    box-shadow: 3px 3px 7px rgba(0,0,0,0.4);
    white-space: nowrap;
    border: 2px solid rgba(255, 255, 255, 0.5);
}
.card.sold-out .card-footer, .pack.sold-out .card-footer, .boost-item.sold-out .card-footer { display: none; }

/* カード破棄モーダル */
.discard-modal-content {
    max-width: 500px;
    text-align: center;
}
#discard-options {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-bottom: 25px;
}
.discard-choice-button {
    padding: 8px 15px;
    font-size: 0.9em;
    cursor: pointer;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 15px;
    background-color: rgba(255, 255, 255, 0.1);
    color: #eee;
    transition: background-color 0.2s ease, border-color 0.2s ease;
}
.discard-choice-button:hover {
    background-color: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.4);
}
.discard-choice-button.new-card-option { /* 保持する新カード */
    background-color: rgba(70, 70, 100, 0.5);
    border-color: rgba(150, 150, 180, 0.4);
    color: #bbb;
    cursor: default;
}
.discard-choice-button.new-card-option:hover { /* ホバー効果なし */
    background-color: rgba(70, 70, 100, 0.5);
}

/* ショップ キープ機能 */
.shop-keep-toggle {
    position: absolute;
    bottom: 55px; /* フッターと重ならないように */
    left: 8px;
    width: 45px;
    height: 22px;
    padding: 2px 5px;
    font-size: 0.7em;
    font-weight: bold;
    color: rgba(255, 255, 255, 0.6);
    background-color: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    cursor: pointer;
    transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
    z-index: 3;
    text-align: center;
    line-height: 16px; /* 縦中央揃え */
    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
}
.shop-keep-toggle:hover {
    background-color: rgba(50, 50, 50, 0.6);
    border-color: rgba(255, 255, 255, 0.4);
    color: #fff;
}
.shop-keep-toggle.kept {
    background-color: #ffeb3b;
    color: #333;
    border-color: #fdd835;
    font-weight: 800;
    box-shadow: 0 0 8px rgba(255, 235, 59, 0.7);
}
.card.item-kept, .pack.item-kept, .boost-item.item-kept {
    position: relative; /* ステッカー基準 */
}
.card.item-kept::after, .pack.item-kept::after, .boost-item.item-kept::after { /* KEEPステッカー */
    content: "KEEP";
    position: absolute;
    top: 8px;
    right: 8px;
    background-color: #ffeb3b;
    color: #333;
    padding: 3px 7px;
    font-size: 0.8em;
    font-weight: bold;
    border-radius: 4px;
    transform: rotate(10deg);
    box-shadow: 1px 1px 3px rgba(0,0,0,0.4);
    z-index: 4;
    pointer-events: none;
}
/* 購入済みはキープボタン/ステッカー非表示 */
.shop-item.sold-out .shop-keep-toggle,
.card.sold-out .shop-keep-toggle,
.card.item-kept.sold-out::after,
.pack.item-kept.sold-out::after,
.boost-item.item-kept.sold-out::after {
    display: none;
}

/* ===== ダイス選択オーバーレイ ===== */
#dice-choice-overlay {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: rgba(20, 20, 30, 0.9);
    display: none; /* JSで制御 */
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 50;
    border-radius: 12px; /* 親に合わせる */
    padding: 25px;
    box-sizing: border-box;
    border: 2px solid rgba(255, 215, 0, 0.6);
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.3), inset 0 0 15px rgba(0,0,0,0.5);
    animation: modalFadeIn 0.3s ease-out;
}
#dice-choice-overlay h3 {
    color: #ffdd57;
    margin-bottom: 15px;
    font-size: 1.5em;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
    border-bottom: 1px solid rgba(255, 221, 87, 0.3);
    padding-bottom: 10px;
}
#dice-choice-overlay p {
    color: #eee;
    margin-bottom: 25px;
    font-size: 1.1em;
    text-align: center;
}
.dice-choice-buttons {
    display: flex;
    flex-direction: row; /* 横並び */
    gap: 15px;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap; /* 折り返し */
    width: 100%;
}
.dice-choice-button { /* ダイスボタン */
    font-size: 2.5em;
    padding: 0;
    font-family: 'M PLUS Rounded 1c', sans-serif;
    min-width: 70px;
    height: 70px;
    line-height: 70px; /* 垂直中央 */
    text-align: center;
    background: linear-gradient(145deg, #f8f8f8, #d8d8d8);
    color: #333;
    border: 1px solid #aaa;
    border-radius: 10px;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.4), inset 1px 1px 3px rgba(255,255,255,0.6);
    cursor: pointer;
    transition: transform 0.15s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.15s ease;
}
.dice-choice-button:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 4px 6px 10px rgba(0,0,0,0.5), inset 1px 1px 3px rgba(255,255,255,0.7);
    border-color: #888;
}
.dice-choice-button:active {
    transform: translateY(1px) scale(0.98);
    box-shadow: 1px 1px 3px rgba(0,0,0,0.3), inset 1px 1px 3px rgba(0,0,0,0.3);
}
#dice-choice-overlay .button-subtle { /* キャンセルボタン */
    margin-top: 25px;
    padding: 8px 25px;
    font-size: 1em;
    width: auto; /* 幅自動 */
}

/* ===== サイコロロールモーダル ===== */
#dice-roll-modal {
    z-index: 1040; /* 役結果より下、他より上 */
}
.dice-roll-modal-content {
    background: none;
    border: none;
    box-shadow: none;
    max-width: 60vw; /* 幅調整 */
    width: 60vw;
    aspect-ratio: 16 / 9;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    animation: rollModalAppearPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative; /* 閉じるボタン用 */
    overflow: hidden;
    margin: auto; /* 中央寄せ */
}
#dice-roll-modal-display { /* three.jsキャンバス用 */
    width: 100%;
    height: 100%;
}
.dice-roll-modal-content .close-button {
    top: 10px;
    right: 15px;
    z-index: 1051; /* 最前面 */
    color: rgba(255, 255, 255, 0.7);
    text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
}
.dice-roll-modal-content .close-button:hover {
    color: rgba(255, 255, 255, 1);
}

/* ===== カードアクションモーダル ===== */
.card-action-modal-content {
    max-width: 1100px; /* 幅広に */
    max-height: 85vh;
    display: flex;
    flex-direction: column;
    overflow-y: auto; /* 内容が多い場合スクロール */
    /* スクロールバー統一 */
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 255, 255, 0.5) rgba(15, 20, 40, 0.8);
}
.card-action-modal-content::-webkit-scrollbar { width: 8px; }
.card-action-modal-content::-webkit-scrollbar-track { background: rgba(15, 20, 40, 0.8); border-radius: 4px;}
.card-action-modal-content::-webkit-scrollbar-thumb { background-color: rgba(0, 255, 255, 0.5); border-radius: 4px; border: 1px solid rgba(0, 255, 255, 0.7);}
.card-action-modal-content::-webkit-scrollbar-thumb:hover { background-color: rgba(0, 255, 255, 0.8); }

.card-section {
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px dashed rgba(255, 255, 255, 0.2);
}
.card-section:last-child {
    margin-bottom: 0;
    border-bottom: none;
    padding-bottom: 0;
}
.card-section h3 {
    color: #ffcc70;
    font-size: 1.3em;
    margin-top: 0;
    margin-bottom: 8px;
    text-align: left;
    padding-left: 5px;
}
.card-section-message {
    font-size: 0.95em;
    color: #ccc;
    margin-bottom: 15px;
    min-height: 1.1em;
    text-align: left;
    padding-left: 5px;
    font-style: italic;
}
.card-display-area {
    display: flex;
    flex-wrap: nowrap; /* 横スクロール */
    gap: 15px;
    justify-content: flex-start;
    padding: 10px 10px;
    background-color: rgba(0, 0, 0, 0.15);
    border-radius: 8px;
    min-height: 290px; /* カードの高さに合わせる */
    align-items: stretch; /* 高さを揃える */
    overflow-x: auto; /* 横スクロール */
    /* スクロールバー統一 */
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 255, 255, 0.5) rgba(15, 20, 40, 0.8);
}
.card-display-area::-webkit-scrollbar { height: 8px; }
.card-display-area::-webkit-scrollbar-track { background: rgba(15, 20, 40, 0.8); border-radius: 4px;}
.card-display-area::-webkit-scrollbar-thumb { background-color: rgba(0, 255, 255, 0.5); border-radius: 4px; border: 1px solid rgba(0, 255, 255, 0.7);}
.card-display-area::-webkit-scrollbar-thumb:hover { background-color: rgba(0, 255, 255, 0.8); }

.card-display-area.empty {
    justify-content: center;
    align-items: center;
    color: #888;
    font-style: italic;
    min-height: 100px;
    overflow-x: hidden;
}
.card-action-item { /* 手札モーダルのカード */
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 10px;
    padding: 15px;
    width: 200px; /* 固定幅 */
    height: 280px; /* 固定高 */
    flex-shrink: 0; /* 縮まない */
    box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4), inset 0 0 5px rgba(0,0,0,0.2);
    display: flex;
    flex-direction: column;
    transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
    position: relative;
    overflow: hidden;
    background-size: cover;
    background-position: center center;
    background-repeat: no-repeat;
    background-color: rgba(60, 60, 90, 0.8);
    text-align: center;
    cursor: default;
    padding-bottom: 50px; /* フッター分 */
}
/* バッジ、名前、レベルのスタイルはショップカードと共通化可能なら検討 */
.card-action-item .card-type-badge, .card-action-item .card-rarity-badge { /* 位置決めなど */
    position: absolute; top: 0; padding: 3px 10px; font-size: 0.8em; font-weight: bold; color: #fff; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); z-index: 1;
}
.card-action-item .card-type-badge { left: 0; border-radius: 10px 0 10px 0; }
.card-action-item .card-rarity-badge { right: 0; border-radius: 0 10px 0 10px; }
/* 色指定は共通スタイルに依存 */
.card-action-item .card-name { /* サイズや位置調整 */
    font-size: 1.1em; color: #ffeb3b; margin-top: 25px; margin-bottom: 8px; font-weight: 800; text-shadow: 1px 1px 3px rgba(0,0,0,0.6); background-color: rgba(0, 0, 0, 0.4); border: 1px solid rgba(255, 255, 255, 0.2); padding: 5px 8px; border-radius: 8px; display: block; text-align: center; width: auto; margin-left: auto; margin-right: auto; max-width: 90%; box-sizing: border-box;
}
.card-action-item .card-level { /* 位置調整 */
    display: block; font-size: 0.8em; color: #ffcc70; font-weight: normal; text-align: center; margin-top: -5px; margin-bottom: 10px;
}
.card-action-item .card-level-value-2 { color: #90ee90; text-shadow: 0 0 3px #28a745; font-weight: bold;}
.card-action-item .card-level-value-3 { color: #ff8c00; text-shadow: 0 0 5px #ffeb3b; font-weight: bold;}
.card-action-item .card-item-footer { /* フッター位置 */
    position: absolute; bottom: 10px; left: 10px; right: 10px; display: flex; justify-content: space-between; align-items: center; gap: 8px;
}
.card-action-item .card-detail-button { /* .button-subtle継承 */
    padding: 6px 12px; font-size: 0.85em; flex-grow: 0;
}
.card-action-item .use-card-button { /* 使用ボタン */
    padding: 6px 12px; font-size: 0.85em; background: linear-gradient(180deg, #5bc0de, #31b0d5); color: white; flex-grow: 0;
    /* .button-pop ベース */
}
.card-action-item .use-card-button:hover:not(:disabled) {
    background: linear-gradient(180deg, #70cce6, #4ac0e0);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(49, 176, 213, 0.4);
}
.card-action-item .use-card-button:disabled { /* 無効化スタイル */
    /* 共通の button:disabled スタイルを継承 */
    background-color: #555 !important; /* 上書き */
}
/* パッシブ/使用済み/使用可能 状態 */
.card-action-item.passive .use-card-button { display: none; }
.card-action-item.passive .card-detail-button { width: 100%; } /* 詳細ボタンを広げる */
.card-action-item.used-up { opacity: 0.6; filter: grayscale(90%); }
.card-action-item.used-up .use-card-button { display: none; }
.card-action-item.used-up .card-detail-button { width: 100%; }
.card-action-item.usable { /* 使用可能 */
    cursor: default; /* カーソル変更不要 */
    border-color: cyan;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.5), 3px 3px 8px rgba(0, 0, 0, 0.4);
    animation: usableCardPulse 1.8s infinite ease-in-out;
}
.card-action-item.usable:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.7), 5px 7px 12px rgba(0, 0, 0, 0.5);
}
.card-action-item.passive { /* パッシブ */
    cursor: default;
    animation: none;
    border-color: rgba(255, 255, 255, 0.15);
}
.card-action-item.passive:hover { /* ホバー効果なし */
    transform: none;
    box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4), inset 0 0 5px rgba(0,0,0,0.2);
}

/* ===== アイテム獲得演出モーダル ===== */
.item-reveal-modal {
    z-index: 1100; /* 最前面 */
    backdrop-filter: blur(8px) brightness(0.7); /* 背景効果 */
}
.item-reveal-content {
    background: radial-gradient(ellipse at center, rgba(50, 55, 80, 0.98) 0%, rgba(20, 25, 45, 0.99) 100%);
    border: 2px solid rgba(0, 255, 255, 0.2); /* 基本ボーダー */
    border-radius: 20px;
    box-shadow: 0 12px 45px rgba(0, 0, 0, 0.75);
    max-width: 450px;
    text-align: center;
    padding: 35px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.5s ease; /* レアリティボーダー色変化 */
    animation: itemRevealAppearPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    /* .modal-content スタイルを上書き・調整 */
}
.item-reveal-content.rarity-normal { border-color: #aaa; }
.item-reveal-content.rarity-rare { border-color: #64b5f6; box-shadow: 0 0 20px rgba(100, 181, 246, 0.6), 0 10px 40px rgba(0, 0, 0, 0.7); }
.item-reveal-content.rarity-epic { border-color: #ba68c8; box-shadow: 0 0 30px rgba(186, 104, 200, 0.7), 0 10px 40px rgba(0, 0, 0, 0.7); }
.item-reveal-content.rarity-legendary { border-color: #ffb74d; box-shadow: 0 0 40px rgba(255, 183, 77, 0.8), 0 10px 40px rgba(0, 0, 0, 0.7); animation: legendaryShineStrong 2s infinite linear, itemRevealAppearPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

#item-reveal-title {
    color: #ffcc70;
    margin-top: 0;
    margin-bottom: 20px;
    font-size: 1.8em;
    font-family: 'Yuji Syuku', serif;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}
#item-reveal-body {
    display: flex;
    flex-direction: column; /* 縦積み */
    align-items: center;
    gap: 15px;
    margin-bottom: 25px;
}
#item-reveal-image-container {
    width: 200px;
    height: 280px;
    background-color: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}
#item-reveal-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: none; /* JSで制御 */
}
#item-reveal-placeholder {
    color: #888;
    font-size: 0.9em;
    display: block; /* JSで制御 */
}
#item-reveal-details {
    text-align: center;
}
#item-reveal-name {
    font-size: 1.5em;
    color: #ffeb3b;
    margin-top: 0;
    margin-bottom: 8px;
    font-weight: bold;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
}
#item-reveal-meta {
    font-size: 0.9em;
    color: #ccc;
    margin-bottom: 12px;
    display: flex;
    justify-content: center;
    gap: 15px;
}
#item-reveal-meta .rarity-badge, #item-reveal-meta .type-badge {
    padding: 3px 8px;
    border-radius: 10px;
    font-weight: bold;
    text-shadow: 1px 1px 1px rgba(0,0,0,0.4);
}
/* レアリティ・タイプ色は共通スタイル利用 */
#item-reveal-description { /* 獲得時は非表示 */
    display: none;
}
#item-reveal-level { /* Lv表示 (強化時など) */
    font-size: 1.1em;
    color: #90ee90;
    font-weight: bold;
    margin-top: -5px;
    margin-bottom: 10px;
    display: none; /* JSで制御 */
}
#confirm-item-reveal-button { /* 確認ボタン */
    padding: 10px 30px;
    font-size: 1.1em;
    /* .button-pop スタイル継承 */
}

/* ===== 役/目 結果表示モーダル ===== */
.role-result-reveal-modal {
    z-index: 1050;
    background-color: rgba(0, 0, 0, 0.75); /* 半透明度調整 */
    backdrop-filter: blur(6px); /* ブラー調整 */
}
.role-result-reveal-content {
    background: none;
    border: none;
    box-shadow: none;
    padding: 0;
    max-width: 80vw;
    display: flex;
    justify-content: center;
    align-items: center;
    animation: none; /* 親のモーダルアニメーションは不要 */
}
#role-result-modal-body {
    text-align: center;
    opacity: 0;
    transform: scale(0.8);
    /* 各役に応じたスタイルは下に定義 */
}
#role-result-name {
    font-size: 7em; /* ベースサイズ */
    font-weight: 800;
    color: white;
    text-shadow: 3px 3px 0 #444, 6px 6px 10px rgba(0, 0, 0, 0.7);
    margin: 10px 0 0 0;
    line-height: 1.1;
    white-space: nowrap;
}
#role-result-dice-display {
    font-size: 4em; /* ベースサイズ */
    font-weight: bold;
    color: #eee;
    letter-spacing: 0.1em;
    margin-bottom: 15px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    font-family: 'M PLUS Rounded 1c', sans-serif; /* ダイス用フォント */
}
/* 出現・消滅アニメーション */
#role-result-modal-body.reveal-start { animation: roleRevealAppearGeneral 0.7s cubic-bezier(0.68, -0.6, 0.27, 1.55) forwards; }
#role-result-modal-body.reveal-end { animation: roleRevealFadeOut 0.3s ease-out forwards; }
/* 各役のスタイル */
.role-reveal-pinzoro #role-result-modal-body { background: radial-gradient(ellipse at center, rgba(255, 235, 59, 0.7) 0%, rgba(255, 215, 0, 0) 75%); border-radius: 50%; padding: 50px; box-shadow: 0 0 80px 30px rgba(255, 215, 0, 0.9); animation: roleRevealAppearGeneral 0.7s cubic-bezier(0.68, -0.6, 0.27, 1.55) forwards, pinzoroBgPulseStrong 1.5s infinite ease-in-out 0.7s; }
.role-reveal-pinzoro #role-result-name { font-family: 'Shippori Mincho', serif; font-size: 12em; color: gold; text-shadow: 0 0 15px white, 0 0 35px gold, 0 0 60px #fff, 6px 6px 10px rgba(0,0,0,0.7); filter: drop-shadow(0 0 25px gold); animation: pinzoroTextPopGlow 0.7s cubic-bezier(0.68, -0.6, 0.27, 1.55) forwards; }
.role-reveal-pinzoro #role-result-dice-display { font-size: 6.5em; color: gold; text-shadow: 0 0 8px white, 0 0 15px gold; margin-top: 10px; }
.role-reveal-arashi #role-result-modal-body { background: radial-gradient(ellipse at center, rgba(255, 100, 0, 0.4) 0%, rgba(80, 30, 0, 0) 70%), repeating-conic-gradient(from 15deg, rgba(255,180,100,0.2) 0deg 8deg, rgba(255,120,50,0.25) 8deg 16deg); border-radius: 10px; padding: 30px 50px; animation: roleRevealAppearGeneral 0.6s cubic-bezier(0.68, -0.6, 0.27, 1.55) forwards, arashiBgRotateFast 6s linear infinite; }
.role-reveal-arashi #role-result-name { font-family: 'RocknRoll One', sans-serif; font-size: 10em; color: #ffac6e; text-shadow: 0 0 12px #ff7043, 5px 5px 8px rgba(0, 0, 0, 0.8), -3px -3px 4px rgba(255,220,180,0.4); transform: skewX(-10deg); animation: arashiTextWobbleStrong 0.7s cubic-bezier(0.68, -0.6, 0.27, 1.55) forwards; }
.role-reveal-arashi #role-result-dice-display { font-size: 5em; color: #ffcc80; text-shadow: 0 0 6px #ff5722, 3px 3px 5px rgba(0,0,0,0.6); }
.role-reveal-shigoro #role-result-modal-body { background: linear-gradient(140deg, rgba(255,230,150,0.2) 0%, rgba(255,160,0,0.25) 50%, rgba(255,120,0,0.2) 100%); border-radius: 10px; padding: 30px 40px; border-bottom: 5px solid #ff9800; box-shadow: 0 8px 22px rgba(255, 152, 0, 0.5); }
.role-reveal-shigoro #role-result-name { font-family: 'Yuji Syuku', serif; font-size: 9em; color: #ffe082; text-shadow: 3px 3px 5px rgba(0,0,0,0.8), 0 0 8px #ff9800; animation: shigoroTextRevealDrop 0.9s ease-out forwards; }
.role-reveal-shigoro #role-result-dice-display { font-size: 4.5em; color: #ffe082; }
.role-reveal-normal-eye #role-result-modal-body { padding: 25px 40px; background-color: rgba(40, 40, 80, 0.8); border-radius: 10px; }
.role-reveal-normal-eye #role-result-name { font-family: 'M PLUS Rounded 1c', sans-serif; font-size: 7em; color: #eee; text-shadow: 3px 3px 6px rgba(0,0,0,0.7); }
.role-reveal-normal-eye #role-result-dice-display { font-size: 4.2em; color: #fff; }
.role-reveal-hifumi #role-result-modal-body { padding: 30px 40px; background-color: rgba(30, 40, 70, 0.8); border-radius: 10px; box-shadow: inset 0 0 15px rgba(0,0,0,0.5); }
.role-reveal-hifumi #role-result-name { font-family: 'Yuji Syuku', serif; font-size: 7.5em; color: #aec4d8; text-shadow: 1px 1px 5px rgba(0,0,0,0.8), 0 0 6px #6892c4; animation: hifumiTextShiverStrong 1s ease-in-out forwards; }
.role-reveal-hifumi #role-result-dice-display { font-size: 4.5em; opacity: 0.6; color: #b0c4de; }
.role-reveal-shonben #role-result-modal-body { padding: 25px 40px; background: linear-gradient(rgba(50,50,50,0.6), rgba(30,30,30,0.8)); border-radius: 10px; }
.role-reveal-shonben #role-result-name { font-family: 'M PLUS Rounded 1c', sans-serif; font-size: 6em; color: #777; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); filter: grayscale(90%) blur(1.5px); animation: shonbenTextCrumbleFast 1s ease-out forwards; }
.role-reveal-shonben #role-result-dice-display { display: none; }
.role-reveal-wave-clear #role-result-modal-body { padding: 40px 60px; position: relative; overflow: hidden; border-radius: 15px; box-shadow: 0 0 50px rgba(144, 238, 144, 0.8); animation: waveClearBodyPop 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
.role-reveal-wave-clear #role-result-modal-body::before { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(ellipse at center, rgba(255,255,255,0.3) 0%, rgba(144,238,144,0) 70%), url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADIAQMAAACXljzdAAAABlBMVEVVVP////8vZtJdAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAHUlEQVQ4y2NgoBpgImBqBNAyAMgwgM0IFJsKANqnHbcY5t6dAAAAAElFTkSuQmCC); background-size: cover, auto; animation: move-twink-back 20s linear infinite, fadeIn 1s ease-out; opacity: 0.6; z-index: -1; }
.role-reveal-wave-clear #role-result-name { font-family: 'Shippori Mincho', serif; font-size: 9em; background: linear-gradient(45deg, #adff2f, #00ff7f, #7fffd4, #00fa9a); -webkit-background-clip: text; background-clip: text; color: transparent; background-size: 300% 300%; animation: rainbowText 3s ease infinite; text-shadow: 0 0 10px white, 0 0 20px #90ee90, 4px 4px 8px rgba(0,0,0,0.6); filter: drop-shadow(0 0 10px #90ee90); margin-bottom: 10px; }
.role-reveal-game-over #role-result-modal-body { padding: 40px 50px; background: radial-gradient(ellipse at center, rgba(80, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0.8) 100%); border-radius: 10px; border: 3px solid #8B0000; box-shadow: inset 0 0 25px #000, 0 0 40px rgba(139, 0, 0, 0.9); animation: screenShake 0.5s ease-in-out forwards; }
.role-reveal-game-over #role-result-name { font-family: 'Yuji Syuku', serif; font-size: 8em; color: #a52a2a; text-shadow: 0 0 8px black, 0 0 15px #ff0000, 3px 3px 5px rgba(0,0,0,0.9); animation: gameOverFlicker 0.1s linear infinite; margin-bottom: 10px; }

/* ===== コイン獲得アニメーション ===== */
.coin-animation {
    position: fixed;
    width: 22px;
    height: 22px;
    background-color: gold;
    border-radius: 50%;
    border: 1px solid #b8860b;
    box-shadow: 1px 1px 4px rgba(0,0,0,0.6), 0 0 3px gold;
    z-index: 1100;
    pointer-events: none;
    opacity: 0;
    animation: coinFlySparkle 1s ease-in forwards;
}

/* ===== カード詳細モーダル ===== */
.card-detail-modal .modal-content {
    max-width: 550px;
    background: radial-gradient(ellipse at top center, rgba(50, 50, 70, 0.97) 0%, rgba(25, 25, 40, 0.98) 100%);
    border: 1px solid rgba(0, 255, 255, 0.3);
    border-radius: 15px;
    box-shadow: 0 10px 35px rgba(0, 0, 0, 0.7), 0 0 18px rgba(0, 255, 255, 0.2);
    padding: 25px 35px;
    max-height: 90vh;
    overflow-y: auto;
    /* スクロールバー統一 */
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 255, 255, 0.5) rgba(15, 20, 40, 0.8);
}
.card-detail-modal .modal-content::-webkit-scrollbar { width: 8px; }
.card-detail-modal .modal-content::-webkit-scrollbar-track { background: rgba(15, 20, 40, 0.8); border-radius: 4px;}
.card-detail-modal .modal-content::-webkit-scrollbar-thumb { background-color: rgba(0, 255, 255, 0.5); border-radius: 4px; border: 1px solid rgba(0, 255, 255, 0.7);}
.card-detail-modal .modal-content::-webkit-scrollbar-thumb:hover { background-color: rgba(0, 255, 255, 0.8); }

.card-detail-modal .close-button {
    top: 12px;
    right: 20px;
    font-size: 28px;
}
#card-detail-body {
    display: flex;
    gap: 25px;
}
#card-detail-image-container {
    width: 180px;
    height: 252px;
    flex-shrink: 0;
    background-color: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}
#card-detail-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: none; /* JSで制御 */
}
#card-detail-placeholder {
    color: #888;
    font-size: 0.9em;
    display: block; /* JSで制御 */
}
#card-detail-info {
    flex-grow: 1;
    text-align: left;
}
#card-detail-name {
    font-size: 1.6em;
    color: #ffeb3b;
    margin-top: 0;
    margin-bottom: 10px;
    font-weight: bold;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
    text-align: center;
    border-bottom: 1px solid rgba(0, 255, 255, 0.2);
    padding-bottom: 8px;
}
#card-detail-meta {
    font-size: 0.9em;
    color: #ccc;
    margin-bottom: 15px;
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px 15px;
    text-align: center;
    padding-bottom: 10px;
    border-bottom: 1px dashed rgba(0, 255, 255, 0.15);
}
#card-detail-meta .rarity-badge,
#card-detail-meta .type-badge {
    padding: 3px 10px;
    border-radius: 12px;
    font-weight: bold;
    text-shadow: 1px 1px 1px rgba(0,0,0,0.4);
    font-size: 0.95em;
}
/* レアリティ・タイプ色は共通スタイル利用 */
#card-detail-level {
    background-color: rgba(255, 255, 255, 0.1);
    color: #ffcc70;
    padding: 3px 10px;
    border-radius: 12px;
    font-weight: bold;
    font-size: 0.95em;
}
#card-detail-info h3 {
    color: #aaa;
    font-size: 0.9em;
    margin-top: 15px;
    margin-bottom: 5px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 3px;
}
#card-detail-description-container,
#card-detail-flavor-container,
#card-detail-uses-container {
    background-color: rgba(0, 0, 0, 0.2);
    padding: 10px 12px;
    border-radius: 5px;
    margin-bottom: 12px;
    border: 1px solid rgba(0, 255, 255, 0.1);
}
#card-detail-info p {
    font-size: 0.95em;
    color: #e0e0e0;
    line-height: 1.6;
    margin: 0;
    word-break: break-word;
    overflow-wrap: break-word;
}
#card-detail-flavor {
    font-style: italic;
    color: #bbb;
}
#card-detail-uses {
    font-weight: bold;
    color: #ffeb3b;
}

/* 設定カードリスト内の詳細ボタン配置 */
.card-list-item .card-detail-button {
    position: absolute;
    bottom: 10px;
    right: 15px;
    padding: 5px 12px;
    font-size: 0.8em;
    /* .button-subtle スタイルを継承 */
}

/* ===== レスポンシブデザイン ===== */

/* タブレットサイズ */
@media (max-width: 1100px) {
    #game-main-area { width: 100%; padding: 0; }
    #game-container { max-width: 95%; }
    .shop-outer-container { width: 96%; }
    .shop-header, #shop-scrollable-offers, .shop-footer { padding-left: 20px; padding-right: 20px; }
    .card, .pack, .boost-item { width: 190px; height: 270px; padding-bottom: 50px; }
    .dice-roll-modal-content { max-width: 70vw; width: 70vw; }
    #control-area { max-width: 85%; }
    .card-action-item { width: 190px; height: 270px; }
    #game-area { align-items: stretch; } /* PC版スタイル維持 */
}

/* モバイルサイズ (大きめ) */
@media (max-width: 768px) {
    .screen-content-box { padding: 25px 15px; width: 95%; }
    .game-title { font-size: 2.8em; }
    #game-header { padding: 5px 10px; }
    #game-scrollable-area { padding: 10px; padding-bottom: 10px; }
    #game-container { padding: 12px; }
    #wave-info { font-size: 0.9em; }
    /* ゲームエリア: グリッドレイアウト */
    #game-area {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        grid-template-rows: auto auto;
        grid-template-areas:
            "player dice npc"
            "player-img dice npc-img";
        gap: 6px 8px;
        align-items: stretch;
        width: 100%;
    }
    #player-info { grid-area: player; }
    .character-image-area.player { grid-area: player-img; align-self: start; }
    #dice-area { grid-area: dice; align-self: center; width: auto; padding: 12px; }
    .character-image-area.npc { grid-area: npc-img; align-self: start; }
    #npc-info { grid-area: npc; }
    .player-box { width: 100%; padding: 8px; font-size: 0.85em; }
    .character-image-area { width: 100%; height: 160px; }
    #dice-display { font-size: 3.5em; }
    /* コントロールバー */
    #bottom-control-bar { padding: 8px 8px 10px 8px; height: auto; flex-shrink: 0; }
    #control-area { flex-direction: column; gap: 6px; max-width: 95%; }
    .bet-main-controls { flex-direction: row; align-items: center; gap: 6px; padding: 5px; order: 1; justify-content: center; flex-wrap: wrap; }
    .bet-input-container { order: 0; width: auto; flex-direction: row; justify-content: center; align-items: center; min-width: unset; gap: 5px; }
    #bet-input { flex-grow: 0; width: 70px; padding: 6px; font-size: 1em; }
    .bet-adjust-container { order: 1; width: auto; gap: 4px; }
    .bet-action-container { order: 2; width: 100%; justify-content: space-around; margin-top: 5px; padding: 0; background: none; gap: 6px; }
    .bet-action-container button { flex-grow: 1; flex-basis: auto; max-width: none; font-size: 0.8em; padding: 7px 8px; }
    #action-controls { gap: 6px; flex-direction: row; align-items: center; order: 3; margin-top: 5px; }
    #action-controls button { width: auto; flex-grow: 1; padding: 8px 5px; font-size: 0.8em; }
    .bet-adjust-button { padding: 5px 8px; font-size: 0.85em; min-width: 38px; border-radius: 10px; /* 丸から変更 */ }
    /* ショップ */
    .shop-outer-container { width: 95%; max-height: 90vh; margin: 2vh auto; }
    .shop-title-container { margin-bottom: 10px; } .shop-title { font-size: 2em; padding: 6px 15px; }
    #close-shop-button, #reroll-button { font-size: 1em; padding: 8px 18px; }
    /* モーダル */
    .modal-content { width: 90%; padding: 20px; max-height: 85vh; display: flex; flex-direction: column; }
    #history-log { font-size: 0.9em; max-height: 60vh; flex-grow: 1; }
    /* カードアクションモーダル */
    .card-action-modal-content { max-width: 95vw; }
    .card-display-area { min-height: 280px; padding: 10px 10px; justify-content: flex-start; }
    .card-action-item { width: 180px; height: 260px; padding-bottom: 45px; }
    .card-action-item .card-name { font-size: 1em; }
    .card-action-item .card-item-footer button { font-size: 0.8em; padding: 5px 10px; }
}

/* モバイルサイズ (小さめ) */
@media (max-width: 480px) {
    #game-header { padding: 4px 8px; }
    #game-coin-display { font-size: 0.9em; }
    #settings-button { width: 28px; height: 28px; font-size: 1em; }
    #game-scrollable-area { padding: 5px; padding-bottom: 5px; }
    #game-container { padding: 8px; max-width: 95%; }
    #wave-info { font-size: 0.8em; margin-bottom: 3px; }
    #current-bet-info { font-size: 0.9em; margin-bottom: 8px; padding: 4px 8px; }
    /* ゲームエリア: 縦積みに戻す */
    #game-area { display: flex; flex-direction: column; gap: 8px; align-items: center; }
    .player-section, .npc-section { /* 追加: Player/NPCをまとめる */
        display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 6px; width: 100%;
    }
    #player-info, #npc-info { flex: 1 1 auto; padding: 6px; font-size: 0.75em; order: 1; }
    #player-info h2, #npc-info h2 { font-size: 0.85em; }
    #player-info p, #npc-info p { font-size: 0.85em; margin: 4px 0; }
    #player-dice, #npc-dice { font-size: 0.9em; }
    .character-image-area { flex: 0 0 70px; height: 95px; order: 0; max-width: 70px; align-self: center; }
    #dice-area { width: 100%; padding: 10px; order: 1; margin-top: 6px; margin-bottom: 6px; }
    .player-section { order: 0; } .npc-section { order: 2; } /* 表示順 */
    #dice-display { font-size: 2.5em; }
    .parent-marker { font-size: 0.6em; }
    /* コントロールバー */
    #bottom-control-bar { padding: 6px 6px 8px 6px; }
    #control-area { gap: 5px; max-width: 100%; }
    .bet-main-controls { gap: 4px; padding: 4px; flex-wrap: wrap; }
    .bet-input-container { gap: 4px; }
    #bet-input { width: 60px; padding: 5px; font-size: 0.9em; }
    #min-bet-display { font-size: 0.7em; }
    .bet-adjust-button { padding: 4px 6px; font-size: 0.75em; min-width: 30px; border-radius: 10px; }
    .bet-action-container { gap: 5px; margin-top: 4px; }
    .bet-action-container button { padding: 5px 8px; font-size: 0.75em; }
    #action-controls { gap: 5px; margin-top: 4px; }
    #action-controls button { padding: 6px 5px; font-size: 0.75em; }
    button { padding: 7px 12px; font-size: 0.85em; } /* 全体ボタン調整 */
    #start-game-button { padding: 8px 20px; font-size: 1em; }
    #select-character-button { padding: 7px 15px; font-size: 0.85em; }
    /* ショップ */
    .shop-outer-container { width: 98%; max-height: 95vh; }
    .shop-header, #shop-scrollable-offers, .shop-footer { padding: 8px; }
    .shop-title { font-size: 1.8em; padding: 5px 12px; }
    #coin-display { font-size: 1.2em; } #coin-display #player-coins { font-size: 1.2em; }
    #shop-player-score { font-size: 1em; } #shop-player-hand { font-size: 0.8em; }
    .card, .pack, .boost-item { width: 130px; height: 190px; padding-bottom: 30px; }
    .card-footer { bottom: 5px; left: 5px; right: 5px; gap: 5px; }
    .card-name { font-size: 0.85em; }
    .card-cost { font-size: 0.8em; padding: 3px 6px; }
    .buy-button, .upgrade-button { font-size: 0.7em; padding: 3px 8px; } /* 統合 */
    .card-detail-button { font-size: 0.7em; padding: 3px 8px; }
    #close-shop-button, #reroll-button { font-size: 0.85em; padding: 6px 15px; }
    /* モーダル */
    .modal-content { padding: 15px; }
    .dice-roll-modal-content { max-width: 95vw; width: 95vw; }
    /* カードアクションモーダル */
    .card-display-area { min-height: 260px; padding: 8px 8px; gap: 10px; }
    .card-action-item { width: 150px; height: 240px; padding: 10px; padding-bottom: 40px; }
    .card-action-item .card-name { font-size: 0.9em; margin-top: 20px; }
    .card-action-item .card-item-footer button { font-size: 0.75em; padding: 4px 8px; }
}

/* ===== その他の微調整 ===== */
.mobile-break { display: none; } /* デフォルト非表示 */
@media (max-width: 550px) { /* スマホ縦持ち想定 */
    .mobile-break { display: block; } /* 役一覧用 */
    .card-effect-rate { line-height: 1.6; } /* 折り返し時の行間調整 */
}

/* --- END OF style.css --- */
