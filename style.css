/* フォント読み込み */
@import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@500;800&family=Yuji+Syuku&family=Shippori+Mincho:wght@800&family=RocknRoll+One&display=swap');

body {
    font-family: 'M PLUS Rounded 1c', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #4158D0, #C850C0, #FFCC70);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    color: #f0f0f0; /* ← 色を元に戻す */
    margin: 0;
    min-height: 100vh;
    display: flex; /* body を flex コンテナに */
    flex-direction: column; /* 子要素を縦に並べる */
    position: relative;
}
@keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

/* ===== 画面共通 ===== */
.screen {
    display: none; /* ★ 初期状態は非表示 */
    width: 100%;
    min-height: 100vh;
    box-sizing: border-box;
    position: relative;
    overflow: hidden;
    flex-grow: 1; /* 画面の高さいっぱいに広がるように */
}
.screen.active {
    display: flex; /* ★ アクティブ時に flex を有効化 (CSSが担当) */
    /* flex-direction は各画面で指定 or デフォルト(row) */
    animation: fadeIn 0.5s ease-out;
}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* キラキラ背景 */
.stars, .twinkling { position:fixed; top:0; left:0; right:0; bottom:0; width:100%; height:100%; display:block; z-index: 0; }
.stars { background:#000 url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkAQMAAABKLAcXAAAABlBMVEVVVP////8vZtJdAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAFUlEQVQ4y2NgoBpgImBqBNAyAMgwAAD70w43s4RL4wAAAABJRU5ErkJggg==) repeat top center; background-size: auto; opacity: 0.5; }
.twinkling{ background:transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADIAQMAAACXljzdAAAABlBMVEVVVP////8vZtJdAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAHUlEQVQ4y2NgoBpgImBqBNAyAMgwgM0IFJsKANqnHbcY5t6dAAAAAElFTkSuQmCC) repeat top center; background-size: auto; animation: move-twink-back 200s linear infinite; opacity: 0.3; }
@keyframes move-twink-back { from {background-position:0 0;} to {background-position:-10000px 5000px;} }


/* ===== タイトル & リザルト画面 & キャラクター選択画面 ===== */
#title-screen, #result-screen, #character-select-screen {
    flex-direction: column; /* ★ 画面全体を縦積みレイアウトに */
    justify-content: center; /* flex有効時に垂直中央 */
    align-items: center; /* flex有効時に水平中央 */
    text-align: center;
    z-index: 1;
    /* .screen.active の display: flex; が適用される */
}
.title-content, .result-content, .character-select-content {
    background-color: rgba(30, 30, 50, 0.85);
    padding: 40px 60px;
    border-radius: 20px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
    z-index: 2;
    width: 90%; /* 幅を調整 */
    max-width: 800px; /* 最大幅を設定 */
    box-sizing: border-box;
    /* ↓ .character-select-content 用に追加 */
    display: flex;
    flex-direction: column;
    align-items: center;
}
.game-title { background: linear-gradient(45deg, #ffeb3b, #ffcc70); -webkit-background-clip: text; background-clip: text; color: transparent; font-size: 4.2em; font-weight: 800; margin-bottom: 35px; text-shadow: 3px 3px 10px rgba(0,0,0,0.8); animation: pulse 2s infinite ease-in-out; font-family: 'Yuji Syuku', serif; }
@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }

/* ===== ↓ モード選択スタイルを追加 ===== */
.mode-selector { margin-bottom: 30px; }
.mode-selector p { margin-bottom: 15px; font-size: 1.2em; color: #ddd; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
.mode-button { padding: 10px 22px; font-size: 1.1em; margin: 0 8px; cursor: pointer; border: none; border-radius: 20px; background-color: rgba(255, 255, 255, 0.1); color: #eee; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
.mode-button:hover { background-color: rgba(255, 255, 255, 0.2); transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.4); }
.mode-button.selected { background: linear-gradient(45deg, #ffeb3b, #ffc107); color: #333; font-weight: bold; box-shadow: 0 4px 10px rgba(255, 200, 0, 0.5); }
.mode-button[data-mode="pvp"]:not(.selected) { /* 未実装ボタンのスタイル */
    background-color: rgba(150, 150, 150, 0.2);
    color: #aaa;
    cursor: not-allowed;
}
.mode-button[data-mode="pvp"]:hover:not(.selected) {
    transform: none;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}
/* ===== ↑ モード選択スタイルを追加 ===== */

/* ↓ 難易度選択のスタイルは削除 または コメントアウト
.difficulty-selector { margin-bottom: 30px; }
.difficulty-selector p { margin-bottom: 15px; font-size: 1.2em; color: #ddd; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
.difficulty-button { padding: 10px 22px; font-size: 1.1em; margin: 0 8px; cursor: pointer; border: none; border-radius: 20px; background-color: rgba(255, 255, 255, 0.1); color: #eee; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
.difficulty-button:hover { background-color: rgba(255, 255, 255, 0.2); transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.4); }
.difficulty-button.selected { background: linear-gradient(45deg, #ffeb3b, #ffc107); color: #333; font-weight: bold; box-shadow: 0 4px 10px rgba(255, 200, 0, 0.5); }
*/

#start-game-button, #select-character-button /* キャラ選択ボタンも同様のスタイルを一部適用 */ { padding: 14px 35px; font-size: 1.4em; cursor: pointer; border: none; border-radius: 25px; color: white; font-weight: bold; transition: all 0.3s ease; text-shadow: 1px 1px 3px rgba(0,0,0,0.4); }
#start-game-button { background: linear-gradient(45deg, #C850C0, #ffcc70); box-shadow: 0 5px 15px rgba(200, 80, 192, 0.4); }
#start-game-button:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(200, 80, 192, 0.6); }
/* キャラクター選択ボタンのスタイル */
#select-character-button {
    padding: 10px 25px; /* 少し小さく */
    font-size: 1.1em; /* 少し小さく */
    background: linear-gradient(180deg, #8a94a8, #6c757d); /* サブボタンの色 */
    box-shadow: 0 3px 7px rgba(108, 117, 125, 0.4);
    margin-top: 15px; /* 開始ボタンとの間隔 */
}
#select-character-button:hover:not(:disabled) {
    background: linear-gradient(180deg, #9fa8b8, #7c858d);
    transform: translateY(-2px);
    box-shadow: 0 5px 10px rgba(108, 117, 125, 0.5);
}
.button-pop { transition: transform 0.1s ease, box-shadow 0.2s ease; } .button-pop:active:not(:disabled) { transform: scale(0.95); }

/* ===== ゲーム画面 ===== */
#game-screen {
    /* display は .screen.active に任せる */
    flex-direction: column; /* ★ ゲーム画面は縦積み */
    justify-content: flex-start; /* 上から配置 */
    align-items: center; /* 中央寄せ */
    padding: 0; /* 全体のパディングは解除 */
    background-color: rgba(0, 0, 0, 0.2);
    z-index: 1;
    overflow: hidden; /* スクロールは内部で制御 */
}
/* ゲーム画面暗転用クラス */
#game-screen.dimmed > *:not(#dice-roll-modal) {
    filter: blur(3px) brightness(0.6);
    pointer-events: none;
    transition: filter 0.3s ease-out;
}

/* --- 上部固定ヘッダー --- */
#game-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background-color: rgba(30, 30, 50, 0.9); /* ヘッダー背景色 */
    padding: 8px 15px; /* ヘッダー内余白 */
    display: flex;
    justify-content: space-between; /* 左右端に配置 */
    align-items: center; /* 垂直中央揃え */
    box-sizing: border-box;
    z-index: 200; /* 下部バーより手前、モーダルより奥 */
    border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* 下線 */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); /* 影 */
}

/* メインエリア構造 */
#game-main-area {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    width: 100%; /* 横幅いっぱい */
    overflow: hidden; /* このレベルで overflow hidden */
    padding-top: 50px; /* ヘッダー分の高さを確保 (ヘッダーの高さに応じて調整) */
    box-sizing: border-box;
}

/* スクロール可能エリア */
#game-scrollable-area {
    overflow-y: auto; /* ここでスクロールを許可 */
    flex-grow: 1;
    padding: 15px; /* 上左右のパディング */
    padding-bottom: 150px; /* 下部固定バーの高さ分を確保 (CSS変数推奨) */
    box-sizing: border-box;
    width: 100%;
    display: flex;
    flex-direction: column; /* コンテナを縦に並べる */
}

/* ゲームコンテナ */
#game-container {
    background-color: rgba(45, 45, 70, 0.8);
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
    text-align: center;
    width: 100%;
    max-width: 80%; /* 横幅調整 (左右10%余白) */
    margin: 0 auto; /* 水平中央揃え */
    display: flex;
    flex-direction: column;
    border: 1px solid rgba(255, 255, 255, 0.1);
    position: relative; /* 子要素の絶対配置基準 */
    flex-grow: 1; /* 縦に伸ばす */
}

/* 所持コイン表示 (ヘッダー内) */
#game-coin-info {
    position: static; /* ヘッダー内の配置に従う */
    background: none; /* 背景削除 */
    border: none; /* 枠線削除 */
    box-shadow: none; /* 影削除 */
    padding: 0; /* パディング削除 */
    text-align: left; /* 左寄せ */
    z-index: auto;
}
#game-coin-info h3 { display: none; /* h3は非表示 */ }
#game-coin-display {
    font-size: 1.2em;
    font-weight: bold;
    color: gold; /* ゴールド色 */
    text-shadow: 0 0 5px orange, 0 0 8px gold, 1px 1px 2px rgba(0,0,0,0.7);
    animation: coinShine 2.5s infinite linear;
    margin: 0; /* 不要なマージン削除 */
}
@keyframes coinShine {
    0%, 100% { opacity: 0.8; text-shadow: 0 0 5px orange, 0 0 8px gold, 1px 1px 2px rgba(0,0,0,0.7); }
    50% { opacity: 1; text-shadow: 0 0 8px orange, 0 0 15px gold, 1px 1px 2px rgba(0,0,0,0.7); }
}

/* 設定ボタンコンテナ (ヘッダー内) */
#settings-button-container {
    position: static; /* ヘッダー内の配置に従う */
}
/* 設定ボタン スタイル調整 */
#settings-button {
    padding: 5px 10px;
    font-size: 1.5em; /* アイコンサイズ調整 */
    line-height: 1; /* ボタン高さ調整 */
    background: rgba(255, 255, 255, 0.1);
    color: #eee;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%; /* 丸くする */
    width: 40px; /* 固定幅 */
    height: 40px; /* 固定高さ */
    display: flex;
    justify-content: center;
    align-items: center;
}
#settings-button:hover:not(:disabled) {
    background: rgba(255, 255, 255, 0.2);
    color: #fff;
    transform: translateY(-1px); /* ホバーエフェクト少し追加 */
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

/* WAVE情報 コンテナ（マージン調整） */
#game-container > div:nth-child(1) { /* HTML構造に依存するが、WAVE情報コンテナを指す想定 */
     margin-bottom: 5px;
}
/* WAVE情報 テキスト（マージン調整） */
#wave-info {
    font-size: 1.1em;
    color: #ccc;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    text-align: center; /* 中央寄せ */
    margin-top: 0; /* ヘッダーができたので上マージン不要 */
    margin-bottom: 10px; /* 下の current-bet-info との間隔 */
}

/* WAVE/ROUND 色指定用クラス */
.wave-highlight { color: #ffcc70; font-weight: bold; } /* WAVE: と数字 */
.round-normal { color: #ccc; font-weight: normal; } /* ROUND: と数字 */
/* 難易度表示は削除
#difficulty-display { font-weight: bold; color: #ffcc70; }
*/
#consecutive-wins-display { font-weight: bold; margin-left: 10px; font-size: 0.9em; }
#consecutive-wins-display:not(.npc-losing-streak) { color: #ffeb3b; animation: pulseYellow 1.5s infinite ease-in-out; }
/* NPC連敗表示用スタイル */
#consecutive-wins-display.npc-losing-streak { color: #add8e6; animation: pulseBlue 1.8s infinite ease-in-out; font-style: italic; }
@keyframes pulseYellow { 0%, 100% { opacity: 1; text-shadow: 0 0 5px #ffeb3b; } 50% { opacity: 0.7; text-shadow: none; } }
@keyframes pulseBlue { 0%, 100% { opacity: 1; text-shadow: 0 0 5px #6495ED; } 50% { opacity: 0.6; text-shadow: none; } }

#current-bet-info { background-color: rgba(0, 0, 0, 0.3); padding: 5px 10px; border-radius: 5px; font-size: 1.1em; text-shadow: 1px 1px 2px rgba(0,0,0,0.6); border: 1px solid rgba(255, 235, 59, 0.3); box-shadow: inset 0 0 5px rgba(0,0,0,0.2); min-height: 1.5em; margin-bottom: 15px; font-weight: bold; color: #ffeb3b; }
#current-bet-info .parent-name { font-weight: normal; color: #eee; }

/* #game-area の gap を変更済み */
#game-area { display: flex; justify-content: space-between; align-items: stretch; margin-bottom: 25px; gap: 15px; flex-grow: 1; /* 縦に伸ばす */ }

/* .player-box の width を変更済み */
.player-box { background-color: rgba(60, 60, 90, 0.85); padding: 18px; border-radius: 10px; width: 250px; box-sizing: border-box; display: flex; flex-direction: column; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: inset 0 0 10px rgba(0,0,0,0.3); position: relative; }
.player-box h2 { margin-top: 0; margin-bottom: 12px; color: #eee; font-size: 1.3em; border-bottom: 1px solid rgba(255, 255, 255, 0.2); padding-bottom: 8px; font-weight: 500; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
.parent-marker { color: #ffeb3b; font-size: 0.8em; margin-left: 5px; vertical-align: middle; font-weight: bold; display: none; text-shadow: 0 0 3px #ffc107; }

.player-box p { margin: 10px 0; font-size: 1em; color: #ddd; } .player-box span { font-weight: bold; }
.score-container { position: relative; } .score { color: #ffeb3b; font-size: 1.1em; }
#player-dice, #npc-dice { font-family: monospace; font-size: 1.2em; color: #fff; }
.hand-display { color: #ffcc70; font-weight: 800; display: inline-block; transition: transform 0.3s ease, color 0.3s ease; text-shadow: 1px 1px 4px rgba(0,0,0,0.6); }
.hand-display.highlight { animation: handHighlight 0.8s ease-out forwards; }
.hand-display.highlight.hifumi { animation: handHighlightHifumi 1s ease-in-out forwards; }
.hand-display.highlight.strong { animation: handHighlightStrong 1.2s ease-out forwards; }
.hand-display.highlight.legendary { animation: handHighlightLegendary 1.5s ease-out forwards; }
@keyframes handHighlight { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.3); color: #ffeb3b; } 100% { transform: scale(1); } }
@keyframes handHighlightHifumi { 0% { transform: scale(1) rotate(0deg); color: #ffcc70; filter: grayscale(0) brightness(1); } 30% { transform: scale(0.9) rotate(3deg); color: #add8e6; filter: grayscale(0.6) brightness(0.9); } 70% { transform: scale(0.95) rotate(-3deg); } 100% { transform: scale(1) rotate(0deg); color: #ffcc70; filter: grayscale(0) brightness(1); } }
@keyframes handHighlightStrong { 0% { transform: scale(1) rotate(0deg); text-shadow: 1px 1px 4px rgba(0,0,0,0.6); filter: brightness(1); } 25% { transform: scale(1.5) rotate(-5deg); color: #ffeb3b; text-shadow: 0 0 12px #ffc107; filter: brightness(1.2); } 50% { filter: brightness(1.4); transform: scale(1.45); } 75% { transform: scale(1.4) rotate(5deg); filter: brightness(1.3); } 100% { transform: scale(1) rotate(0deg); text-shadow: 1px 1px 4px rgba(0,0,0,0.6); filter: brightness(1); } }
@keyframes handHighlightLegendary { 0% { transform: scale(1); filter: brightness(1) drop-shadow(0 0 0px gold); } 15% { transform: scale(1.8) rotate(-7deg); filter: brightness(2.5) drop-shadow(0 0 20px gold); color: gold; } 30% { transform: scale(1.7) rotate(7deg); filter: brightness(1.8) drop-shadow(0 0 30px gold); } 45% { transform: scale(1.75) rotate(-5deg); filter: brightness(2.2) drop-shadow(0 0 25px gold); } 60% { transform: scale(1.7) rotate(5deg); filter: brightness(2.0) drop-shadow(0 0 22px gold); } 100% { transform: scale(1); filter: brightness(1) drop-shadow(0 0 0px gold); } }

#dice-area { flex-grow: 1; text-align: center; padding: 25px; background-color: rgba(70, 70, 100, 0.85); border-radius: 12px; display: flex; flex-direction: column; justify-content: center; align-items: center; border: 3px solid rgba(255, 255, 255, 0.2); overflow: visible; box-shadow: inset 0 0 15px rgba(0,0,0,0.4); position: relative; width: auto; /* 幅自動調整 */ max-width: 380px; /* 最大幅調整 */ margin: 0 auto; }
#dice-display { font-size: 5em; font-weight: 800; margin: 15px 0; color: #ffffff; min-height: 1.2em; letter-spacing: 0.15em; font-family: 'M PLUS Rounded 1c', sans-serif; text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.6); white-space: nowrap; transition: transform 0.1s ease-out, display 0s; display: block; }
#dice-display .dice-num { display: inline-block; margin: 0 0.05em; }
#dice-display.rolling .dice-num { color: #bbb; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4); }
#dice-display.settled .dice-num { animation: diceSettle 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
@keyframes diceSettle { 0% { transform: scale(1.1) rotate(-2deg); } 60% { transform: scale(0.97) rotate(2deg); } 100% { transform: scale(1); } }
.roll-counter-top-right { position: absolute; top: 10px; right: 15px; font-size: 0.9em; color: rgba(255, 255, 255, 0.6); background-color: rgba(0, 0, 0, 0.3); padding: 2px 6px; border-radius: 4px; z-index: 5; }

/* キャラクター画像エリアのスタイルを更新 */
.character-image-area {
    width: 250px; /* プレイヤーボックスと同じ幅 */
    height: 300px; /* 高さを設定 */
    background-color: rgba(80, 80, 110, 0.7); /* 仮の背景色 */
    border: 1px dashed rgba(255, 255, 255, 0.3); /* 仮の枠線 */
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #aaa;
    font-size: 0.9em;
    text-align: center;
    align-self: center; /* 中央に寄せる */
    flex-shrink: 0; /* 縮まないように */
}
.character-image-area img { /* 画像が入った時のスタイル */
    max-width: 100%;
    max-height: 100%;
    object-fit: contain; /* アスペクト比を保つ */
    border-radius: 4px;
    display: block; /* ★ none ではなく block に */
}


/* メッセージエリアのスタイル変更 */
#message-area { background-color: rgba(30, 30, 50, 0.75); padding: 12px; margin-bottom: 0; /* 下マージン削除 */ border-radius: 8px; min-height: 3em; display: flex; flex-direction: column; justify-content: center; align-items: center; border: 1px solid rgba(255, 255, 255, 0.1); text-align: center; }
#message { margin: 0; font-style: italic; color: #a0ffa0; font-size: 1.1em; font-weight: 500; text-shadow: 1px 1px 2px rgba(0,0,0,0.6); margin-bottom: 8px; }
#message-button-container { display: flex; gap: 10px; margin-top: 8px; }

/* 下部コントロールバーのための余白 */
#bottom-spacer {
    height: 150px; /* 下部バーの高さに合わせる */
    flex-shrink: 0; /* 縮まないように */
}

/* 下部固定操作エリア */
#bottom-control-bar {
    position: fixed; /* 画面下部に固定 */
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: rgba(30, 30, 50, 0.95);
    padding: 10px 15px 15px 15px; /* パディング調整 */
    border-top: 1px solid rgba(255, 255, 255, 0.15);
    box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.4);
    z-index: 100; /* 他の要素より手前に */
    box-sizing: border-box;
}

/* 中央アナウンス (勝敗演出含む) */
.center-role { position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%); font-size: 6em; font-weight: 800; color: white; text-shadow: 3px 3px 0 #444, 6px 6px 10px rgba(0, 0, 0, 0.7); opacity: 0; pointer-events: none; z-index: 20; white-space: nowrap; padding: 0.1em 0.5em; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); width: auto; max-width: 90%; text-align: center; background-color: transparent; }
.center-role.role-appear { animation: centerRoleAppear 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards, centerRoleFadeOut 0.5s ease-out forwards var(--center-role-duration, 2s); }
@keyframes centerRoleAppear { 0% { transform: translate(-50%, -50%) scale(0.5) rotate(-5deg); opacity: 0; } 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; } }
@keyframes centerRoleFadeOut { 0% { opacity: 1; } 100% { opacity: 0; } }
.center-role.role-pinzoro { font-family: 'Shippori Mincho', serif; font-size: 8em; color: gold; text-shadow: 0 0 10px white, 0 0 20px gold, 3px 3px 5px rgba(0,0,0,0.6); filter: drop-shadow(0 0 10px gold); animation-name: centerRolePinzoro, centerRoleFadeOut; animation-duration: 0.6s, 0.5s; animation-timing-function: cubic-bezier(0.68, -0.6, 0.27, 1.55), ease-out; animation-fill-mode: forwards, forwards; animation-delay: 0s, 2.5s; padding: 0.2em 0.6em; }
@keyframes centerRolePinzoro { 0% { transform: translate(-50%, -50%) scale(3) rotateY(180deg); opacity: 0; } 100% { transform: translate(-50%, -50%) scale(1) rotateY(0deg); opacity: 1; } }
.center-role.role-arashi { font-family: 'RocknRoll One', sans-serif; font-size: 7.5em; color: #ffcc80; text-shadow: 0 0 8px #ff5722, 3px 3px 6px rgba(0, 0, 0, 0.7); animation-name: centerRoleArashi, centerRoleFadeOut; animation-duration: 0.5s, 0.5s; animation-timing-function: cubic-bezier(0.68, -0.6, 0.27, 1.55), ease-out; animation-fill-mode: forwards, forwards; animation-delay: 0s, 2.2s; padding: 0.15em 0.5em; background-color: rgba(80, 20, 0, 0.8); }
@keyframes centerRoleArashi { 0% { transform: translate(-50%, -50%) scale(0) rotate(720deg); opacity: 0; filter: blur(8px); } 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; filter: blur(0px); } }
.center-role.role-shigoro { font-family: 'Yuji Syuku', serif; font-size: 7em; color: #ffe082; text-shadow: 2px 2px 4px rgba(0,0,0,0.8), 0 0 5px #ff9800; --center-role-duration: 2s; padding: 0.1em 0.4em; background-color: rgba(80, 50, 0, 0.8); }
.center-role.role-normal-eye { font-family: 'M PLUS Rounded 1c', sans-serif; font-size: 6em; color: #eee; text-shadow: 2px 2px 5px rgba(0,0,0,0.5); --center-role-duration: 1.5s; background-color: rgba(40, 40, 80, 0.7); }
.center-role.role-hifumi { font-family: 'Yuji Syuku', serif; font-size: 6.5em; color: #cdeaff; text-shadow: 1px 1px 4px rgba(0,0,0,0.7), 0 0 5px #5882b4; animation-name: centerRoleHifumi, centerRoleFadeOut; animation-duration: 0.8s, 0.5s; animation-timing-function: cubic-bezier(0.34, 1.56, 0.64, 1), ease-out; animation-fill-mode: forwards, forwards; animation-delay: 0s, 1.8s; background-color: rgba(30, 40, 70, 0.8); }
@keyframes centerRoleHifumi { 0% { transform: translate(-50%, -50%) translateY(30px) rotate(-15deg); opacity: 0; } 100% { transform: translate(-50%, -50%) translateY(0) rotate(0deg); opacity: 1; } }
.center-role.role-shonben { font-family: 'M PLUS Rounded 1c', sans-serif; font-size: 4.8em; color: #bbb; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); --center-role-duration: 1.5s; /* 背景削除 */ }
/* 勝敗演出 */
.center-role.result-win { font-family: 'RocknRoll One', sans-serif; font-size: 7em; color: #ffeb3b; text-shadow: 0 0 8px white, 0 0 15px #ffc107, 3px 3px 6px rgba(0,0,0,0.6); animation-name: resultWinAppear, centerRoleFadeOut; animation-duration: 0.7s, 0.5s; animation-timing-function: cubic-bezier(0.34, 1.56, 0.64, 1), ease-out; animation-fill-mode: forwards, forwards; animation-delay: 0s, var(--center-role-duration, 1.8s); padding: 0.2em 0.6em; }
@keyframes resultWinAppear { 0% { transform: translate(-50%, -50%) scale(0.2) rotate(-30deg); opacity: 0; filter: blur(5px); } 100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; filter: blur(0px); } }
.center-role.result-lose { font-family: 'Yuji Syuku', serif; font-size: 6.5em; color: #add8e6; text-shadow: 0 0 6px #4682B4, 2px 2px 4px rgba(0,0,0,0.7); animation-name: resultLoseAppear, centerRoleFadeOut; animation-duration: 0.9s, 0.5s; animation-timing-function: ease-out, ease-out; animation-fill-mode: forwards, forwards; animation-delay: 0s, var(--center-role-duration, 1.8s); padding: 0.15em 0.5em; }
@keyframes resultLoseAppear { 0% { transform: translate(-50%, -80%) scale(1.1); opacity: 0; } 50% { transform: translate(-50%, -45%); opacity: 0.8; } 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
/* WAVEクリア/ゲームオーバー */
.center-role.result-wave-clear { font-family: 'Shippori Mincho', serif; font-size: 8em; color: #90ee90; background: linear-gradient(45deg, #90ee90, #32cd32); -webkit-background-clip: text; background-clip: text; color: transparent; text-shadow: 0 0 15px white, 0 0 25px #90ee90, 4px 4px 8px rgba(0,0,0,0.6); filter: drop-shadow(0 0 15px #90ee90); animation-name: waveClearAppear, centerRoleFadeOut; animation-duration: 1.2s, 0.5s; animation-timing-function: cubic-bezier(0.175, 0.885, 0.32, 1.275), ease-out; animation-fill-mode: forwards, forwards; animation-delay: 0s, var(--center-role-duration, 2.5s); padding: 0.3em 0.7em; /* 背景削除 */ }
@keyframes waveClearAppear { 0% { transform: translate(-50%, -50%) scale(0.5) rotateY(-180deg); opacity: 0; } 100% { transform: translate(-50%, -50%) scale(1) rotateY(0deg); opacity: 1; } }
.center-role.result-game-over { font-family: 'Yuji Syuku', serif; font-size: 7.5em; color: #ff7b7b; text-shadow: 0 0 10px #dc143c, 3px 3px 6px rgba(0,0,0,0.8); animation-name: gameOverAppear, centerRoleFadeOut; animation-duration: 1.5s, 0.5s; animation-timing-function: ease-in-out, ease-out; animation-fill-mode: forwards, forwards; animation-delay: 0s, var(--center-role-duration, 2.5s); padding: 0.2em 0.6em; /* 背景削除 */ }
@keyframes gameOverAppear { 0% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; filter: grayscale(100%); } 50% { transform: translate(-50%, -50%) scale(0.9); opacity: 1; filter: grayscale(50%); } 100% { transform: translate(-50%, -50%) scale(1); opacity: 1; filter: grayscale(0); } }

/* --- 下部コントロールバー内のスタイル修正 --- */
#control-area {
    display: flex;
    flex-direction: column; /* 要素を縦に積む */
    align-items: stretch; /* 横幅いっぱい */
    gap: 10px; /* 各要素間のギャップ */
    margin-top: 0;
    max-width: 60%; /* 最大幅を画面の60%に */
    margin: 0 auto; /* 左右マージン自動で中央寄せ */
}

/* 一段目: 調整ボタン + 入力 */
.bet-main-controls {
    display: flex;
    align-items: center; /* 垂直中央揃え */
    justify-content: center; /* 中央寄せ */
    gap: 10px; /* 要素間のギャップ */
    width: 100%;
    background-color: rgba(0,0,0,0.25); /* 背景色を一段目に適用 */
    padding: 10px;
    border-radius: 10px;
    box-sizing: border-box; /* パディングを幅に含める */
    transition: opacity 0.3s ease; /* NPCターン用 */
}

/* 調整ボタンコンテナ */
.bet-adjust-container {
    display: flex;
    gap: 5px;
}

/* 入力欄コンテナ */
.bet-input-container {
    display: flex;
    flex-direction: column; /* ラベルと入力を縦に */
    align-items: center; /* 中央揃え */
    gap: 2px; /* ラベルと入力のギャップ */
    min-width: 120px; /* 最小幅確保 */
}
.bet-input-container label {
    font-size: 0.9em;
    color: #ccc;
    white-space: nowrap;
}
#bet-input {
    padding: 10px;
    font-size: 1.2em;
    width: 100%; /* コンテナ幅に合わせる */
    max-width: 100px; /* 最大幅設定 */
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    background-color: rgba(255, 255, 255, 0.1);
    color: #fff;
    text-align: center;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
    box-sizing: border-box; /* パディングとボーダーを幅に含める */
}
#min-bet-display {
    margin-left: 0;
    color: #ffcc70;
    font-size: 0.85em;
    font-weight: bold;
    align-self: center;
    white-space: nowrap;
    margin-top: 3px; /* 入力欄との間隔 */
}

/* 二段目: MIN/決定/MAXボタンコンテナ */
.bet-action-container {
    display: flex;
    gap: 10px; /* ボタン間の隙間 */
    align-items: stretch; /* ボタンの高さを揃える */
    justify-content: center; /* 中央配置 */
    background-color: rgba(0,0,0,0.25);
    padding: 8px;
    border-radius: 10px;
    transition: opacity 0.3s ease, display 0.3s ease;
}
/* 二段目のボタン共通スタイル */
.bet-action-container button {
    flex-grow: 1; /* 幅を均等にする */
    padding: 10px 15px;
    /* flex-basis, max-width は削除 */
}

/* アクションボタン (サイコロ/履歴) コンテナ */
#action-controls {
    display: flex;
    justify-content: center;
    gap: 10px;
    align-items: stretch;
}
#action-controls button {
    flex-grow: 1; /* ボタン幅を均等に */
}

/* 調整ボタン 個別スタイル */
.bet-adjust-button { padding: 8px 14px; font-size: 1.1em; min-width: 55px; border-radius: 18px; color: white; font-weight: bold; transition: transform 0.1s ease, box-shadow 0.2s ease, background 0.2s ease; box-shadow: 0 3px 6px rgba(0,0,0,0.3); }
.bet-adjust-button.plus { background: linear-gradient(180deg, #5cb85c, #4cae4c); }
.bet-adjust-button.plus:hover:not(:disabled) { background: linear-gradient(180deg, #6cd96c, #5bc85b); }
.bet-adjust-button.minus { background: linear-gradient(180deg, #d9534f, #c9302c); }
.bet-adjust-button.minus:hover:not(:disabled) { background: linear-gradient(180deg, #e06b67, #d6403b); }

/* MIN/決定/MAX ボタン個別スタイル */
#min-bet-button {
    background: linear-gradient(180deg, #8a94a8, #6c757d);
    color: white;
    text-shadow: 0px -1px 1px rgba(0,0,0,0.4);
}
#min-bet-button:hover:not(:disabled) {
    background: linear-gradient(180deg, #9fa8b8, #7c858d);
    transform: translateY(-2px);
    box-shadow: 0 5px 10px rgba(108, 117, 125, 0.4);
}
#set-bet-button { background: linear-gradient(180deg, #ffeb3b, #ffc107); color: #333; font-weight: bold; }
#set-bet-button:hover:not(:disabled) { background: linear-gradient(180deg, #fff06b, #ffd24d); transform: translateY(-2px); box-shadow: 0 5px 10px rgba(255, 200, 0, 0.4); }
#max-bet-button { background: linear-gradient(180deg, #f0ad4e, #ec971f); color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.4); }
#max-bet-button:hover:not(:disabled) { background: linear-gradient(180deg, #f3bc70, #f0a540); transform: translateY(-2px); box-shadow: 0 5px 10px rgba(236, 151, 31, 0.4); }


#bet-input:focus { background-color: rgba(255, 255, 255, 0.2); outline: 2px solid #ffeb3b; }
#bet-input:disabled { background-color: rgba(80, 80, 80, 0.5); color: #aaa; cursor: not-allowed; box-shadow: inset 0 2px 4px rgba(0,0,0,0.4); }

/* NPC親ターンのスタイル調整 */
#game-screen.npc-parent .bet-main-controls {
    opacity: 0.5;
    pointer-events: none;
}
#game-screen.npc-parent .bet-action-container {
    display: none;
}
#game-screen.npc-parent .bet-input-container label,
#game-screen.npc-parent .bet-input-container span {
    opacity: 0.7;
}
#game-screen.npc-parent #bet-input {
     background-color: rgba(50, 50, 70, 0.7);
     border: 1px solid rgba(255, 255, 255, 0.1);
     pointer-events: none;
}

/* 次WAVEボタンエリア */
#next-wave-area {
    display: none; /* 初期非表示 */
    justify-content: center;
}

/* ボタン共通スタイル */
button { padding: 10px 18px; font-size: 1em; cursor: pointer; border: none; border-radius: 20px; color: #333; font-weight: bold; transition: all 0.2s ease; text-shadow: 0px 1px 1px rgba(255,255,255,0.3); box-shadow: 0 3px 5px rgba(0,0,0,0.3); }
button:disabled { background-color: #555 !important; background-image: none !important; color: #999 !important; cursor: not-allowed; box-shadow: inset 0 2px 4px rgba(0,0,0,0.4); text-shadow: none;}
#roll-button, #next-wave-button, #restart-same-mode-button, #confirm-character-yes /* 確認(はい)ボタンも同じ色 */ { background: linear-gradient(180deg, #ffeb3b, #ffc107); } /* ★ restart-same-difficulty-button -> restart-same-mode-button */
#roll-button:hover:not(:disabled), #next-wave-button:hover:not(:disabled), #restart-same-mode-button:hover, #confirm-character-yes:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 10px rgba(255, 200, 0, 0.4); } /* ★ restart-same-difficulty-button -> restart-same-mode-button */
.button-subtle, #back-to-title-from-result-button, #history-button, #settings-button, #back-to-title-button, #confirm-character-no /* 確認(いいえ)ボタンも同じ色 */ { background: linear-gradient(180deg, #8a94a8, #6c757d); color: white; text-shadow: 0px -1px 1px rgba(0,0,0,0.4); } /* ★ change-difficulty-button -> back-to-title-from-result-button */
.button-subtle:hover:not(:disabled), #back-to-title-from-result-button:hover, #history-button:hover:not(:disabled), #settings-button:hover:not(:disabled), #back-to-title-button:hover:not(:disabled), #confirm-character-no:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 10px rgba(108, 117, 125, 0.4); } /* ★ change-difficulty-button -> back-to-title-from-result-button */
/* メッセージエリア内のボタン */
.temp-choice-button { margin: 0 5px; padding: 8px 16px; font-size: 0.95em; }

/* スコア変動ポップアップ */
.score-change-popup { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); font-size: 1.3em; font-weight: bold; padding: 2px 8px; border-radius: 5px; z-index: 10; pointer-events: none; opacity: 0; white-space: nowrap; animation: scorePopup 1.5s ease-out forwards; }
.score-change-popup.gain { color: #fff; background-color: rgba(40, 167, 69, 0.9); text-shadow: 0 0 3px #000; }
.score-change-popup.loss { color: #fff; background-color: rgba(220, 53, 69, 0.9); text-shadow: 0 0 3px #000; }
@keyframes scorePopup { 0% { transform: translate(-50%, 0) scale(0.8); opacity: 1; } 80% { transform: translate(-50%, -35px) scale(1.1); opacity: 1; } 100% { transform: translate(-50%, -45px) scale(1); opacity: 0; } }

/* リザルト画面 */
.result-content { background-color: rgba(30, 30, 50, 0.9); min-width: 400px; }
#result-title { font-size: 3em; margin-bottom: 20px; font-weight: 800; text-shadow: 2px 2px 6px rgba(0,0,0,0.6); } #result-title.clear { color: #90ee90; } #result-title.over { color: #ff7b7b; }
#result-message, #final-score { font-size: 1.3em; margin-bottom: 15px; color: #ddd; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); } #final-score { font-weight: bold; color: #ffeb3b; }
.result-actions { margin-top: 30px; display: flex; justify-content: space-around; gap: 15px; }
#restart-same-mode-button { background: linear-gradient(180deg, #90ee90, #28a745); color: #333; } /* ★ ID変更 */
#restart-same-mode-button:hover { transform: translateY(-2px); box-shadow: 0 5px 10px rgba(40, 167, 69, 0.4); } /* ★ ID変更 */

/* ===== キャラクター選択画面のスタイル ===== */
#character-select-screen.active {
    /* display: flex; は .screen.active から継承 */
    /* flex-direction, justify-content, align-items は #character-select-screen 自体で設定済み */
}

.character-select-content { /* コンテンツ用ラッパー */
    /* スタイルは親から継承 or 個別指定 */
     display: flex;
    flex-direction: column;
    align-items: center;
}

#character-select-screen h2 { /* 画面タイトル */
    color: #ffcc70;
    margin-bottom: 25px;
    font-size: 2.5em;
    font-family: 'Yuji Syuku', serif;
    margin-top: 0; /* 上マージン除去 */
}
.character-select-body { /* リストとプレビューの親要素 */
    display: flex; /* ★ flex に変更 */
    width: 100%;
    gap: 20px; /* 左右のギャップ */
    margin-bottom: 25px;
    min-height: 400px; /* ★ 高さを確保 */
}
#character-list { /* 左側リストエリア */
    flex: 1; /* 幅の比率 */
    background: rgba(0,0,0,0.2);
    padding: 15px;
    border-radius: 8px;
    max-height: 60vh; /* 高さを制限 */
    overflow-y: auto; /* スクロール可能に */
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    flex-direction: column;
    gap: 8px;
}
#character-list p { /* 初期メッセージ */
    color: #aaa;
    text-align: center;
    margin-top: 10px;
    font-style: italic; /* 見やすく */
}
#character-list button { /* キャラクター名ボタン */
    width: 100%;
    padding: 10px;
    font-size: 1.1em;
    background-color: rgba(255, 255, 255, 0.08);
    color: #eee; /* 文字色を明るく */
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 5px;
    text-align: left;
    cursor: pointer;
    transition: background-color 0.2s ease, border-color 0.2s ease;
    box-shadow: none;
    text-shadow: none;
    font-weight: normal;
}
#character-list button:hover {
    background-color: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.3);
}
#character-list button.selected { /* 選択中のキャラボタン */
    background-color: rgba(255, 235, 59, 0.3);
    border-color: #ffeb3b;
    color: #fff;
    font-weight: bold;
}

#character-preview { /* 右側プレビューエリア */
    flex: 1.5; /* 幅の比率 */
    background: rgba(0,0,0,0.2);
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    min-height: 300px; /* 最低限の高さを確保 */
}
#character-preview-placeholder { /* 初期メッセージ */
    color: #aaa;
    font-size: 1.2em;
    font-style: italic; /* 見やすく */
}
#character-preview-image { /* 画像 */
    max-width: 100%;
    max-height: 350px; /* 最大高さを設定 */
    object-fit: contain;
    margin-bottom: 20px;
    display: none; /* 初期非表示 */
    border-radius: 5px;
    background-color: rgba(0,0,0,0.3); /* 画像がない場合の背景 */
    border: 1px solid rgba(255,255,255,0.1);
}
#character-confirm-area { /* 確認エリア */
    display: none; /* 初期非表示 */
    margin-top: 15px;
}
#character-confirm-message { /* 確認メッセージ */
    color: #eee;
    margin-bottom: 15px;
    font-size: 1.1em;
}
#character-confirm-area button { /* はい/いいえボタン */
    margin: 0 10px;
    padding: 10px 25px;
}
#back-to-title-button { /* タイトルへ戻るボタン */
    margin-top: 20px;
    padding: 10px 30px;
}


/* ===== モーダル共通 ===== */
.modal {
    display: none; /* ★ JSで display: flex; で表示 */
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.8);
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(5px);
    animation: modalFadeIn 0.3s ease-out;
}
@keyframes modalFadeIn { from { opacity: 0; } to { opacity: 1; } }
.modal-content { background-color: #2a2a3a; margin: auto; padding: 30px; border: 1px solid rgba(255, 255, 255, 0.1); width: 85%; max-width: 650px; border-radius: 15px; position: relative; box-shadow: 0 8px 25px rgba(0,0,0,0.6); animation: slideDown 0.4s ease-out; }
@keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
.close-button { color: #aaa; position: absolute; top: 15px; right: 25px; font-size: 32px; font-weight: bold; cursor: pointer; transition: color 0.2s ease; z-index: 1; }
.close-button:hover, .close-button:focus { color: #fff; }
.modal h2 { margin-top: 0; color: #ffcc70; text-align: center; border-bottom: 1px solid rgba(255, 255, 255, 0.2); padding-bottom: 10px; font-weight: 500; text-shadow: 1px 1px 3px rgba(0,0,0,0.5);}
#history-log { list-style: none; padding: 0; max-height: 65vh; overflow-y: auto; margin-top: 20px; }
#history-log li { background-color: rgba(70, 70, 100, 0.6); margin-bottom: 10px; padding: 12px 18px; border-radius: 8px; border-left: 6px solid #666; font-size: 0.95em; transition: background-color 0.2s ease; }
#history-log li:hover { background-color: rgba(85, 85, 115, 0.7); }
#history-log li.win { border-left-color: #90ee90; } #history-log li.lose { border-left-color: #ff7b7b; } #history-log li.draw { border-left-color: #aaa; }
#history-log .wave-num { font-weight: normal; color: #ccc; display: block; margin-bottom: 6px; }
/* 履歴のWAVE/ROUND色指定用クラス */
#history-log .wave-highlight { color: #ffcc70; font-weight: bold; }
#history-log .round-normal { color: #ccc; font-weight: normal; }
/* 履歴の勝敗テキスト色 */
.history-result { font-weight: bold; margin-right: 5px; display: inline-block; min-width: 50px; text-align: center; padding: 2px 4px; border-radius: 4px; }
.history-result.history-win { color: #111; background-color: #90ee90; box-shadow: inset 0 0 3px rgba(0,0,0,0.3); text-shadow: 0 1px 1px rgba(255,255,255,0.5); }
.history-result.history-lose { color: #eee; background-color: #ff7b7b; box-shadow: inset 0 0 3px rgba(0,0,0,0.4); text-shadow: 0 -1px 1px rgba(0,0,0,0.4); }
.history-result.history-draw { color: #ddd; background-color: #aaa; box-shadow: inset 0 0 3px rgba(0,0,0,0.2); }
#history-log .details { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 5px;} #history-log .player, #history-log .npc { font-family: monospace; color: #eee; } #history-log .vs { margin: 0 10px; font-weight: bold; color: #ccc; } #history-log .hand { font-size: 0.9em; color: #bbb; margin-left: 5px; font-style: italic;}
#history-log .bet-amount { font-size: 0.85em; color: #ddd; margin-left: 15px; font-weight: bold; }
#history-log .score-change-history { font-size: 0.9em; text-align: right; margin-top: 4px; }
#history-log .score-change-history .gain { color: #90ee90; font-weight: bold; }
#history-log .score-change-history .loss { color: #ff7b7b; font-weight: bold; }
#history-log .win-streak {
    color: #ffeb3b; /* ゲーム画面と同じ黄色 */
    font-weight: bold; /* 太字 */
    font-style: italic; /* 連敗表示とスタイルを合わせる */
    margin-left: 5px; /* 左マージン */
    animation: pulseYellow 1.5s infinite ease-in-out; /* ゲーム画面と同じアニメーション */
}
#history-log .npc-losing-streak {
    color: #add8e6;
    font-style: italic;
    margin-left: 5px;
    animation: pulseBlue 1.8s infinite ease-in-out;
    font-weight: bold; /* 連勝表示と合わせる */
}
#history-log .parent-info { font-size: 0.85em; color: #ccc; margin-left: 8px; font-weight: normal; }
/* WAVEクリア情報用スタイル */
.wave-clear-info {
    display: block; /* 改行させる */
    margin-top: 5px; /* 上の要素との間隔 */
    margin-bottom: 5px; /* 下の要素との間隔 */
    font-size: 0.9em;
    color: #90ee90; /* クリアの色 */
    font-weight: bold;
    text-align: center; /* 中央揃え */
    background-color: rgba(40, 167, 69, 0.2); /* 薄い緑背景 */
    padding: 3px 6px;
    border-radius: 4px;
}

/* ===== カード一覧モーダル ===== */
.card-list-modal-content { max-width: 800px; }
#card-list-content { list-style: none; padding: 0 10px 0 0; /* 右に少しパディング */ max-height: 70vh; overflow-y: auto; margin-top: 15px; text-align: left; }
.card-list-item { background-color: rgba(70, 70, 100, 0.6); margin-bottom: 12px; padding: 15px 20px; border-radius: 8px; border-left: 6px solid #ccc; }
.card-list-item h3 { margin: 0 0 8px 0; color: #ffeb3b; font-size: 1.2em; display: flex; justify-content: space-between; align-items: baseline; flex-wrap: wrap; gap: 5px 15px;} /* 折り返し対応 */
.card-list-item h3 .card-meta { font-size: 0.8em; color: #ccc; font-weight: normal; }
.card-list-item .card-meta span { margin-left: 10px; }
.card-list-item .card-meta .rarity-N { color: #9e9e9e; font-weight: bold;}
.card-list-item .card-meta .rarity-R { color: #4a90e2; font-weight: bold;}
.card-list-item .card-meta .rarity-EP { color: #9c27b0; font-weight: bold;}
.card-list-item .card-meta .rarity-LG { color: #ff9800; font-weight: bold;}
.card-list-item .card-meta .type-support { color: #81b7f3; font-weight: bold;}
.card-list-item .card-meta .type-dice { color: #f18a8a; font-weight: bold;}
.card-list-item .card-meta .type-score { color: #77cc87; font-weight: bold;}
.card-list-item p { margin: 5px 0; line-height: 1.5; font-size: 0.95em; }
.card-list-item .flavor-text { font-style: italic; color: #bbb; font-size: 0.9em; margin-bottom: 8px; }
.card-list-item .effect-details { font-size: 0.9em; color: #e0e0e0; background-color: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; margin-top: 8px; }

/* ===== ショップ画面専用スタイル ===== */
#shop-screen { flex-direction: column; justify-content: flex-start; align-items: center; padding: 20px; box-sizing: border-box; z-index: 1; overflow-y: auto; }
.shop-content { background-color: rgba(40, 40, 60, 0.9); padding: 30px 40px; border-radius: 15px; box-shadow: 0 6px 25px rgba(0, 0, 0, 0.5); border: 1px solid rgba(255, 255, 255, 0.1); width: 100%; max-width: 1000px; text-align: center; position: relative; animation: fadeInShop 0.5s ease-out; z-index: 2; margin-top: 20px; margin-bottom: 20px; }
@keyframes fadeInShop { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
.shop-title { color: #ffcc70; margin-top: 0; margin-bottom: 15px; font-size: 2.2em; font-family: 'Yuji Syuku', serif; text-shadow: 2px 2px 5px rgba(0,0,0,0.6); }
#player-status { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; background-color: rgba(0,0,0,0.2); padding: 10px 15px; border-radius: 8px; }
#coin-display { font-size: 1.2em; color: #ffeb3b; font-weight: bold; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); text-align: left; }
#coin-display #player-coins { font-size: 1.2em; }
#shop-player-hand { font-size: 0.9em; color: #ccc; text-align: right; max-width: 70%; }
#hand-cards {
    list-style: none;
    padding: 0;
    margin: 5px 0 0 0;
    display: flex;
    flex-wrap: wrap; /* ★ 折り返しを許可 */
    justify-content: flex-end; /* 右寄せ */
    gap: 5px 8px; /* 縦横の隙間 */
    max-height: 60px; /* ★ 高さを制限 (2行分程度) */
    overflow-y: auto; /* ★ 3行以上になったらスクロール */
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, 0.1) rgba(0,0,0,0.1);
}
/* スクロールバー (WebKit系) */
#hand-cards::-webkit-scrollbar { height: 4px; width: 4px; }
#hand-cards::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
#hand-cards::-webkit-scrollbar-thumb { background-color: rgba(255, 255, 255, 0.2); border-radius: 2px;}

.hand-card-item {
    background-color: rgba(255, 255, 255, 0.1);
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 0.9em;
    white-space: nowrap;
    cursor: default;
    display: flex;
    align-items: center;
    gap: 8px;
}
.sell-card-button { background-color: rgba(220, 53, 69, 0.7); color: #eee; border: none; border-radius: 10px; padding: 2px 6px; font-size: 0.8em; font-weight: bold; cursor: pointer; transition: background-color 0.2s ease; }
.sell-card-button:hover { background-color: rgba(220, 53, 69, 0.9); }
.sell-card-button:disabled { background-color: #555 !important; color: #999 !important; cursor: not-allowed; }

.shop-message { font-size: 1em; color: #ccc; margin-bottom: 30px; min-height: 1.2em; }
/* ショップレイアウト用スタイル */
.shop-offers-container {
    width: 100%;
    margin-bottom: 30px;
}

.shop-section {
    margin-bottom: 25px; /* 各セクション間のマージン */
    padding-bottom: 15px; /* 下線とのスペース */
    border-bottom: 1px dashed rgba(255, 255, 255, 0.15); /* セクション区切り線 */
}
.shop-section:last-child {
    margin-bottom: 0;
    border-bottom: none;
    padding-bottom: 0;
}

.shop-section-title {
    font-size: 1.3em;
    color: #ffcc70;
    text-align: left;
    margin-top: 0;
    margin-bottom: 15px; /* タイトルとアイテム行の間隔 */
    padding-left: 5px;
    font-weight: 500;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
}

/* アイテム表示行の共通スタイル (カードアクションモーダルと同様) */
.shop-item-row {
    display: flex;
    flex-wrap: nowrap; /* 横一列に */
    gap: 15px;         /* アイテム間の隙間 */
    justify-content: flex-start; /* 左詰め */
    padding: 10px 15px; /* 内側のパディング */
    background-color: rgba(0, 0, 0, 0.15);
    border-radius: 8px;
    min-height: 150px; /* ★ 最低限の高さを確保 (中身がない場合など) */
    align-items: stretch; /* ★ アイテムの高さを揃える */
    overflow-x: auto; /* 横スクロール */
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, 0.2) rgba(0, 0, 0, 0.1);
}
/* スクロールバー (WebKit) */
.shop-item-row::-webkit-scrollbar { height: 8px; }
.shop-item-row::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); border-radius: 4px; }
.shop-item-row::-webkit-scrollbar-thumb { background-color: rgba(255, 255, 255, 0.2); border-radius: 4px; }
.shop-item-row::-webkit-scrollbar-thumb:hover { background-color: rgba(255, 255, 255, 0.3); }

/* オファーがない場合のメッセージ */
.shop-empty-message {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    color: #888;
    font-style: italic;
    min-height: 100px; /* メッセージ表示時の高さ */
}
/* ショップカード要素調整 & レアリティエフェクト */
.card {
    border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 10px; padding: 15px 15px 50px 15px;
    width: 200px; min-height: 280px; /* サイズを維持 */
    flex-shrink: 0; /* 縮まないように */
    box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4), inset 0 0 5px rgba(0,0,0,0.2); display: flex; flex-direction: column; transition: transform 0.2s ease, box-shadow 0.2s ease; position: relative; overflow: hidden; background-size: cover; background-position: center center; background-repeat: no-repeat; background-color: rgba(60, 60, 90, 0.8);
}
.card:not(.sold-out):hover { transform: translateY(-6px) scale(1.03); box-shadow: 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 8px rgba(0,0,0,0.3); }
.card::before { content: ""; position: absolute; top: 0; left: -85%; z-index: 2; display: block; width: 50%; height: 100%; background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,.3) 50%, rgba(255,255,255,0) 100%); transform: skewX(-25deg); opacity: 0; transition: opacity 0.3s; }
.card.rarity-rare::before { animation: shining 3.5s infinite linear; opacity: 1; }
.card.rarity-epic::before { animation: shining 2.8s infinite linear; opacity: 1; }
.card.rarity-legendary::before { width: 70%; animation: shining 2.2s infinite linear .2s; opacity: 1; }

@keyframes shining {
  0% { left: -100%; }
  40%, 100% { left: 120%; }
}

.card-type-badge { position: absolute; top: 0; left: 0; padding: 3px 10px; font-size: 0.8em; font-weight: bold; border-radius: 10px 0 10px 0; color: #fff; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); z-index: 1; }
.card-rarity-badge { position: absolute; top: 0; right: 0; padding: 3px 10px; font-size: 0.8em; font-weight: bold; border-radius: 0 10px 0 10px; color: #fff; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); z-index: 1; }
.card.rarity-normal .card-rarity-badge { background-color: #9e9e9e; }
.card.rarity-rare .card-rarity-badge { background-color: #4a90e2; }
.card.rarity-epic .card-rarity-badge { background-color: #9c27b0; }
.card.rarity-legendary .card-rarity-badge { background-color: #ff9800; }
.card.type-support .card-type-badge { background-color: #4a90e2; }
.card.type-dice .card-type-badge { background-color: #e65252; }
.card.type-score .card-type-badge { background-color: #28a745; }
.card-name { font-size: 1.2em; color: #ffeb3b; margin-top: 15px; margin-bottom: 8px; font-weight: 800; text-shadow: 1px 1px 3px rgba(0,0,0,0.6); background-color: rgba(0, 0, 0, 0.4); border: 1px solid rgba(255, 255, 255, 0.2); padding: 5px 10px; border-radius: 8px; display: inline-block; line-height: 1.3; text-align: center; }
.card-name .card-level { display: block; font-size: 0.8em; color: #ffcc70; font-weight: normal; }
.card-level-value-2 { color: #90ee90; text-shadow: 0 0 3px #28a745; font-weight: bold;}
.card-level-value-3 { color: #ff8c00; text-shadow: 0 0 5px #ffeb3b; font-weight: bold;}
.card-description { font-size: 0.9em; color: #e8e8e8; line-height: 1.5; text-align: left; margin-bottom: 10px; flex-grow: 1; position: relative; z-index: 0; text-shadow: 1px 1px 2px rgba(0,0,0,0.9), -1px -1px 2px rgba(0,0,0,0.9), 1px -1px 2px rgba(0,0,0,0.9), -1px 1px 2px rgba(0,0,0,0.9); background-color: rgba(0, 0, 0, 0.5); padding: 8px; border-radius: 5px; box-sizing: border-box; }
.card-footer { position: absolute; bottom: 10px; left: 10px; right: 10px; display: flex; justify-content: space-between; align-items: center; padding-top: 0; border-top: none; }
.card-cost { font-size: 1.0em; font-weight: bold; color: #ffcc70; background-color: rgba(0, 0, 0, 0.4); border: 1px solid rgba(255, 255, 255, 0.2); padding: 6px 12px; border-radius: 15px; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
.card-cost::after { display: none; }
.card.upgradeable.max-level .card-cost { color: #aaa; font-style: italic; font-weight: normal; background-color: rgba(50, 50, 50, 0.4); border-color: rgba(150, 150, 150, 0.4); }
.card.upgradeable.max-level .card-cost::after { display: none; }

.buy-button { padding: 6px 14px; font-size: 0.9em; cursor: pointer; border: none; border-radius: 15px; color: #333; font-weight: bold; transition: all 0.2s ease; text-shadow: 0px 1px 1px rgba(255,255,255,0.3); box-shadow: 0 2px 4px rgba(0,0,0,0.3); background: linear-gradient(180deg, #ffeb3b, #ffc107); }
.buy-button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(255, 200, 0, 0.4); }
.buy-button:disabled { background-color: #555 !important; background-image: none !important; color: #999 !important; cursor: not-allowed; box-shadow: inset 0 2px 4px rgba(0,0,0,0.4); text-shadow: none; }
.shop-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); }
#reroll-button { padding: 8px 18px; font-size: 1em; background: linear-gradient(180deg, #5bc0de, #31b0d5); color: white; }
#reroll-button:hover:not(:disabled) { background: linear-gradient(180deg, #70cce6, #4ac0e0); transform: translateY(-1px); box-shadow: 0 3px 6px rgba(0,0,0,0.3); }
.reroll-icon { font-size: 1.2em; margin-right: 5px; vertical-align: middle; display: inline-block; transition: transform 0.5s ease; }
#reroll-button:hover:not(:disabled) .reroll-icon { transform: rotate(180deg); }
#close-shop-button { padding: 10px 25px; font-size: 1.1em; cursor: pointer; border: none; border-radius: 20px; color: white; font-weight: bold; transition: all 0.2s ease; text-shadow: 0px -1px 1px rgba(0,0,0,0.4); box-shadow: 0 3px 5px rgba(0,0,0,0.3); background: linear-gradient(180deg, #f0ad4e, #ec971f); margin-top: 0; }
#close-shop-button:hover { background: linear-gradient(180deg, #f3bc70, #f0a540); transform: translateY(-2px); box-shadow: 0 5px 10px rgba(236, 151, 31, 0.4); }
/* ショップ売却確認ボタン用コンテナ */
#shop-confirmation-buttons { display: flex; justify-content: center; gap: 15px; margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); }
/* 確認ボタンのスタイル */
#shop-confirmation-buttons button { padding: 10px 25px; font-size: 1.1em; }
/* パックとブーストアイテムの基本スタイルを追加 */
.pack, .boost-item {
    border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 10px; padding: 15px 15px 50px 15px;
    width: 200px; min-height: 280px; /* カードと同じサイズに */
    flex-shrink: 0;
    box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4), inset 0 0 5px rgba(0,0,0,0.2);
    display: flex; flex-direction: column;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    position: relative; overflow: hidden;
    background-size: cover; background-position: center center; background-repeat: no-repeat;
    background-color: rgba(80, 60, 100, 0.8); /* 少し色を変える (例: 紫系) */
    text-align: center;
}
.pack:not(.sold-out):hover, .boost-item:not(.sold-out):hover {
    transform: translateY(-6px) scale(1.03);
    box-shadow: 5px 10px 15px rgba(0, 0, 0, 0.5), inset 0 0 8px rgba(0,0,0,0.3);
}
/* パック/ブーストアイテム内の要素スタイル (カードに準拠) */
.pack .card-name, .boost-item .card-name { /* h3流用 */
    font-size: 1.1em; /* カード名より少し小さく */
    color: #e0e0e0; /* 白っぽく */
    margin-top: 15px; margin-bottom: 10px;
    font-weight: bold;
    background-color: rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.25);
    padding: 6px 10px;
    border-radius: 8px;
    display: inline-block; /* 幅を内容に合わせる */
}
.pack .card-description, .boost-item .card-description { /* p流用 */
    font-size: 0.9em; color: #d0d0d0; line-height: 1.5; text-align: left; margin-bottom: 10px; flex-grow: 1; background-color: rgba(0, 0, 0, 0.4); padding: 8px; border-radius: 5px; box-sizing: border-box; text-shadow: 1px 1px 1px rgba(0,0,0,0.7);
}
/* パック/ブーストアイテムのフッターとコスト表示 (カードに準拠) */
.pack .card-footer, .boost-item .card-footer { position: absolute; bottom: 10px; left: 10px; right: 10px; display: flex; justify-content: space-between; align-items: center; }
.pack .card-cost, .boost-item .card-cost { font-size: 1.0em; font-weight: bold; color: #ffcc70; background-color: rgba(0, 0, 0, 0.4); border: 1px solid rgba(255, 255, 255, 0.2); padding: 6px 12px; border-radius: 15px; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
/* パック/ブーストアイテムの購入ボタン (カードに準拠) */
.pack .buy-button, .boost-item .buy-button { padding: 6px 14px; font-size: 0.9em; cursor: pointer; border: none; border-radius: 15px; color: #333; font-weight: bold; transition: all 0.2s ease; text-shadow: 0px 1px 1px rgba(255,255,255,0.3); box-shadow: 0 2px 4px rgba(0,0,0,0.3); background: linear-gradient(180deg, #6fa8dc, #4a90e2); color: white; } /* ボタン色変更 */
.pack .buy-button:hover:not(:disabled), .boost-item .buy-button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(74, 144, 226, 0.4); background: linear-gradient(180deg, #81b7f3, #5aa1e9); }
.pack .buy-button:disabled, .boost-item .buy-button:disabled { background-color: #555 !important; background-image: none !important; color: #999 !important; cursor: not-allowed; box-shadow: inset 0 2px 4px rgba(0,0,0,0.4); text-shadow: none; }

/* 売り切れスタイル (パック/ブーストアイテムにも適用) */
.pack.sold-out, .boost-item.sold-out { opacity: 0.55; pointer-events: none; position: relative; box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4), inset 0 0 5px rgba(0,0,0,0.2); animation: none; border-color: rgba(255, 255, 255, 0.15); }
.pack.sold-out::after, .boost-item.sold-out::after { content: "SOLD OUT"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg) scale(1.1); background-color: rgba(220, 53, 69, 0.9); color: white; padding: 10px 18px; font-size: 1.3em; font-weight: bold; border-radius: 8px; z-index: 10; text-shadow: 2px 2px 3px rgba(0,0,0,0.6); box-shadow: 3px 3px 7px rgba(0,0,0,0.4); white-space: nowrap; border: 2px solid rgba(255, 255, 255, 0.5); }
.pack.sold-out .card-footer, .boost-item.sold-out .card-footer { display: none; }

/* カード破棄モーダル */
.discard-modal-content { max-width: 500px; text-align: center; }
.modal h3 { margin-top: 0; color: #ffcc70; font-size: 1.5em; margin-bottom: 15px; }
.modal p { color: #ccc; margin-bottom: 20px; }
#discard-options { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 25px; }
.discard-choice-button { padding: 8px 15px; font-size: 0.9em; cursor: pointer; border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 15px; background-color: rgba(255, 255, 255, 0.1); color: #eee; transition: background-color 0.2s ease, border-color 0.2s ease; }
.discard-choice-button:hover { background-color: rgba(255, 255, 255, 0.2); border-color: rgba(255, 255, 255, 0.4); }
#cancel-discard-button { background: linear-gradient(180deg, #8a94a8, #6c757d); color: white; text-shadow: 0px -1px 1px rgba(0,0,0,0.4); }
#cancel-discard-button:hover { background: linear-gradient(180deg, #9fa8b8, #7c858d); transform: translateY(-2px); box-shadow: 0 5px 10px rgba(108, 117, 125, 0.4); }

/* ダイス選択オーバーレイ */
.overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.75); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 50; border-radius: 12px; padding: 20px; box-sizing: border-box; }
.overlay h3 { color: #ffcc70; margin-bottom: 10px; }
.overlay p { color: #eee; margin-bottom: 20px; }
.dice-choice-buttons { display: flex; flex-direction: column; gap: 10px; align-items: center; }
.dice-choice-button { font-size: 2em; padding: 10px 20px; font-family: monospace; min-width: 60px; background: linear-gradient(180deg, #ffeb3b, #ffc107); color: #333; }

/* サイコロロールモーダル */
.dice-roll-modal {}
.dice-roll-modal-content {
    background-color: transparent;
    border: none;
    box-shadow: none;
    max-width: 60vw;
    width: 60vw;
    aspect-ratio: 16 / 9;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    animation: rollModalAppear 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    overflow: hidden;
    margin: auto;
}
@keyframes rollModalAppear { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }
#dice-roll-modal-display {
    width: 100%;
    height: 100%;
}
.dice-roll-modal-content .close-button {
    top: 10px;
    right: 15px;
    z-index: 1051;
    color: rgba(255, 255, 255, 0.7);
    text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
}
.dice-roll-modal-content .close-button:hover {
    color: rgba(255, 255, 255, 1);
}

/* ===== 設定モーダル カード一覧カテゴリタブ ===== */
.card-list-filter-tabs {
    display: flex;
    justify-content: flex-start; /* 左寄せ */
    gap: 5px; /* タブ間の隙間 */
    margin-bottom: 15px; /* リストとの間隔 */
    padding-left: 5px; /* 左に少しパディング */
    border-bottom: 2px solid rgba(255, 255, 255, 0.1); /* 下線 */
}

.filter-tab {
    padding: 8px 15px;
    font-size: 0.9em;
    background-color: rgba(255, 255, 255, 0.05);
    color: #aaa;
    border: none; /* 下以外のボーダーなし */
    border-top-left-radius: 6px; /* 上の角を丸める */
    border-top-right-radius: 6px;
    cursor: pointer;
    transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease;
    position: relative; /* activeの下線用 */
    bottom: -2px; /* 下線と重なるように少し下げる */
    border-bottom: 2px solid transparent; /* 非アクティブ時の下線 */
    font-weight: 500;
    box-shadow: none;
}

.filter-tab:hover {
    background-color: rgba(255, 255, 255, 0.1);
    color: #ccc;
}

.filter-tab.active {
    background-color: #2a2a3a; /* モーダル背景色と同じにして繋がっているように見せる */
    color: #ffeb3b; /* アクティブ時の文字色 */
    border-bottom: 2px solid #ffeb3b; /* アクティブ時の下線 */
    font-weight: bold;
    transform: translateY(1px); /* わずかに上に */
}

/* ===== カード一覧 フィルタリング用CSS ===== */

/* アクティブフィルタ時 */
#settings-card-list-content.filter-active .card-type-passive {
    display: none;
}

/* パッシブフィルタ時 */
#settings-card-list-content.filter-passive .card-type-active {
    display: none;
}

/* カードリストアイテムにタイプ別クラスを追加するための準備 (既存スタイルに追加) */
.card-list-item {
    /* ... 既存のスタイル ... */
    transition: opacity 0.3s ease, max-height 0.3s ease; /* 非表示アニメーション用 (任意) */
    overflow: hidden; /* 非表示アニメーション用 */
}
/* 非表示時のスタイル (任意 - アニメーション用) */
/*.filter-active .card-type-passive,
.filter-passive .card-type-active {
    opacity: 0;
    max-height: 0;
    padding-top: 0;
    padding-bottom: 0;
    margin-bottom: 0;
    border-width: 0;
}*/
#settings-card-list-content { max-height: 60vh; overflow-y: auto; text-align: left; padding-right: 10px; }
#settings-card-list-inner { margin-top: 10px; /* タブの下にスペース */ }

/* レアリティの色指定 (No.3対応) */
.card-list-item h3 .rarity-normal { color: #bdbdbd; } /* 灰色 */
.card-list-item h3 .rarity-rare { color: #64b5f6; } /* 水色 */
.card-list-item h3 .rarity-epic { color: #ba68c8; } /* 紫色 */
.card-list-item h3 .rarity-legendary { color: #ffb74d; } /* オレンジ色 */

/* カードメタ情報の太字解除 */
.card-list-item h3 .card-meta span {
    font-weight: normal; /* 太字解除 */
}
/* タイプ名は少し太くても良いかも */
.card-list-item h3 .card-meta .type-support,
.card-list-item h3 .card-meta .type-dice,
.card-list-item h3 .card-meta .type-score {
    font-weight: 500; /* 少し太く */
}
/* レアリティ記号は太字でも良いかも */
.card-list-item h3 .card-meta .rarity-normal,
.card-list-item h3 .card-meta .rarity-rare,
.card-list-item h3 .card-meta .rarity-epic,
.card-list-item h3 .card-meta .rarity-legendary {
   font-weight: bold; /* 星とレアリティ文字は太字 */
}

/* カード一覧モーダル */
.card-list-modal-content { max-width: 800px; }
#card-list-content { list-style: none; padding: 0 10px 0 0; max-height: 70vh; overflow-y: auto; margin-top: 15px; text-align: left; }
.card-list-item { background-color: rgba(70, 70, 100, 0.6); margin-bottom: 12px; padding: 15px 20px; border-radius: 8px; border-left: 6px solid #ccc; }
.card-list-item h3 { margin: 0 0 8px 0; color: #ffeb3b; font-size: 1.2em; display: flex; justify-content: space-between; align-items: baseline; flex-wrap: wrap; gap: 5px 15px;}
.card-list-item h3 .card-meta { font-size: 0.8em; color: #ccc; font-weight: normal; }
.card-list-item .card-meta span { margin-left: 10px; }
.card-list-item .card-meta .rarity-N { color: #9e9e9e; font-weight: bold;}
.card-list-item .card-meta .rarity-R { color: #4a90e2; font-weight: bold;}
.card-list-item .card-meta .rarity-EP { color: #9c27b0; font-weight: bold;}
.card-list-item .card-meta .rarity-LG { color: #ff9800; font-weight: bold;}
.card-list-item .card-meta .type-support { color: #81b7f3; font-weight: bold;}
.card-list-item .card-meta .type-dice { color: #f18a8a; font-weight: bold;}
.card-list-item .card-meta .type-score { color: #77cc87; font-weight: bold;}
.card-list-item p { margin: 5px 0; line-height: 1.5; font-size: 0.95em; }
.card-list-item .flavor-text { font-style: italic; color: #bbb; font-size: 0.9em; margin-bottom: 8px; }
.card-list-item .effect-details { font-size: 0.9em; color: #e0e0e0; background-color: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; margin-top: 8px; }

/* ===== 設定モーダル ゲームルール表示調整 ===== */
#settings-rules-content h4 {
    font-size: 1.1em;
    color: #87CEFA; /* 少し明るい青系 */
    margin-top: 20px; /* 前のセクションとの間隔 */
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px dotted rgba(135, 206, 250, 0.5); /* 点線の下線 */
    font-weight: bold; /* 太字にする */
}
#settings-rules-content h4:first-of-type {
    margin-top: 0; /* 最初のh4の上マージンは不要 */
}

#settings-rules-content ul {
    padding-left: 25px; /* インデントを少し深く */
    margin-bottom: 15px; /* リスト下のマージン */
    list-style-type: '🎲 '; /* 絵文字リストマーカー */
}

#settings-rules-content li {
    margin-bottom: 10px; /* 各項目の間隔 */
    line-height: 1.8; /* 行間を広げる */
    color: #d8d8d8; /* 文字色を少し明るく */
}

/* 強調表示のスタイル */
#settings-rules-content strong {
    color: #ffeb3b; /* 黄色 */
    font-weight: bold; /* 太字を維持 */
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3); /* 少し影付け */
}

/* ===== 設定モーダル ===== */
.settings-modal-content {
    max-width: 700px; /* 幅を少し広げる */
}

.settings-navigation {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.15);
    flex-wrap: wrap; /* スマホ用に折り返し */
}

.settings-nav-button {
    padding: 8px 18px;
    font-size: 1em;
    background-color: rgba(255, 255, 255, 0.1);
    color: #ccc;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 15px;
    cursor: pointer;
    transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
    font-weight: normal; /* 通常ボタンの太さに */
    box-shadow: none; /* 通常ボタンの影削除 */
}

.settings-nav-button:hover {
    background-color: rgba(255, 255, 255, 0.15);
    color: #fff;
    border-color: rgba(255, 255, 255, 0.3);
}

.settings-nav-button.active {
    background: linear-gradient(180deg, #ffeb3b, #ffc107);
    color: #333;
    font-weight: bold;
    border-color: #ffc107;
}

#settings-content {
    max-height: 60vh; /* コンテンツエリアの最大高さ */
    overflow-y: auto; /* 内容が多い場合にスクロール */
    text-align: left; /* 内容は左寄せ */
    padding-right: 10px; /* スクロールバー用 */
}

#settings-content h3 {
    color: #ffcc70;
    margin-top: 0;
    margin-bottom: 15px;
    border-bottom: 1px dashed rgba(255, 255, 255, 0.2);
    padding-bottom: 8px;
}

#settings-content ul, #settings-content dl {
    font-size: 0.95em;
    line-height: 1.7;
    color: #ddd;
}
#settings-content ul {
    padding-left: 20px;
    list-style: disc;
}
#settings-content li {
    margin-bottom: 8px;
}
#settings-content dt {
    font-weight: bold;
    color: #ffeb3b;
    margin-top: 15px; 
    text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
}
#settings-content dd {
    margin-left: 15px;
    margin-bottom: 8px;
    line-height: 1.5;
    color: #ccc;
}
#settings-content strong { font-weight: bold; }
#settings-content .payout-win { color: #ff9800; } /* 勝ち(高倍率) */
#settings-content .payout-win-normal { color: #ffeb3b; } /* 勝ち(通常倍率) */
#settings-content .payout-lose { color: #e91e63; } /* 負け */
#settings-content .payout-neutral { color: #ccc; } /* 中立 */

.settings-tab-content {
    display: none; /* 初期状態は非表示 */
    animation: fadeIn 0.3s ease-out; /* 表示時にフェードイン */
}
.settings-tab-content.active {
    display: block; /* アクティブなタブを表示 */
}

/* モーダル内のスクロールバー調整 (任意) */
#settings-content::-webkit-scrollbar {
    width: 8px;
}
#settings-content::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 4px;
}
#settings-content::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
}
#settings-content::-webkit-scrollbar-thumb:hover {
    background-color: rgba(255, 255, 255, 0.3);
}

/* 得点計算式 説明エリア */
.score-calculation-info {
    background-color: rgba(0, 0, 0, 0.2);
    padding: 15px 20px;
    border-radius: 8px;
    margin-bottom: 25px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}
.score-calculation-info h4 {
    margin-top: 0;
    margin-bottom: 10px;
    color: #eee; /* 見出しの色を少し抑える */
    font-size: 1.1em;
    text-align: center;
    border-bottom: none; /* 下線削除 */
}
.score-calculation-info p {
    margin-bottom: 8px;
    font-size: 0.9em; /* 少し小さく */
    line-height: 1.6;
    color: #ccc;
}
.calculation-formula {
    font-family: monospace; /* 計算式っぽく */
    font-size: 1em; /* 少し大きく */
    background-color: rgba(0, 0, 0, 0.3);
    padding: 10px;
    border-radius: 4px;
    text-align: center;
    word-wrap: break-word; /* 長い場合に折り返す */
}
.calculation-formula strong {
    color: #ffeb3b; /* 黄色 */
}
.calculation-formula .formula-part {
    color: #aaa; /* 記号など */
}
.score-calculation-info small {
    font-size: 0.8em;
    color: #aaa;
    display: block; /* 改行 */
    text-align: center;
    margin-top: 5px;
}
/* ツールチップ風スタイル (任意) */
.tooltip {
    position: relative;
    border-bottom: 1px dotted #aaa; /* 下点線 */
    cursor: help; /* ヘルプカーソル */
    color: #87CEFA; /* 水色 */
}
.tooltip:hover::after {
    content: attr(title); /* title属性の内容を表示 */
    position: absolute;
    bottom: 120%; /* テキストの上に表示 */
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(50, 50, 70, 0.95);
    color: #eee;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 0.8em;
    white-space: nowrap;
    z-index: 10;
    box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    border: 1px solid rgba(255, 255, 255, 0.1);
    font-family: 'M PLUS Rounded 1c', sans-serif; /* フォントを戻す */
    font-weight: normal; /* 太字解除 */
    font-style: normal; /* イタリック解除 */
}

/* カード効果倍率表示用スタイル */
.card-effect-rate {
    font-size: 0.85em;
    color: #aaa;
    margin-left: 15px;
    margin-top: -5px; /* 上の説明との間隔を詰める */
    margin-bottom: 10px; /* 次の役との間隔 */
    font-style: italic;
}
.card-effect-rate span {
    font-weight: bold;
    color: #87CEFA; /* 水色 */
    font-style: normal;
}

/* レスポンシブ対応 */
@media (max-width: 1100px) {
    #game-main-area { width: 100%; padding: 0; padding-top: 50px; /* ヘッダー分 */ }
    #game-container { max-width: 90%; } /* PC幅でも少し広げる */
    .shop-content { max-width: 90%; }
    .card { width: calc(33.33% - 15px); }
    .dice-roll-modal-content { max-width: 70vw; width: 70vw; }
    /* 1100px での .character-image-area 調整 */
    .character-image-area { width: 200px; height: 250px; } /* 調整後のサイズを維持 */
    #control-area { max-width: 70%; } /* コントロールバー幅調整 */
}
@media (max-width: 880px) {
    #game-container { max-width: 90%; } /* 880pxでも調整 */
    .shop-content { max-width: 95%; }
    .card { width: calc(50% - 15px); min-height: 260px; }
    .dice-roll-modal-content { max-width: 80vw; width: 80vw; }
    /* 880px での #game-area 調整 */
    #game-area { flex-direction: column; gap: 10px; align-items: center; } /* 縦並び、中央寄せ */
    .player-box { width: 80%; max-width: 350px; /* 幅を調整 */ }
    #dice-area { width: 90%; max-width: 400px; /* 幅を調整 */ }
    .character-image-area { width: 150px; height: 180px; order: 1; } /* サイズ調整 */
    .character-image-area.npc { order: 3; /* NPC画像はダイスの後 */ }
    #player-info { order: 0; } /* プレイヤー情報 */
    #dice-area { order: 2; } /* ダイスエリア */
    #npc-info { order: 4; } /* NPC情報 */
    #control-area { max-width: 80%; } /* コントロールバー幅調整 */
}
@media (max-width: 768px) {
    #game-header { padding: 6px 10px; }
    #game-coin-display { font-size: 1.1em; }
    #settings-button { width: 35px; height: 35px; font-size: 1.2em; }
    #game-main-area { padding-top: 45px; }
    #game-container { max-width: 95%; } /* スマホ幅 */

    .title-content, .result-content, .character-select-content { padding: 30px 20px; width: 90%; }
    .game-title { font-size: 3em; }
    .mode-button { padding: 10px 15px; font-size: 1em; margin: 5px 3px; } /* ★ mode-button 用に修正 */
    #start-game-button { padding: 12px 30px; font-size: 1.2em; }
    #select-character-button { padding: 10px 20px; font-size: 1em; } /* スマホ用調整 */
    #game-screen { padding: 0; }
    #game-scrollable-area { padding: 10px; padding-bottom: 180px; }
    #game-container { padding: 15px; margin-bottom: 0; border-radius: 15px; }
    #wave-info { text-align: center; width: 100%; margin-top: 0; margin-bottom: 5px; }

    #current-bet-info { font-size: 1em; margin-bottom: 10px; }
    #game-area { flex-direction: column; gap: 10px; } /* 縦並び */
    .player-box { width: 100%; } /* 幅100% */
    .player-box h2 { display: flex; align-items: center; justify-content: center; }
    .parent-marker { font-size: 0.7em; }
    #dice-area { width: 100%; max-width: none; } /* 幅100% */
    /* スマホでのキャラクター画像エリア調整 */
    .character-image-area { width: 120px; height: 150px; margin-bottom: 5px; }
    #dice-display { font-size: 4em; letter-spacing: 0.1em;}
    .center-role { font-size: 4.5em; padding: 0.1em 0.3em; }
    .center-role.role-pinzoro { font-size: 5.5em; }
    .center-role.role-arashi { font-size: 5em; }
    .center-role.role-shigoro { font-size: 5em; }
    .center-role.role-normal-eye { font-size: 4em; }
    .center-role.role-hifumi { font-size: 4.5em; }
    .center-role.role-shonben { font-size: 3.5em; }
    .center-role.result-win { font-size: 5em; }
    .center-role.result-lose { font-size: 4.5em; }
    .center-role.result-wave-clear { font-size: 6em; }
    .center-role.result-game-over { font-size: 5.5em; }

    #bottom-control-bar { padding: 10px 10px 15px 10px; }
    #control-area { gap: 10px; margin-top: 0; max-width: 95%; /* スマホでは幅広げる */ }
    /* スマホでの賭け金コントロール */
    .bet-main-controls {
        flex-direction: column; /* 縦積み */
        align-items: stretch; /* 横幅いっぱい */
        gap: 8px;
        padding: 8px; /* パディング調整 */
    }
    .bet-input-container {
        order: 1; /* 入力欄を最初に */
        width: 100%;
        flex-direction: row; /* 横並びに戻す */
        justify-content: space-between;
        align-items: center;
        min-width: unset;
    }
    #bet-input {
        flex-grow: 1; /* 幅を伸ばす */
        max-width: none; /* 最大幅解除 */
    }
    .bet-adjust-container {
        order: 2; /* 調整ボタンを次に */
        width: 100%;
        justify-content: space-around; /* 均等配置 */
    }
    .bet-action-container {
        order: 3; /* アクションボタンを最後に */
        width: 100%;
        justify-content: space-around; /* ボタン均等配置 */
        margin-top: 8px; /* 上との間隔 */
        padding: 8px; /* パディング調整 */
    }
    /* スマホではMIN/決定/MAXボタン幅自動 */
    .bet-action-container button {
        flex-grow: 1; /* 幅を均等に */
        flex-basis: auto;
        max-width: none;
    }

    /* NPC親ターンのスマホ表示 */
    #game-screen.npc-parent .bet-input-container {
         justify-content: center; /* 中央寄せ */
    }
     #game-screen.npc-parent #bet-input {
        flex-grow: 0; /* 幅自動 */
        width: 80px; /* 固定幅 */
    }

    #action-controls { gap: 10px; flex-direction: row; align-items: center;}
    #action-controls button { width: auto; flex-grow: 1; padding: 10px 5px; }
    .result-actions { flex-direction: column; gap: 15px; }
    .result-actions button { width: 100%; }

    /* キャラクター選択画面 スマホ調整 */
    .character-select-content { padding: 20px 15px; }
    #character-select-screen h2 { font-size: 2em; }
    .character-select-body { flex-direction: column; min-height: auto; /* スマホでは最低高さ解除 */ }
    #character-list { max-height: 30vh; }
    #character-preview { min-height: 250px; }
    #character-preview-image { max-height: 180px; }
    #character-confirm-area button { padding: 8px 20px; font-size: 0.9em; }
    #back-to-title-button { padding: 8px 25px; font-size: 0.9em; }

    .modal-content { width: 90%; padding: 20px; max-height: 85vh; display: flex; flex-direction: column; }
    #history-log { font-size: 0.9em; max-height: 60vh; flex-grow: 1; }
    .card-list-modal-content { max-height: 85vh; }
    #card-list-content { max-height: 70vh; font-size: 0.9em; }
    .card-list-item h3 { font-size: 1.1em; }
    .card-list-item .card-meta { font-size: 0.75em; }

    #history-log .details { flex-direction: column; align-items: flex-start; }
    #history-log .vs { display: none; }
    #history-log .score-change-history { text-align: left; }
    #history-log .parent-info { display: block; margin-left: 0; margin-top: 3px; }
    .roll-counter-top-right { top: 8px; right: 10px; font-size: 0.8em; }

    .shop-content { padding: 20px; max-width: 90%; }
    .shop-title { font-size: 1.8em; }
    #player-status { flex-direction: column; align-items: stretch; gap: 10px; }
    #coin-display { font-size: 1.1em; text-align: center; }
    #shop-player-hand { text-align: center; max-width: 100%; font-size: 0.8em; }
    #hand-cards { justify-content: center; }
    .card { width: calc(50% - 10px); /* ギャップ調整 */ min-height: 260px; padding-bottom: 60px; }
    .card-footer { bottom: 15px; }
    .card-name { font-size: 1.1em; }
    .card-description { font-size: 0.85em; }
    .card-cost { font-size: 1em; }
    .buy-button { font-size: 0.8em; padding: 5px 10px; }
    #close-shop-button, #reroll-button { font-size: 1em; padding: 8px 20px; }
    #discard-options { gap: 8px; }
    .discard-choice-button { font-size: 0.8em; padding: 6px 12px; }
    .dice-choice-button { font-size: 1.5em; padding: 8px 15px; min-width: 50px;}
    #hand-cards { justify-content: center; }
    .hand-card-item { font-size: 0.8em; padding: 2px 6px; gap: 5px; }
    .sell-card-button { font-size: 0.7em; padding: 1px 4px; }

    .modal-content { max-height: 90vh; }
    #history-log { max-height: 70vh; }

    .card-list-modal-content { padding: 20px 15px; }
    #card-list-content { max-height: 75vh; font-size: 0.85em;}
    .card-list-item h3 { font-size: 1.05em; }
    .card-list-item .card-meta { font-size: 0.7em; }

    .dice-roll-modal-content { max-width: 80vw; width: 80vw; } /* 再調整 */
}
@media (max-width: 480px) {
    #game-header { padding: 5px 10px; }
    #game-coin-display { font-size: 1em; }
    #settings-button { width: 32px; height: 32px; font-size: 1.1em; }
    #game-main-area { padding-top: 42px; }

    #game-scrollable-area { padding: 5px; padding-bottom: 160px; /* スマホでのバー高さ再調整 */ }
    #game-container { padding: 10px; max-width: 95%; } /* 極小画面幅 */
    #wave-info { font-size: 0.9em; }
    #dice-display { font-size: 3em; }
    .player-box { padding: 12px; }
    .player-box p { font-size: 0.9em; }
    /* 480px での #game-area 調整 */
    #game-area { gap: 8px; }
    .character-image-area { width: 100px; height: 120px; } /* サイズ再調整 */
    .center-role { font-size: 3em; padding: 0.1em 0.2em; }
    .center-role.role-pinzoro { font-size: 3.5em; }
    .center-role.role-arashi { font-size: 3.3em; }
    .center-role.role-shigoro { font-size: 3.2em; }
    .center-role.role-normal-eye { font-size: 3em; }
    .center-role.role-hifumi { font-size: 3.1em; }
    .center-role.role-shonben { font-size: 2.8em; }
    .center-role.result-win { font-size: 4em; }
    .center-role.result-lose { font-size: 3.5em; }
    .center-role.result-wave-clear { font-size: 5em; }
    .center-role.result-game-over { font-size: 4.5em; }

    .parent-marker { font-size: 0.6em; }
    #bottom-control-bar { padding: 8px 8px 10px 8px; }
    #control-area { gap: 8px; max-width: 100%; } /* スマホでは幅最大 */
    /* スマホでの賭け金コントロール */
    .bet-main-controls { gap: 8px; }
    .bet-adjust-button { padding: 6px 10px; font-size: 0.9em; min-width: 40px; }
    #bet-input { padding: 8px; font-size: 1em; }
    #min-bet-display { font-size: 0.8em; }
    .bet-action-container button { padding: 8px 14px; font-size: 1em; }
    .bet-action-container { gap: 8px; }
    button { padding: 8px 15px; font-size: 0.9em; }
    #start-game-button { padding: 10px 25px; font-size: 1.1em; }
    #select-character-button { padding: 8px 18px; font-size: 0.9em; } /* スマホ用調整 */
    #action-controls { gap: 8px; }

    .shop-content { padding: 15px; }
    .card { width: calc(50% - 8px); /* スマホでのギャップ調整 */ min-height: auto; padding-bottom: 65px; }
    .card-footer { bottom: 15px; }
    .card-name { font-size: 1.1em; }
    .card-description { font-size: 0.85em; }
    .card-cost { font-size: 1em; }
    .buy-button { font-size: 0.8em; padding: 5px 10px; }
    #close-shop-button, #reroll-button { font-size: 1em; padding: 8px 20px; }
    #discard-options { gap: 8px; }
    .discard-choice-button { font-size: 0.8em; padding: 6px 12px; }
    .dice-choice-button { font-size: 1.5em; padding: 8px 15px; min-width: 50px;}
    #hand-cards { justify-content: center; }
    .hand-card-item { font-size: 0.8em; padding: 2px 6px; gap: 5px; }
    .sell-card-button { font-size: 0.7em; padding: 1px 4px; }

    /* キャラクター選択画面 極小スマホ調整 */
    .character-select-content { padding: 15px 10px; }
    #character-select-screen h2 { font-size: 1.8em; }
    #character-preview-image { max-height: 150px; }
    #character-confirm-area button { padding: 8px 20px; font-size: 0.9em; }
    #back-to-title-button { padding: 8px 25px; font-size: 0.9em; }

    .modal-content { max-height: 90vh; }
    #history-log { max-height: 70vh; }

    .card-list-modal-content { padding: 20px 15px; }
    #card-list-content { max-height: 75vh; font-size: 0.85em;}
    .card-list-item h3 { font-size: 1.05em; }
    .card-list-item .card-meta { font-size: 0.7em; }

    .dice-roll-modal-content { max-width: 95vw; width: 95vw; }
}

/* ===== カード強化関連スタイル ===== */
.card.upgradeable { border-color: #ffeb3b; position: relative; animation: upgradePulse 1.8s infinite ease-in-out; }
.card.upgradeable:not(.sold-out):hover { box-shadow: 0 0 25px rgba(255, 235, 59, 0.6), inset 0 0 12px rgba(255, 235, 59, 0.25), 5px 10px 15px rgba(0, 0, 0, 0.5); }
@keyframes upgradePulse { 0%, 100% { transform: scale(1); border-width: 1px; box-shadow: 0 0 12px rgba(255, 235, 59, 0.4), inset 0 0 6px rgba(255, 235, 59, 0.15), 3px 3px 8px rgba(0, 0, 0, 0.4); } 50% { transform: scale(1.025); border-width: 2px; box-shadow: 0 0 20px rgba(255, 235, 59, 0.7), inset 0 0 10px rgba(255, 235, 59, 0.3), 4px 6px 12px rgba(0, 0, 0, 0.45); } }
.card.upgradeable-lv3 { border-color: #ff8c00; animation: upgradePulseLv3 1.5s infinite ease-in-out; }
.card.upgradeable-lv3:not(.sold-out):hover { box-shadow: 0 0 30px rgba(255, 140, 0, 0.7), inset 0 0 15px rgba(255, 140, 0, 0.3), 5px 10px 15px rgba(0, 0, 0, 0.5); }
@keyframes upgradePulseLv3 { 0%, 100% { transform: scale(1) rotate(0deg); border-width: 2px; box-shadow: 0 0 15px rgba(255, 140, 0, 0.5), inset 0 0 8px rgba(255, 140, 0, 0.2), 3px 3px 8px rgba(0, 0, 0, 0.4); } 50% { transform: scale(1.04) rotate(2deg); border-width: 3px; box-shadow: 0 0 25px rgba(255, 140, 0, 0.8), inset 0 0 12px rgba(255, 140, 0, 0.4), 5px 8px 15px rgba(0, 0, 0, 0.5); } }
.card .card-level { display: block; font-size: 0.8em; color: #ffcc70; font-weight: normal; }
.card-level-value-2 { color: #90ee90; text-shadow: 0 0 3px #28a745; font-weight: bold;}
.card-level-value-3 { color: #ff8c00; text-shadow: 0 0 5px #ffeb3b; font-weight: bold;}
.upgrade-button { background: linear-gradient(180deg, #90ee90, #28a745); color: #333; }
.upgrade-button:hover:not(:disabled) { background: linear-gradient(180deg, #a0f0a0, #30c050); transform: translateY(-2px); box-shadow: 0 4px 8px rgba(40, 167, 69, 0.4); }
.card.upgradeable.max-level { filter: grayscale(50%); border-color: #aaa; box-shadow: inset 0 0 10px rgba(0,0,0,0.4), 3px 3px 8px rgba(0, 0, 0, 0.4); animation: none; }
.card.upgradeable.max-level .upgrade-button { display: none; }
.card.upgradeable.max-level .card-cost { color: #aaa; font-style: italic; font-weight: normal; background-color: rgba(50, 50, 50, 0.4); border-color: rgba(150, 150, 150, 0.4); }
.card.upgradeable.max-level .card-cost::after { display: none; }

/* 売り切れステッカー風スタイル */
.card.sold-out { opacity: 0.55; pointer-events: none; position: relative; box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4), inset 0 0 5px rgba(0,0,0,0.2); animation: none; border-color: rgba(255, 255, 255, 0.15); }
.card.sold-out::after { content: "SOLD OUT"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg) scale(1.1); background-color: rgba(220, 53, 69, 0.9); color: white; padding: 10px 18px; font-size: 1.3em; font-weight: bold; border-radius: 8px; z-index: 10; text-shadow: 2px 2px 3px rgba(0,0,0,0.6); box-shadow: 3px 3px 7px rgba(0,0,0,0.4); white-space: nowrap; border: 2px solid rgba(255, 255, 255, 0.5); }
.card.sold-out .card-footer { display: none; }

/* ===== コイン獲得アニメーション ===== */
.coin-animation {
    position: fixed; /* ★ fixedに変更してヘッダー基準にする */
    width: 20px; /* コインのサイズ */
    height: 20px;
    background-color: gold;
    border-radius: 50%;
    border: 1px solid darkgoldenrod;
    box-shadow: 1px 1px 3px rgba(0,0,0,0.5);
    z-index: 1100; /* モーダルより手前 */
    pointer-events: none;
    opacity: 0; /* 最初は見えない */
    animation: coinFly 1s ease-in forwards; /* アニメーション適用 */
}

@keyframes coinFly {
    0% {
        /* 開始位置はJSで設定 */
        transform: scale(0.8) translate(0, 0);
        opacity: 1;
    }
    30% {
        transform: scale(1.2) translate(var(--tx, 0px), -50px); /* 少し上に跳ねる */
        opacity: 1;
    }
    100% {
        /* 終了位置はJSで設定 */
        transform: scale(0.5) translate(var(--tx, 0px), var(--ty, 0px));
        opacity: 0;
    }
}

/* --- カードボタン スタイル --- */
#card-action-button {
    background: linear-gradient(180deg, #6fa8dc, #4a90e2); /* 少し青寄りに */
    color: white;
    text-shadow: 0px -1px 1px rgba(0,0,0,0.4);
    position: relative; /* ハイライト用 */
    overflow: hidden; /* ハイライト用 */
}
#card-action-button:hover:not(:disabled) {
    background: linear-gradient(180deg, #81b7f3, #5aa1e9);
    transform: translateY(-2px);
    box-shadow: 0 5px 10px rgba(74, 144, 226, 0.4);
}

/* カード使用可能時のハイライト */
#card-action-button.highlight-card-button {
    animation: cardButtonPulse 1.5s infinite ease-in-out;
    box-shadow: 0 0 12px 2px #00ffff, 0 3px 5px rgba(0,0,0,0.3); /* シアン色の影 */
    border: 1px solid #00ffff;
}

@keyframes cardButtonPulse {
    0%, 100% {
        transform: scale(1);
        box-shadow: 0 0 12px 2px #00ffff, 0 3px 5px rgba(0,0,0,0.3);
    }
    50% {
        transform: scale(1.05);
        box-shadow: 0 0 20px 5px #00ffff, 0 3px 5px rgba(0,0,0,0.3);
    }
}

/* ハイライトアニメーション用の疑似要素 (任意) */
#card-action-button.highlight-card-button::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(0, 255, 255, 0.3) 0%, rgba(0, 255, 255, 0) 70%);
    animation: cardButtonShine 3s infinite linear;
    pointer-events: none; /* クリックを妨げない */
}

@keyframes cardButtonShine {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* ===== カード画面モーダル ===== */
.card-action-modal-content {
    max-width: 1100px; /* ★ 幅を広げる (900px -> 1100px) */
    max-height: 85vh;
    display: flex;
    flex-direction: column;
    overflow-y: auto; /* 縦方向はコンテンツが多ければスクロール */
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, 0.2) rgba(0, 0, 0, 0.1);
}
.card-action-modal-content::-webkit-scrollbar { width: 8px; }
.card-action-modal-content::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); border-radius: 4px; }
.card-action-modal-content::-webkit-scrollbar-thumb { background-color: rgba(255, 255, 255, 0.2); border-radius: 4px; }
.card-action-modal-content::-webkit-scrollbar-thumb:hover { background-color: rgba(255, 255, 255, 0.3); }


/* --- カードセクション --- */
.card-section { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px dashed rgba(255, 255, 255, 0.2); }
.card-section:last-child { margin-bottom: 0; border-bottom: none; padding-bottom: 0; }
.card-section h3 { color: #ffcc70; font-size: 1.3em; margin-top: 0; margin-bottom: 8px; text-align: left; padding-left: 5px; }
.card-section-message { font-size: 0.95em; color: #ccc; margin-bottom: 15px; min-height: 1.1em; text-align: left; padding-left: 5px; font-style: italic; }

/* カード表示エリア */
.card-display-area {
    display: flex;
    flex-wrap: nowrap; /* 折り返さず横に並べる */
    gap: 15px;
    justify-content: center; /* 中央揃えに */
    padding: 10px 10px; /* 横パディング追加 */
    background-color: rgba(0, 0, 0, 0.15);
    border-radius: 8px;
    min-height: 290px; /* カードの高さに合わせて最低限の高さを調整 (min-height + padding) */
    align-content: flex-start;
    overflow-x: auto; /* 横スクロールを有効化 */
    scrollbar-width: thin; /* Firefox用スクロールバー */
    scrollbar-color: rgba(255, 255, 255, 0.2) rgba(0, 0, 0, 0.1); /* Firefox用 */
}
/* Webkit系ブラウザ用スクロールバー */
.card-display-area::-webkit-scrollbar {
    height: 8px; /* 横スクロールバーの高さ */
}
.card-display-area::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 4px;
}
.card-display-area::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 4px;
}
.card-display-area::-webkit-scrollbar-thumb:hover {
    background-color: rgba(255, 255, 255, 0.3);
}

.card-display-area.empty { justify-content: center; align-items: center; color: #888; font-style: italic; min-height: 100px; /* 空の場合の高さ */ overflow-x: hidden; /* 空の場合はスクロール不要 */ }

/* --- カードアイテム共通 --- */
.card-action-item {
    border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 10px; padding: 15px;
    width: 200px; /* カード幅は維持 */
    min-height: 260px; /* カード高さは維持 */
    flex-shrink: 0; /* ★ カードが縮まないように設定 */
    box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4), inset 0 0 5px rgba(0,0,0,0.2); display: flex; flex-direction: column; transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease; position: relative; overflow: hidden; background-size: cover; background-position: center center; background-repeat: no-repeat; background-color: rgba(60, 60, 90, 0.8); text-align: center; cursor: default;
}

/* カード内要素 */
.card-action-item .card-type-badge, .card-action-item .card-rarity-badge { position: absolute; top: 0; padding: 3px 10px; font-size: 0.8em; font-weight: bold; color: #fff; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); z-index: 1; }
.card-action-item .card-type-badge { left: 0; border-radius: 10px 0 10px 0; }
.card-action-item .card-rarity-badge { right: 0; border-radius: 0 10px 0 10px; }
/* (バッジ色分けは変更なし) */
.card.rarity-normal .card-rarity-badge, .card-action-item.rarity-normal .card-rarity-badge { background-color: #9e9e9e; }
.card.rarity-rare .card-rarity-badge, .card-action-item.rarity-rare .card-rarity-badge { background-color: #4a90e2; }
.card.rarity-epic .card-rarity-badge, .card-action-item.rarity-epic .card-rarity-badge { background-color: #9c27b0; }
.card.rarity-legendary .card-rarity-badge, .card-action-item.rarity-legendary .card-rarity-badge { background-color: #ff9800; }
.card.type-support .card-type-badge, .card-action-item.type-support .card-type-badge { background-color: #4a90e2; }
.card.type-dice .card-type-badge, .card-action-item.type-dice .card-type-badge { background-color: #e65252; }
.card.type-score .card-type-badge, .card-action-item.type-score .card-type-badge { background-color: #28a745; }

.card-action-item .card-name {
    font-size: 1.1em; /* ★ サイズ少し調整 */
    color: #ffeb3b;
    margin-top: 25px;
    margin-bottom: 8px;
    font-weight: 800;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
    background-color: rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 5px 8px;
    border-radius: 8px;
    display: block;       /* ★ blockに変更して幅いっぱいにする */
    text-align: center;   /* ★ テキスト中央揃え */
    width: auto;          /* ★ 幅自動 */
    margin-left: auto;    /* ★ 中央寄せ */
    margin-right: auto;   /* ★ 中央寄せ */
    max-width: 90%;       /* ★ 最大幅制限 */
    box-sizing: border-box;
}
.card-action-item .card-level { /* レベル表示 */
    display: block;       /* ★ 改行されるように */
    font-size: 0.8em;
    color: #ffcc70;
    font-weight: normal;
    text-align: center;   /* ★ テキスト中央揃え */
    margin-top: -5px;     /* ★ 名前との間隔を詰める */
    margin-bottom: 10px;  /* ★ 説明文との間隔 */
}

/* ★ ショップと同様のレベル色付けクラス */
.card-action-item .card-level-value-2 { color: #90ee90; text-shadow: 0 0 3px #28a745; font-weight: bold;}
.card-action-item .card-level-value-3 { color: #ff8c00; text-shadow: 0 0 5px #ffeb3b; font-weight: bold;}

.card-action-item .card-description { /* 説明文 */
    font-size: 0.85em; /* サイズ調整 */
    color: #e8e8e8;
    line-height: 1.5;
    text-align: left;
    margin-bottom: 10px;
    flex-grow: 1; /* 残りの高さを埋める */
    position: relative;
    z-index: 0;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.9), -1px -1px 2px rgba(0,0,0,0.9), 1px -1px 2px rgba(0,0,0,0.9), -1px 1px 2px rgba(0,0,0,0.9);
    background-color: rgba(0, 0, 0, 0.5);
    padding: 8px;
    border-radius: 5px;
    box-sizing: border-box;
}
.card-action-item .card-action-uses { /* 使用回数 or 装備中表示エリア */
    font-size: 0.9em;
    color: #ccc;
    margin-top: auto;
    padding-top: 10px;
    border-top: 1px dashed rgba(255, 255, 255, 0.15);
    min-height: 40px; /* ★ ボタンの高さに合わせて調整 */
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;        /* ★ 幅を100%に */
    box-sizing: border-box; /* ★ パディングを高さに含める */
    padding-bottom: 5px; /* ★ 下に少しパディング追加 */
}
/* 使用ボタン (アクティブカード用) */
.card-action-item .use-card-button {
    margin-top: 10px;
    padding: 8px 20px;
    font-size: 1em;
    width: 100%;
    box-sizing: border-box;
    background: linear-gradient(180deg, #5bc0de, #31b0d5);
    color: white;
}
.card-action-item .use-card-button:hover:not(:disabled) {
    background: linear-gradient(180deg, #70cce6, #4ac0e0);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(49, 176, 213, 0.4);
}
.card-action-item .use-card-button:disabled {
    background-color: #555; background-image: none; color: #999; cursor: not-allowed; box-shadow: inset 0 2px 4px rgba(0,0,0,0.4); text-shadow: none;
}

/* --- カード状態によるスタイル --- */
.card-action-item.not-usable { filter: grayscale(70%) brightness(0.8); cursor: not-allowed; }
.card-action-item.used-up { opacity: 0.6; filter: grayscale(90%); cursor: not-allowed; }
.card-action-item.used-up .card-action-uses { color: #888; }
.card-action-item.used-up .use-card-button { display: none; }
.card-action-item.usable { cursor: pointer; border-color: cyan; box-shadow: 0 0 15px rgba(0, 255, 255, 0.5), 3px 3px 8px rgba(0, 0, 0, 0.4); animation: usableCardPulse 1.8s infinite ease-in-out; }
.card-action-item.usable:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 0 20px rgba(0, 255, 255, 0.7), 5px 7px 12px rgba(0, 0, 0, 0.5); }
@keyframes usableCardPulse { 0%, 100% { border-color: cyan; box-shadow: 0 0 15px rgba(0, 255, 255, 0.5), 3px 3px 8px rgba(0, 0, 0, 0.4); } 50% { border-color: #3fffff; box-shadow: 0 0 22px rgba(0, 255, 255, 0.7), 3px 3px 8px rgba(0, 0, 0, 0.4); } }

/* パッシブカード専用スタイル (見た目調整) */
.card-action-item.passive { cursor: default; animation: none; border-color: rgba(255, 255, 255, 0.15); }
.card-action-item.passive:hover { transform: none; box-shadow: 3px 3px 8px rgba(0, 0, 0, 0.4), inset 0 0 5px rgba(0,0,0,0.2); }
.card-action-item.passive .use-card-button { display: none; }

/* 装備中ステータス表示 */
.passive-status {
    display: inline-block;
    width: calc(100% - 10px);
    padding: 8px 10px;
    font-size: 1em;
    font-weight: bold;
    color: #ffffff;         /* 文字色を白に変更 */
    background: linear-gradient(180deg, #90ee90, #28a745); /* 背景色: 緑系 */
    border-radius: 15px;    /* 全ての角を丸める */
    box-sizing: border-box;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); /* ★ 影を少し調整 (黒系) */
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    margin-top: 10px;
    margin-left: 5px;
    margin-right: 5px;
}

/* スマホ表示調整 */
@media (max-width: 768px) {
    /* モーダル幅は元のまま or 少し広げる程度 */
    .card-action-modal-content { max-width: 95vw; } /* スマホでは画面幅に近づける */
    /* カード表示エリアの最低高さを調整 */
    .card-display-area {
        min-height: 280px; /* スマホでの高さを調整 */
        padding: 10px 10px; /* スマホでも左右パディングを 10px に */
        justify-content: flex-start; /* スマホでも左寄せに戻す */
    }
}
@media (max-width: 480px) {
     /* カード表示エリアの最低高さを調整 */
     .card-display-area {
        min-height: 280px; /* 高さを維持 */
        padding: 8px 8px; /* 極小画面ではさらにパディングを詰める */
    }
}

/* ===== NPC画像 左右反転 ===== */
.character-image-area.npc img {
    transform: scaleX(-1); /* 水平方向に反転 */
}

/* ===== 設定モーダル カード一覧 Lv表記調整 ===== */
.effect-details .effect-level-title {
    margin-top: 8px; /* 各レベル間のスペース */
    margin-bottom: 2px; /* レベル表記と説明文の間のスペースを詰める */
    color: #ffcc70; /* レベル表記の色を少し目立たせる */
}

.effect-details .effect-level-description {
    padding-left: 10px; /* 説明文を少しインデント */
    border-left: 2px solid rgba(255, 255, 255, 0.1); /* 左に区切り線 */
    margin-bottom: 8px; /* 次のレベル表記とのスペース */
}
/* 最初のレベル(Lv.1)の上マージンは不要な場合 */
.effect-details .effect-level-title:first-of-type {
    margin-top: 0;
}

/* ===== アイテム獲得演出モーダル ===== */
.item-reveal-modal { /* 基本的なモーダルスタイルを継承 */
    z-index: 1100; /* 他のモーダルより手前に */
    backdrop-filter: blur(8px) brightness(0.7); /* 背景効果を少し強く */
}

.item-reveal-content {
    background: radial-gradient(ellipse at center, rgba(60, 60, 90, 0.95) 0%, rgba(30, 30, 50, 0.98) 100%);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
    max-width: 450px; /* モーダル幅 */
    text-align: center;
    padding: 35px;
    position: relative;
    overflow: hidden; /* 輝きエフェクト用 */
    /* レアリティに応じた枠線のためにクラスを追加可能にする */
    transition: border-color 0.5s ease;
    animation: itemRevealAppear 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes itemRevealAppear {
    from { transform: scale(0.7) rotate(-5deg); opacity: 0; }
    to { transform: scale(1) rotate(0deg); opacity: 1; }
}

/* レアリティに応じた輝きと枠線 */
.item-reveal-content.rarity-normal { border-color: #aaa; }
.item-reveal-content.rarity-rare { border-color: #64b5f6; box-shadow: 0 0 20px rgba(100, 181, 246, 0.6), 0 10px 40px rgba(0, 0, 0, 0.7); }
.item-reveal-content.rarity-epic { border-color: #ba68c8; box-shadow: 0 0 30px rgba(186, 104, 200, 0.7), 0 10px 40px rgba(0, 0, 0, 0.7); }
.item-reveal-content.rarity-legendary { border-color: #ffb74d; box-shadow: 0 0 40px rgba(255, 183, 77, 0.8), 0 10px 40px rgba(0, 0, 0, 0.7); animation: legendaryShine 2s infinite linear, itemRevealAppear 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

@keyframes legendaryShine {
    0%, 100% { box-shadow: 0 0 40px rgba(255, 183, 77, 0.8), 0 10px 40px rgba(0, 0, 0, 0.7); }
    50% { box-shadow: 0 0 55px rgba(255, 183, 77, 1.0), 0 10px 40px rgba(0, 0, 0, 0.7); }
}


#item-reveal-title { /* アイテム獲得！ or パックから出現！ */
    color: #ffcc70;
    margin-top: 0;
    margin-bottom: 20px;
    font-size: 1.8em;
    font-family: 'Yuji Syuku', serif;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}

#item-reveal-body {
    display: flex;
    flex-direction: column; /* 縦積み */
    align-items: center;
    gap: 15px;
    margin-bottom: 25px;
}

#item-reveal-image-container {
    width: 150px; /* 画像コンテナサイズ */
    height: 200px;
    background-color: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

#item-reveal-image {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    display: none; /* 初期非表示 */
}

#item-reveal-placeholder {
    color: #888;
    font-size: 0.9em;
    display: block; /* 初期表示 */
}

#item-reveal-details {
    text-align: center;
}

#item-reveal-name { /* カード名 */
    font-size: 1.5em;
    color: #ffeb3b;
    margin-top: 0;
    margin-bottom: 8px;
    font-weight: bold;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
}

#item-reveal-meta { /* レアリティとタイプ */
    font-size: 0.9em;
    color: #ccc;
    margin-bottom: 12px;
    display: flex;
    justify-content: center;
    gap: 15px;
}

#item-reveal-meta .rarity-badge,
#item-reveal-meta .type-badge {
    padding: 3px 8px;
    border-radius: 10px;
    font-weight: bold;
    text-shadow: 1px 1px 1px rgba(0,0,0,0.4);
}
/* レアリティバッジ色 */
#item-reveal-meta .rarity-normal { background-color: #bdbdbd; color: #333; }
#item-reveal-meta .rarity-rare { background-color: #64b5f6; color: #fff; }
#item-reveal-meta .rarity-epic { background-color: #ba68c8; color: #fff; }
#item-reveal-meta .rarity-legendary { background-color: #ffb74d; color: #fff; }
/* タイプバッジ色 */
#item-reveal-meta .type-support { background-color: #81b7f3; color: #fff; }
#item-reveal-meta .type-dice { background-color: #f18a8a; color: #fff; }
#item-reveal-meta .type-score { background-color: #77cc87; color: #fff; }

#item-reveal-description { /* 説明文 */
    font-size: 0.95em;
    color: #e0e0e0;
    line-height: 1.6;
    margin-bottom: 15px;
    background-color: rgba(0, 0, 0, 0.2);
    padding: 10px;
    border-radius: 5px;
    max-height: 100px; /* 説明文の最大高さ */
    overflow-y: auto; /* 長い場合にスクロール */
    text-align: left;
}

#item-reveal-level { /* Lv表示 (アップグレード時) */
    font-size: 1.1em;
    color: #90ee90; /* 緑色系 */
    font-weight: bold;
    margin-top: -5px;
    margin-bottom: 10px;
}

#confirm-item-reveal-button { /* 確認ボタン */
    padding: 10px 30px;
    font-size: 1.1em;
}

/* ===== END OF style.css ===== */